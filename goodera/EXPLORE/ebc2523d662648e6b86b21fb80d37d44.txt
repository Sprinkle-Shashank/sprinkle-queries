select fac.name as factory , case when sourcing_yn=57472 then cast(factory_vpid_1 as varchar)
when sourcing_yn=57473 then cast(factory_vpid_2 as varchar) end as factory_id , case when sourcing_yn = 57473 then pace_status_2 when sourcing_yn = 57472 then pr_67.pace_status end as pace_status ,  row_number() over 
(partition by p.projectid --factory
 order by p._id desc) as row , case when sourcing_yn = 57473 then null when sourcing_yn = 57472 then pr_67.facility_score end as sustain , sum(pr_27.num_females) as women_enrolled , SUM(pr_27.num_females_graduated) as women_graduated , pr_27.start_date as recent_date from profile_52713  p

 left join ds_mysql_prod_project fac 
on p.projectId = fac.id

left join profile_54267 pr_67 on 
p.projectid = pr_67.projectid

left join profile_4227 pr_27 on 
p.projectid = pr_27.projectid

group by fac.name , p.sourcing_yn , 