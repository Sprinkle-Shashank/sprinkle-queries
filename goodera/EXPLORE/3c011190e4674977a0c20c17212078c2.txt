

with table1 as
(
  select p.projectid , country , cou.name as country_update , pace_status , pace.name as pace_status_update, sourcing_yn , child_vpid_autocal , vpid_1 , vpid_2 from profile_52162 p
  
  left join ds_mysql_prod_tagelement cou on 
  p.country = cou.id
  
  left join ds_mysql_prod_tagelement pace on 
  p.pace_status = pace.id
),

table2 as 
( select p.projectid , country , pace_status , pace.name as pace_update, cp_id from profile_5997 p
 
  left join ds_mysql_prod_tagelement pace on 
  p.pace_status = pace.id
),

table3 as
(
select t2.*, cast(f1 as varchar) from table2 t2, t2.country as f1
),

table4 as
( select t3.projectid , pace_update , cp_id ,cou.name as country_update from table3 t3
 
  left join ds_mysql_prod_tagelement cou on 
  t3.f1 = cou.id
 ),
   
 table5 as
 ( select p.projectid , name_vendor_filter, case when name_vendor_filter ilike '%NG%' then 'Community Partner' else 'Vendor Partner' end as partner_type  , case when t1.sourcing_yn=57472 then cast(t1.vpid_1 as varchar) when t1.sourcing_yn=57473 or t1.child_vpid_autocal is not null then cast(t1.vpid_2 as varchar)  else t4.cp_id end as vendor_partner_id , t1.pace_status_update , t4.pace_update , case when partner_type.equals('Vendor Partner') then t1.pace_status_update else t4.pace_update end as current_pace_status from profile_54646 p
 
 left join table1 t1 on
 p.projid_vendor = t1.projectid
  
 left join table4 t4 on
 p.projid_vendor = t4.projectid
  )
   
   select * from table5
 
 /*
 table6 as
 ( select p.projectid , case when sourcing_yn=57472 then cast(vpid_1 as varchar) when sourcing_yn=57473 or child_vpid_autocal is not null then cast(vpid_2 as varchar)  else t7.cp_id end as vendor_partner_id , case when pace_162.name is not null then pace_162.name else t7.pace_update end as pace_Status_update from profile_52162 p
  
  left join table7 t7
  on p.projectid = t7.projectid
  
  left join ds_mysql_prod_tagelement pace_162 on 
  p.pace_status = pace_162.id
  )
  
  
  
 )
  */
 