--sakshi_API1
--select * from ds_mysql_prod_grantproposal --where proposalinstanceid = '5d42c4025570e08c058b5410'
with table1 as (
  select p.id as grantApplicationId,partner.id as grantPartnerId1, 
  proposal.id as grantProposalId1, proposallog.*,p.active as isactive, partner.active as activepartner, proposal.active as activeproposal, proposallog.active as activeproposallog
  
  from ds_mysql_prod_grantapplication p 
			   
left join ds_mysql_prod_grantpartner partner on
partner.grantapplicationid = p.id	
			
left join ds_mysql_prod_grantproposal proposal on
proposal.grantpartnerid = partner.id

left join ds_mongo_grantproposallog proposallog on
cast(proposallog.grantproposalid as int) = proposal.id
  
  
group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17		   
),
t2 as(
select * from table1 where grantApplicationId = 1792 and isactive = 1 and activepartner = 1 and activeproposal = 1 and activeproposallog = 't' --and _id = '600eade8e37d56760546e4d6' 
)

Select *,cast(todo."action" as varchar) as action,
object(
'In Progress', 
JSON_PARSE(case
	when action = 'PENDING' and todo."taskId"=28720 then grantproposalid
	end),
  'Completed', JSON_PARSE(case
	when action = '' and todo."taskId"=28720 then grantproposalid
	end),
 'Rejected', jSON_PARSE(case
	when action = 'REJECTED' and todo."taskId"=28720 then grantproposalid
	end)

) as Approval_by_CSR_team
 from t2