

with x as (select name as projectid, fy_timerange, financialperiod,datatablebase from sus_56551 where keyword='gri_hazardouswaste' and datatablebase is not null),
temp2 as (

select * ,from x as temp, 
  unpivot temp.datatablebase as temp1 at row) 



select  projectid, fy_timerange, t1.name as financialperiod ,

sum (case datatablebase)
 as values,
	 
	 split_part(fy_timerange,'-',1) as year,
	 CASE split_part(fy_timerange,'-',2)
	  
WHEN '01' THEN 'Jan'
WHEN '02' THEN 'Feb'
WHEN '03' THEN 'Mar'
WHEN '04' THEN 'Apr'
WHEN '05' THEN 'May'
WHEN '06' THEN 'Jun'
WHEN '07' THEN 'Jul'
WHEN '08' THEN 'Aug'
WHEN '09' THEN 'Sep'
WHEN '10' THEN 'Oct'
WHEN '11' THEN 'Nov'

 Else 'Dec'
end  as Month,

case t1.name
when 'FY 2019-20 ' then 'FY (2019-20)'
when 'FY 2020-21' then'FY (2020-21)'
when 'FY 2021-22' then 'FY (2021-22)'
else t1.name
end  as financialyear,

case row
when  'gri_hazardouswaste_gri_biomedicalwaste' then 'Biomedical Waste'
when 'gri_hazardouswaste_gri_phosphatedischarge' then 'Phosphate Discharge'
when 'gri_hazardouswaste_gri_oil_greasedischarge' then 'Oil and Grease Discharge'
when 'gri_hazardouswaste_gri_ammonia_nitrogen_discharge' then 'Ammonia & Nitrogen Discharges'
when 'gri_hazardouswaste_gri_spentoil' then 'Spent Oil'
when 'gri_hazardouswaste_gri_fusedash' then 'Fused Ash'
when 'gri_hazardouswaste_gri_discardedcontainers' then 'Discarded containers'
when 'gri_hazardouswaste_gri_batteries' then 'Used Lead-Acid Batteries / Any batteries'
when 'gri_hazardouswaste_gri_spentcatalyst' then 'Spent Catalyst'
when 'gri_hazardouswaste_gri_oilresidue' then 'Residue containing oil'
when 'gri_hazardouswaste_gri_chemicalsludge_etp' then 'Chemical sludge from ETP'
when 'gri_hazardouswaste_gri_ewaste' then 'E-Waste'

else null 
end as waste_type



from temp2  
left join ds_mysql_prod_tagelement t1 on t1.id = financialperiod
	 
group by projectid, fy_timerange, t1.name, year, month, financialyear, waste_type

	/*select * from sus_56551 where keyword ='gri_hazardouswaste'*/