with sub1 as (select  _id , a.projectId, facility_name ,
				fac_vpid ,parent_vendor_name,parent_vendor_vpid ,fy,month,facility_score ,pace_status,total_workers ,female_workers ,male_workers,country_name, primary_category,unwind_primary_category from profile_54267 as a, a.primary_category as unwind_primary_category)


select p.projectId,facility_name as name_factory,
				fac_vpid as Factory_Id,ven.name as vendor_name,parent_vendor_vpid as vendor_id,f_y.name as year, cast(concat('FY ' ,year) as varchar) as start_year,mth.name as month,facility_score as factory_sustainability,status.name as factory_pace,total_workers as Total,female_workers as fem_workers,male_workers as mal_workers,con.name as name_country,cat.name as primary_category,p2.name_vendor_filter from sub1 as p
				
left join profile_54646 p2 on 
p.projectId = p2.projectId				
				
				

left join tagelement_1137 ven
on p.parent_vendor_name = ven.id

left join tagelement_1137 f_y
on p.fy = f_y.id

left join tagelement_1137 mth
on p.month = mth.id

left join tagelement_1137 status
on p.pace_status = status.id
			   
left join tagelement_1137 con
on p.country_name = con.id

left join tagelement_1137 cat on
p.unwind_primary_category= cat.id

where p.projectId like '%%'
group by p.projectId , facility_name ,fac_vpid,vendor_name ,parent_vendor_vpid,year,start_year,mth.name ,facility_score,status.name,total_workers,female_workers,con.name ,cat.name ,male_workers,p2.name_vendor_filter 
 
 
