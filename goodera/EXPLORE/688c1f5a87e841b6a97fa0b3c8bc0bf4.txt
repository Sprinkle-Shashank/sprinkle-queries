temp2 as (select * ,temp1.type_company, temp1.fuel_company_type, temp1.fuel_company,
          case
              when IS_ARRAY(temp1.type_company) = false or GET_ARRAY_LENGTH(temp1.type_company) = 0 then ARRAY(temp1.type_company)
          else temp1.type_company
          end as type_company_new,
          
            case
              when IS_ARRAY(temp1.fuel_company_type) = false or GET_ARRAY_LENGTH(temp1.fuel_company_type) = 0 then ARRAY(temp1.fuel_company_type)
          else temp1.fuel_company_type
          end as fuel_company_type_new
           
          from x as temp,
          unpivot temp.datatablebase as temp1 at row) ,/extract table/
         
 y as (select xprojectid,financialperiod,fy_timerange,datatablebase,fuel_company,type_company,fuel_company_type from 
        temp2 ytemp,ytemp.type_company_new as type_company,ytemp.fuel_company_type_new as fuel_company_type),/unwind/
The fields you are unwinding, that the time of extracting them check for IS_ARRAY(temp1.type_company) = false or GET_ARRAY_LENGTH(temp1.type_company) = 0
