with temp as (
Select 'Male' as col
  union all
Select 'Female' as col),
s1 as(
select ss.projectId as proj_location, t1.name as partner, t2.name as projectId, fy_timerange, school, female_students female, male_students male,pl.location,po.impl_agency as imp_partner,cast('NA' as text) as  age_bucket, st.name as state_code
from profile_77019 ss
left join ds_mysql_prod_project t
on ss.projectid=t.id
left join ds_mysql_prod_project t1
on t.parent=t1.id
left join ds_mysql_prod_project t2
on t1.parent=t2.id
left join profile_65603 pl
on pl.projectid=ss.projectid
left join profile_65552 po
on t.parent=po.projectid
left join profile_73573 st
on st.loc_select=pl.location
),
s2 as (
	select s1.proj_location, s1.fy_timerange, s1.partner, s1.projectId, s1.location, s1.age_bucket, s1.state_code,s1.imp_partner,
	 case col 
  	when 'Male' then s1.male
   when 'Female' then s1.female
  else null
  end as no_benef,temp.col as gender
	  from s1
	  cross join temp 
	  group by s1.proj_location, s1.fy_timerange, s1.partner, s1.projectId, s1.location, s1.age_bucket, s1.state_code,s1.imp_partner, temp.col
	)
select s2.proj_location, s2.fy_timerange, s2.partner, s2.projectId, s2.location, s2.age_bucket, s2.state_code,s2.imp_partner,s2.gender,sum(no_benef)
from s2
group by s2.proj_location, s2.fy_timerange, s2.partner, s2.projectId, s2.location, s2.age_bucket, s2.state_code,s2.imp_partner,s2.gender
	  
