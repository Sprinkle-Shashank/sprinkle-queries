with temp as (
Select 'Male' as col
  union all
Select 'Female' as col),
sub1 as(
select projectId as proj_location, t1.name as partner, t2.name as projectId, fy_timerange, school, female_students, male_students
from profile_77019 ss
left join ds_mysql_prod_project t
on ss.projectid=t.id
left join ds_mysql_prod_project t1
on t.parent=t1.id
left join ds_mysql_prod_project t2
on t1.parent=t2.id),
sub2 as
(
select pd.location, s1.proj_location, s1.partner, s1.projectId, mr.impl_agency as imp_partner, s1.female_students female, s1.male_students male, s1.school, s1.fy_timerange
from sub1 s1
left join profile_65603 pd
on s1.proj_location=pd.projectId
left join profile_65552 mr
on mr.projectId=s1.partner
),
  sub3 as(
select s2.*
  
  from sub2 s2), 
  sub4 as(
  select s1.*,
	cast('NA' as text) as  age_bucket
	from sub3 s1), 
	sub5 as(
	select s4.*,  st.name as state_code
	from sub4 s4
	  left join profile_73573 st
	on st.loc_select=s4.location),
	sub6 as (
	select s5.proj_location, s5.fy_timerange, s5.partner, s5.projectId, s5.location, s5.age_bucket, s5.state_code,s5.imp_partner,
	  sum(case col 
  	when 'Male' then s5.male
   when 'Female' then s5.female
  else null
  end )as no_benf,temp.col as gender
	  from sub5 s5
	  cross join temp 
	  group by s5.proj_location, s5.fy_timerange, s5.partner, s5.projectId, s5.location,s5.imp_partner, s5.age_bucket, s5.state_code, temp.col
	)
	  
	  select * from sub6
	  
