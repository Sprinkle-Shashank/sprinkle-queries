


with t1 as
(SELECT * 
FROM
(Select   projectId, fy_timerange, twopc, setoff_amount, setoff_amount_preceeding, surplus_previousfy, actual_csr, overhead_expense, impact_assessment, unspent_account, netprofit, (twopc+surplus_previousfy+setoff_amount) as total_csr_obligation, (actual_csr+overhead_expense+impact_assessment) as total_amount_current,  case when (actual_csr+overhead_expense+impact_assessment-twopc)<=0 then 0 else (actual_csr+overhead_expense+impact_assessment-twopc) end as excess_current,  case when (actual_csr+overhead_expense+impact_assessment-twopc-surplus_previousfy)<=0 then 0 else (actual_csr+overhead_expense+impact_assessment-twopc-surplus_previousfy) end  as setoff_succeed from profile_77139 p 


)
UNPIVOT (
    val FOR dim IN (twopc, setoff_amount, setoff_amount_preceeding, surplus_previousfy, actual_csr, overhead_expense, impact_assessment, unspent_account, total_csr_obligation, total_amount_current, excess_current, setoff_succeed, netprofit))

)

select  project_id,fy_timerange,sum(val) as val,dim from t1 as p



  Group By project_id,fy_timerange, Dim
  
  
  