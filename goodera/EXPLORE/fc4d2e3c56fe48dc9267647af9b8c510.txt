with sub1 as (
select p_29974.projectid, cast(p.parent as varchar) as parentid, p_29974.fy
from profile_29974 p_29974

left join (select cast(y.id as varchar) as id, y.name, y.parent from ds_mysql_project y) p on p_29974.projectid=p.id

where p_29974.fy = '432710'
),

sub2 as (
select parentid, projectid, p.name as code, fy
from sub1

left join (select cast(y.id as varchar) as id, cast(SPLIT_PART(y.name, '|', 1) as varchar) as name, y.parent from ds_mysql_project y) p on sub1.parentid = p.id
)

select code, fy, count(Distinct projectid) as projects
from sub2
group by 1,2