with lookup as (select 
				p.taskuserid, p._id, p.status, p.active, p.organizationid, p.data, p.projectid, p.profileid,p.programid, taskuser.programuserid,p.approvallog[0] as ap1,
				taskuser.taskid 
				from ds_mongo_taskresponse p
								
left join ds_mysql_prod_taskuser taskuser on
taskuser.id = p.taskuserid

),

lookup1 as (select 
				p.taskid, p._id, p.status, p.active, p.organizationid, p.data, p.programuserid, task.projectflowid, p.ap1,
				task.flowtaskid, 
			programuser.programid 
				from lookup p
				
				
left join ds_mysql_prod_task task on
task.id = p.taskid
						
left join ds_mysql_prod_programuser programuser on
programuser.id = p.programuserid
			

),

lookup2 as (select 
			p._id, p.status, p.active, p.organizationid, p.data, p.flowtaskid, p.programid,p.projectflowid,p.ap1,
			flowtask.sectionid,
			projectflow.projectid
			from lookup1 p
 			
left join ds_mysql_prod_flowtask flowtask on 
flowtask.id = p.flowtaskid		
			
left join ds_mysql_prod_projectflow projectflow on 
projectflow.id = p.projectflowid
),

lookup3 as (select 
			p._id, p.status, p.active, p.organizationid, p.data, flowtaskid, sectionid, 
			section.profileid, section.name,p.projectid,p.programid,p.ap1
			from lookup2 p
  
left join ds_mysql_prod_section section on
section.id = p.sectionid		
)

select _id,p.ap1,substring(cast(p.data.date_of_reg as date),1,10) as date_of_reg, p1.name as projectid,p3.name as programid, p.name, organizationid, p.data, p.data.age, p.data.fy_timerange, p.data.reg_no, p.data.start, p.data.end, p.data.type_of_dis, t6.name as lvl_of_dis, p.data.addr, p.data.edu_qual, p.data.occu, p.data.marriage, p.data.emp_name, p.data.salay, p.data.job_loc, p.data.type, p.data.dropout ,p.data.email,p.data.comments,substring(cast(p.data.dob as date),1,10) dob ,t.name as gender ,p.data.mobile_no ,p.data.mobile_number_2 ,p.data.fam_size ,p.data.fam_head ,p.data.fam_occ ,p.data.fam_income , t3.name as city_of_job ,t1.name state ,t2.name district ,t4.name placed ,substring(cast(p.data.date_of_placement as date),1,10) as date_of_placement ,t5.name as role_after_placement ,p.data.trainee_name, flowtaskid, sectionid, p.profileid, status, p.active
from lookup3 p 
left join ds_mysql_prod_tagelement t
ON t.id=p.data.gender
left join ds_mysql_prod_tagelement t1
ON t1.id=p.data.state
left join ds_mysql_prod_tagelement t2
ON t2.id=p.data.district
left join ds_mysql_prod_tagelement t3
ON t3.id=p.data.city_of_job
left join ds_mysql_prod_tagelement t4
ON t4.id=p.data.placed
left join ds_mysql_prod_tagelement t5
ON t5.id=p.data.role_after_placement
left join ds_mysql_prod_project p1
ON p1.id=p.projectid
left join ds_mysql_prod_project p2
ON p2.id=p.programid
left join ds_mysql_prod_project p3
On p2.parent = p3.id
left join ds_mysql_prod_project t6
ON t4.id=p.data.lvl_of_dis
where (p.profileid = 145 or p.profileid = 36901) and status = 'REJECTED' and p.active = 't'