with tab1 as(select p.name as project_code,f.name as fy,m.name  as project_manager from profile_27396 p
left join ds_mysql_prod_tagelement m on
p.project_manager=m.id
left join ds_mysql_prod_tagelement f on
p.fy=f.id
union
select l.name as ProjectCode,f.name as fy_timerange,m.name as Project_Manager
from profile_27420 p
left join profile_27396 l on
p.project_code=l._id
left join ds_mysql_prod_tagelement m on
p.project_manager=m.id
left join ds_mysql_prod_tagelement f on
p.fy=f.id),
tab2 as(select t2.name as fy,t3.name as project_code,t.name as tranche,p.uc,case when p.amnt_nt_utlzd is null then 0 else p.amnt_nt_utlzd  end as amnt_not_utilised from profile_27398 p
left join ds_mysql_prod_tagelement t
on p.tranche=t.id
left join ds_mysql_prod_tagelement t2
on p.fy=t2.id
left join profile_27396 t3 on
p.project_name=t3._id)
select t.fy,t.project_code,t1.project_manager,t.tranche,t.amnt_not_utilised from tab2 t
left join tab1 t1 on
t1.project_code=t.project_code