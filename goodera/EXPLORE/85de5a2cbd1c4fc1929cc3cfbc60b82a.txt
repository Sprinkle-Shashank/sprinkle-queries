with table1 as
( select p.* , bat.name as batch_name from profile_81612 as p

left join ds_mysql_prod_tagelement bat
on p.batch = bat.id ), 

table2 as
(
select p.*, cast(d1 as varchar) as d1_updated from table1 as p , p.images as d1
),

table3 as
( select p.projectid , p._id , fy_timerange , batch_name , activity_date , activity_names , guest_name , desci , listagg(distinct d1, ',') as image_updates from table2 as p
 
 group by  p.projectid , p._id , fy_timerange , batch_name , activity_date , activity_names , guest_name , desci 
 )

select * from table2