with t1 as
(SELECT * 
FROM
(
   select p.aadhaar1_yn, p.state, q.time_timerange, case when aadhaar1_yn=476506 then 1 else 0 end as numerator, count(*) as denominator from profile_30527 p
  left join profile_30532 q
on p.batch=q._id
group by p.aadhaar1_yn,p.state, q.time_timerange
)
)
select   * , ((SUM(numerator)/denominator)*100) as per from t1 as r
Group By r.aadhaar1_yn,r.state, r.time_timerange,r.numerator,r.denominator