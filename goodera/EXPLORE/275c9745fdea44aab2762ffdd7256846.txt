

with t1 as
(SELECT * 
FROM
(
   aadhaar1_yn, state,case when aadhaar1_yn=476506 then 1 else 0 end) as numerator, count(*) as denominator from profile_30527 p

)
)
select   p.aadhaar1_yn, p.state, ((SUM(numerator)/denominator)*100) as per , q.time_timerange from t1 as p

left join profile_30532 q
on p.batch=q._id

Group By p.state,q.time_timerange,p.aadhaar1_yn,








/*select  p.aadhaar1_yn, p.state,SUM(case when p.aadhaar1_yn=476506 then 1 else 0 end) as numerator, count(*) as denominator , q.time_timerange, ((numerator/denominator)*100) as per from profile_30527 p

left join profile_30532 q
on p.batch=q._id

group by  p.state,q.time_timerange,p.aadhaar1_yn
*/