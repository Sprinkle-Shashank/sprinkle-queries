with t1 as
(SELECT * 
FROM
(
   aadhaar1_yn, state, case when aadhaar1_yn=476506 then 1 else 0 end as numerator, count(*) as denominator from profile_30527 p

)
)
select   r.aadhaar1_yn, r.state, ((SUM(numerator)/denominator)*100) as per, q.time_timerange from t1 as r

left join profile_30532 q
on r.batch=q._id

Group By r.state,q.time_timerange,r.aadhaar1_yn

