
with t1 as
(select pro.name as projectid, fy_timerange, financial_year, toa.name as type_of_animal, treat.name as treatment, dog_sterilization, cat_sterilization,  total_animals, count(type_of_animal) as value 

from profile_51307 p

left join ds_mysql_prod_project as pro
  on p.projectid = pro.id
  
left join ds_mysql_prod_project as toa
  on p.type_of_animal = toa.id
  
left join ds_mysql_prod_project as treat
  on p.treatment = treat.id
  
group by pro.name, fy_timerange, toa.name, treat.name, financial_year, dog_sterilization, cat_sterilization,  total_animals)

select project, fy_timerange, financial_year, type_of_animal, treatment, dog_sterilization, cat_sterilization, total_animals, value
from t1
