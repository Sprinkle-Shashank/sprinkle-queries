 with p as (
   select t4.name as projectId, 
t5.name as country, p1.fy_timerange,p1.keyword,t1.name as company_category,p1.datanum
from sus_21557  as p1
left join sus_46830 t2
on p1.xprojectid = t2.xprojectid
left join project_6664 t4 on t4.id = p1.xprojectid
--left join tagElement_6664 t1 on t1.id = t2.dataselect 
left join project_6664 t5 on t5.id = t4.parent
 left join tagElement_6664 t1 on t1.id = t2.dataselect 
where p1.keyword in (
  'staff_begining_month',
 'staff_end_month'
)  
   and t2.keyword = 'company_category')


select  projectId, 
 country, fy_timerange,'average' as keyword , company_category ,sum(datanum)/2  as  val
 from p

 group by 1,2,3,4,5
 