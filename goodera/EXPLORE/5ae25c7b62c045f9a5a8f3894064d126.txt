with sub1 as (select p1.name as projectid,t1.name as financial_period, datatablebase, tablesettings, questiontext, fy_timerange
from sus_56551 p1
left join ds_mysql_prod_tagelement t1 on t1.id=p1.financialperiod
where keyword in ('gri_scope_1_emission'),

sub2 as (select *,temp.source,temp.scope_1_figure
from sub1 s1,unpivot s1.datatablebase as temp at row_id)

select projectid, financial_period, source, scope_1_figure,questiontext, fy_timerange,('FY' || ' ' || split_part(financial_period, ' ', 2)) as FY,row_id,sum(gri_scope_1_emission_scope_1_figure) as gri_scope_1_emission_scope_1_figure
case row_id
when 'source' then cast(tablesettings."0"."source"."measureUnitBase" as VARCHAR)
when 'scope_1_figure' then cast(tablesettings."0"."scope_1_figure"."measureUnitBase" as VARCHAR) 
else null
end as units
from sub2
where row_id is not null
group by projectid,source, scope_1_figure, financial_period, questiontext,fy_timerange,units, row_id, fy_timerange