with s1 as(
  Select ttt.name as projectId,tt.name as partner, np.timerange_timerange, np.student_name, np.email, np.category, np.gender, np.college, np.state, np.city, np.city_tier, tt1.name as discipline, np.semesetr, np.placed, np.contact, np.exam_fee, np.hard_copy, np.fee_waiver, np.total_fee, np.final_marks, po.impl_agency as imp_partner
from profile_63517 np
left join ds_mysql_prod_project t
on np.projectid=t.id
left join ds_mysql_prod_project tt
on t.parent=tt.id
left join ds_mysql_prod_project ttt
on tt.parent=ttt.id
left join profile_65552 po
on tt.name=po.projectid
left join ds_mysql_prod_tagelement t1
on np.discipline=t1.id
left join ds_mysql_prod_tagelement tt1
on t1.parent=tt1.id
  ),
  
 s2 as(
   Select s1.proj_location, s1.fy_timerange, s1.gender, s1.state, s1.course, s1.placed, s1.partner, s1.projectId, s1.imp_partner,count(*) no_benf,listagg(distinct s1.college) no_colleges,listagg(distinct s1.course) no_courses, listagg(distinct s1.state) no_states, listagg(distinct s1.discipline) no_disciplines ,mc.name as state_code 
   from s1
   left join profile_73573 mc
   on s1.location=mc.nptel_loc
   group by s1.proj_location, s1.fy_timerange, s1.gender, s1.state, s1.course, s1.placed, s1.partner, s1.projectId
 )
 
 Select * from s2