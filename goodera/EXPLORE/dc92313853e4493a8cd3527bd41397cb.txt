--Yuva_gfc_heatmap

with t1 as 
(Select a.fy_timerange as fy_timerange, p.name as projectid, p1.name as donor,t.name as city,t2.name as state, count(*)

from profile_80582 a 

left join ds_mysql_prod_project p on p.id = a.projectid
left join ds_mysql_prod_project p1 on p1.id = p.parent
left join ds_mysql_prod_tagelement t on t.id=a.school_loc
left join ds_mysql_prod_tagelement t2 on t2.id=t.parent

group by a.fy_timerange, p.name,p1.name,t.name,t2.name)

select fy_timerange, projectid, donor, city, count,
case when
state is null then city else state end as state_new
from t1


 



