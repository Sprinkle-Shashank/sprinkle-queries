with t1 as 
(select _id, projectid, ngo, proj, tag1.name as proposed, tag2.name as approved, tag3.name as ongoing, tag4.name as completed, tag5.name as disqualify 
from profile_70244 p1
left join ds_mysql_prod_tagelement tag1
on p1.proposed = tag1.id
left join ds_mysql_prod_tagelement tag2
on p1.approved = tag2.id
left join ds_mysql_prod_tagelement tag3
on p1.ongoing = tag3.id
left join ds_mysql_prod_tagelement tag4
on p1.completed = tag4.id 
left join ds_mysql_prod_tagelement tag5
on p1.disqualify = tag5.id),

t2 as 
(select t1._id, t1.projectid, t1.ngo, t1.proj,
case 
when disqualify = 'Yes' or approved = 'No' or ongoing = 'No' or completed = 'No' or proposed = 'No' then 'Disqualified'
when completed = 'Yes' then 'Completed'
when ongoing = 'Yes' then 'Ongoing'
when approved = 'Yes' then 'Approved'
when proposed = 'Yes' then 'Proposed'
else 'NA'
end as status, p2.remarks, p2.upload, p2.type, p2.date, tag2.name as parent, cast('Download' as VARCHAR) as download
from t1
left join profile_70245 p2
on t1._id = p2.ngo_projects
left join ds_mysql_prod_project tag1
on t1.projectid = tag1.id
left join ds_mysql_prod_project tag2
on tag1.parent = tag2.id
where upload is not null)

select t2.*, 
case
when status = 'Completed' then 1
when status = 'Approved' then 2
when status = 'Proposed' then 3
when status = 'Ongoing' then 4
else 5 end as sort, extract ( YEAR from t2.date) as year
from t2



 














 



