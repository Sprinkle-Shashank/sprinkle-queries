select t.*,loc.name as location,sta.name as state_1,reftag.code from profile_55622 t
left join ds_mysql_prod_tagelement loc
on t.location=loc.id
left join ds_mysql_prod_tagelement sta
on loc.parent=sta.id
left join ds_mongo_reftagelementmetadata reftag
on sta.name = reftag.name
case when state_1 is null then state_1 = location
end as state_1
where code is not null