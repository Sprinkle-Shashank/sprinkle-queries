with table1 AS 
(SELECT m.projectid, m._id, m.month_timerange AS fy_timerange, m.project_code_new, m.amount, r.project_name, r.vertical, r.focus, r.entity /*, vert.name AS vertical2, vert_1.name AS vertical1,

case when vert.name IS NULL AND vert_1.name IS NOT NULL THEN vert.name 
when vert_1.name IS NULL AND vert.name IS NOT NULL THEN vert_1.name
when m.entity IS NULL THEN 'Mylan Pharmaceuticals Private Limited'
else 'Admin' 
END AS entity*/

FROM profile_55194 AS m

LEFT JOIN profile_62881 AS r 
 ON m.project_code_new = r._id),

/*left join ds_mysql_prod_tagelement as vert
  on r.vertical = vert.id

left join ds_mysql_prod_tagelement as vert_1
  on vert.parent = vert_1.id
  
left join ds_mysql_prod_tagelement as entity
  on m.entity = entity.id),*/
  
table2 as 
--( select p.*, q1 from table1 as p, p.vertical as q1)
(select p.projectid, p._id, p.fy_timerange, p.project_code_new, p.amount, p.project_name, p.vertical, focus.name AS focus, entity_new
 
from table1 AS p, p.entity entity_new
 
left join ds_mysql_prod_tagelement as focus
  on p.focus = focus.id),
  
table3 as
(select p.projectid, p._id, p.fy_timerange, p.project_code_new, p.amount, p.project_name, p.vertical, p.focus, vertical_new,
 
case when p.entity IS NULL THEN 'Mylan Pharmaceuticals Private Limited'
end as entity
 
from table2 AS p, p.vertical vertical_new),
 
/*select p.*, new_2.name AS verticals From table2
AS p*/

table4 as
(select fy_timerange, project_code_new, project_name, focus, amount, entity,

case when vert.name IS NULL AND vert1.name IS NOT NULL THEN vert.name 
when vert1.name IS NULL AND vert.name IS NOT NULL THEN vert1.name
else 'Admin' 
END AS vertical

from table3 AS p

left join ds_mysql_prod_tagelement as vert
  on p.vertical_new = vert.id
  
left join ds_mysql_prod_tagelement as vert1
  on vert.parent = vert1.id)
  
select fy_timerange, project_code_new, project_name, focus, SUM(p.amount) AS amount, p.vertical, entity

from table4 as p

group by fy_timerange, project_code_new, project_name, focus, entity,  p.vertical, entity

ORDER BY p.project_code_new ASC