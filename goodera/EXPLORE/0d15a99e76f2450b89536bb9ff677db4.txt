with tab1 as(
Select cast((split_part(split_part(prod.name,'|',1),'.',1)) as varchar) as prj_code, projectid, cast((split_part(prod.name,'|',1)) as varchar) as prj1
from profile_29974 r
left join ds_mysql_prod_project prod
on r.projectid=prod.id
  )

Select f.name as fy,sq.fy, sq.name, curr_yr_budget, state, l.name as implementing_agency, cast((split_part(split_part(p2.name,'|',1),'.',1)) as varchar) as prj_code
from profile_27396 sq
left join tab1 p
on p.prj_code=sq.name
left join ds_mysql_prod_project p1
on p.projectid=p1.id
left join ds_mysql_prod_project p2
on p1.parent=p2.id
left join ds_mysql_prod_tagelement f on
sq.fy=f.id 
left join profile_27395 l on
l._id=sq.ngo_partner



/*Select p.name as Projectcode,p.fy, f.name, p1.hdfc_cost_monthly, p2.monthly_cost, (p1.hdfc_cost_monthly + p2.monthly_cost)
from profile_27396 p
left join ds_mysql_prod_tagelement f on
p3.fy=f.id
left join profile_29974 p1
on p1.prj_code=p._id
left join profile_30171 p2
on p2.prj_code=p._id
union all
Select p.name as Projectcode,p3.fy, f.name, p1.hdfc_cost_monthly, p2.monthly_cost, (p1.hdfc_cost_monthly + p2.monthly_cost)
from profile_27396 p
left join profile_27420 p3
on p3.project_code=p._id
left join ds_mysql_prod_tagelement f on
p3.fy=f.id
left join profile_29974 p1
on p1.prj_code=p._id
left join profile_30171 p2
on p2.prj_code=p._id
*/