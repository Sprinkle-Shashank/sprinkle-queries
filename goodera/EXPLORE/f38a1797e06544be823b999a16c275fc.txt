with table1 as (
select d1.patient_count , d1.photo,
location.name as location,loc.name as sublocation,
fac.name as van, d2.name as partner,
cast(substring(d1.req_date,1,10) as date) as date_update_1 , cast(substring(d1.date_n,1,10) as date) as date_update_2 , 
case when d1.date_yn = 28005 then date_update_2 else date_update_1 end as date , partner+' '+date+' '+location.name+' '+count(d1.projectid)
 from profile_58474 t

left join profile_55793 p2
on t.projectid = p2.projectid
left join profile_58511 d1
on t.sel_camp = d1._id
left join profile_51990 d2
on d1.imple_partner = d2._id

left join ds_mysql_prod_tagelement location
on p2.location = location.id
left join ds_mysql_prod_project fac
on t.projectid = fac.id
left join ds_mysql_prod_project loc
on d1.projectid = loc.id
  ),
  table2 as (select t.* , cast(photos as varchar)  from table1 t ,t.photo as photos)
  select * from table2