Select p1.fy_timerange,tag1.name,p1.fam_income,count(*) as count,
case
when p1.fam_income <100000 then <100000
when p1.fam_income <300000 then 100000-300000
when p1.fam_income <500000 then 300000 -500000
else >500000
end as income_bracket
from profile_76022 p1
left join ds_mysql_prod_tagelement as tag1
on p1.gender = tag1.id
where p1.fam_income is not null
group by p1.fy_timerange ,tag1.name,income_bracket,p1.fam_income

