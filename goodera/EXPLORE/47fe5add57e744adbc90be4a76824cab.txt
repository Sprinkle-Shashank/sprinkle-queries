select p1.fy_timerange, p1.activity as title, t1.name as country, t2.name as focus_area, t3.name as prod_brand, (t4.name||'_'||extract(year from cast(p1.fy_timerange.start as date)))as abc,
sum(p1.direct_cash_donations*p2.conversion_factor) as investment
from profile_78057 p1
  
left join ds_mysql_prod_tagelement t1 on t1.id = p1.country
left join ds_mysql_prod_tagelement t2 on t2.id = p1.focus_area
left join ds_mysql_prod_tagelement t3 on t3.id = p1.product_brand
left join ds_mysql_prod_tagelement t4 on t4.id = p1.currency
  
left join profile_78083 p2 on p2.name = 
  (t4.name||'_'||extract(year from cast(p1.fy_timerange.start as date)))
  
where p1.direct_cash_donations is not null
  
--group by p1.fy_timerange, t1.name, t2.name, t3.name, p1.activity

/*with table1 as( 
  select p._id, p.projectid, p.year_timerange, cast(d1 as varchar) as d1_update  
from profile_76755 as p, p.impact_wcp_arr as d1
)

select p1.absenteeism_rate  , p1.labor_disputes , p1.person_days_lost , p1.bc_meetings,

((nvl(cast(p1.last_day_workers as FLOAT),0) + nvl(cast(p1.day_1_workers as FLOAT),0)) / 2) as d2,

nvl(((nvl(p1.workers_exited, 0)/ nullif(d2,0))  * 100), 0) as inside, 

extract(year from cast(p.year_timerange.start as DATE)) as start_year,
extract(month from cast(p.year_timerange.start as DATE)) as start_month,

case start_month
	when 1 then 'January'
	when 2 then 'February'
	when 3 then 'March'
	when 4 then 'April'
	when 5 then 'May'
	when 6 then 'June'
	when 7 then 'July'
	when 8 then 'August'
	when 9 then 'September'
	when 10 then 'October'
	when 11 then 'November'
	else 'December'
end as month,

case
	when month in ('February','March','April') then 'Q1'
    when month in ('May','June','July') then 'Q2'
	when month in ('August','September','October') then 'Q3'
	when month in ('November','December','January') then 'Q4'
end as quarter,

(quarter || ',' || inside) as quarter_new

from table1 p

left join profile_76928 p1 on p1._id = p.d1_update
where start_year is not null*/