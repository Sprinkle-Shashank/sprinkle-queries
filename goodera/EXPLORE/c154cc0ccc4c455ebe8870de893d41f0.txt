with temp as (
  Select 'NEW' as col
  union all
    Select 'RENEW' as col
  union all
    Select 'REVISIT' as col
), 

 test2 as( 
Select fy_timerange,projectid, tag2.name as clinic_type,g_total_new as final_sum, tag1.name as s_clinic_type,
sum(case col
    when 'NEW' then p.NEW
	when 'RENEW' then p.RENEW
	when 'REVISIT' then p.REVISIT
	else NULL
   end)as Search_status
from profile_63885 p
left join profile_59462 p1
left join ds_mysql_prod_tagelement tag1
on tag1.id = p1.s_clinic_type
left join ds_mysql_prod_tagelement tag2
on tag2.id = p.clinic_type
where tag1.name != 'OPD'
         
),

final as (
      select concat(cast(fy_timerange.start as varchar), concat('|', cast(fy_timerange.end as varchar))) as fy_timerange, projectid, Search_status,clinic_type,
    sum(final_sum) as final_sum
      from test2 
      where final_sum is not null
      group by 1,2,3,4

)

select fy_timerange, project.name as projectid, search_status,sum(final_sum) as final_sum
from final left join ds_mysql_prod_project as project
on project.id = final.projectid where projectid like '%%'
group by 1,2,3