with s as 
(Select name as site,('FY '||EXTRACT(YEAR FROM(CAST(startdate AS datetime)))||'-'||substring(EXTRACT(YEAR FROM(CAST(startdate AS datetime)))+1,3,2) )as year,fy_timerange,datatablebase,tablesettings,questiontext
from sus_64073
where keyword= 'emission_factor_fuel_type'
)
,
s2 as(
Select site,year,fy_timerange,questiontext, cast(coun.em_coal.unit_em_factor as varchar) coal_unit,cast(coun.em_natural_gas.unit_em_factor as varchar) ,cast(coun.em_petcoke.unit_em_factor as varchar) ,cast(coun.em_petrol.unit_em_factor as varchar) ,cast(coun.em_diesel.unit_em_factor as varchar) ,cast(coun.em_fo.unit_em_factor as varchar) ,cast(coun.em_sacoal.unit_em_factor as varchar) ,cast(coun.em_anthra.unit_em_factor as varchar) ,cast(coun.em_lubes.unit_em_factor as varchar) ,cast(coun.em_plastics.unit_em_factor as varchar) ,cast(coun.em_indocoal.unit_em_factor as varchar) ,
  coun.em_coal.emission_factor,coun.em_natural_gas.emission_factor,coun.em_petcoke.emission_factor,coun.em_petrol.emission_factor,coun.em_diesel.emission_factor,coun.em_fo.emission_factor,coun.em_sacoal.emission_factor,coun.em_anthra.emission_factor,coun.em_lubes.emission_factor,coun.em_plastics.emission_factor,coun.em_indocoal.emission_factor from s as p, unpivot p.datatablebase as coun at xyz
),
s3 as (
Select 'Lubricants- consumed for self Cogen / trigen' as col
 union all
Select 'Lubricants- consumed for self - generation of Heat' as col
  union all
Select 'Lubricants- consumed for self - generation of Steam' as col
  union all
Select 'Lubricants- consumed for self - generation of Cooling' as col
  
)

Select site,year financialPeriod,fy_timerange,questiontext questions,s3.col as source,
case col
	  when 'Lubricants- consumed for self Cogen / trigen' then s2.Cogen_trigen_unit
	    when 'Lubricants- consumed for self - generation of Heat' then s2.Heat_ren_unit
	    when 'Lubricants- consumed for self - generation of Steam' then s2.steam_ren_unit
	   when 'Lubricants- consumed for self - generation of Cooling' then s2.Cool_ren_unit
	   else null
	   end as Unit,
sum(case col
		when 'Lubricants- consumed for self Cogen / trigen' then s2.lubri_cogen_trigen
	    when 'Lubricants- consumed for self - generation of Heat' then s2.lubri_heat
	    when 'Lubricants- consumed for self - generation of Steam' then s2.lubri_steam
	   when 'Lubricants- consumed for self - generation of Cooling' then s2.lubri_cooling
	else null
	end) as Values

	from s2
	cross join s3
group by 1,2,3,4,5,s2.Cogen_trigen_unit,s2.Heat_ren_unit,s2.steam_ren_unit,s2.Cool_ren_unit
