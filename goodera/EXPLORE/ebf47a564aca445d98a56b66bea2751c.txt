with tab1 as (select cast(q.name as varchar) as project_code,f.name as fy,m.name as manager
from profile_27420 d
left join ds_mysql_prod_tagelement f on
d.fy=f.id
left join ds_mysql_prod_tagelement m on
d.project_manager=m.id
left join profile_27396 q on
d.project_code=q._id
		   
union all
		   
select cast(c.name as varchar)as project_code,f.name as fy,m.name as manager 
from profile_27396 c	
left join ds_mysql_prod_tagelement f on
c.fy=f.id
left join ds_mysql_prod_tagelement m on
c.project_manager=m.id
where manager is not null
group by project_code,f.name,m.name),

tab2 as(select split_part(prod.name,'|',3) as CensusCode,k.village, cast(q.name as varchar) project_code,q1.name as fy from profile_29974 p 
left join profile_27396 q
on q._id=p.prj_code
left join ds_mysql_prod_project prod on
prod.id=p.projectid
left join ds_mysql_prod_tagelement q1 on
q1.id=p.fy
left join profile_27489 k on
split_part(prod.name,'|',3)=k.name
		
where k.village is not null
group by project_code,q1.name,split_part(prod.name,'|',3),k.village),

tab3 as (select p.total_cost_yearly as Total_Direct_Budget, p.hdfc_cost_yearly as HDFC_Bank_Contribution, p.gov_cost_yearly as Government_Contribution, p.comm_cost_yearly as Community_Contribution_by_fy,cast(q.name as varchar) as project_code,q1.name as fy from profile_29973 p 
left join profile_27396 q
on q._id=p.prj_code
left join ds_mysql_prod_tagelement q1 on
q1.id=p.fy)

select t1.project_code,t1.fy,t1.manager,t2.village,t3.Total_Direct_Budget,t3.HDFC_Bank_Contribution,t3.Government_Contribution,t3.Community_Contribution_by_fy from tab1 t1
left join tab2 t2 on
t1.project_code=t2.project_code
left join tab3 t3 on 
t1.project_code=t3.project_code

