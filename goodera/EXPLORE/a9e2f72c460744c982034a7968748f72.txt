with table1 as (select projectId , cou.name as country , date , mgmt_rep , worker_rep ,  mgmt_rep_2 , worker_rep_2 ,  mgmt_rep_2 + worker_rep_2 as n1 , mgmt_rep + worker_rep as d1 , n1*1.0/d1 as avg1 ,'Communication in the workplace' as module
from profile_16619 as p1
				 
left join ds_mysql_prod_project fac
on p1.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id
				 
where date is not null 
group by  p1.date , p1.projectId , cou.name ,module, mgmt_rep , worker_rep ,  mgmt_rep_2 , worker_rep_2 ),

table2  as (select projectId , cou.name as country ,date_2 , mgmt_rep , worker_rep ,  mgmt_rep_3 , worker_rep_3 ,  mgmt_rep_3 + worker_rep_3 as n2 , mgmt_rep + worker_rep as d2 , n2*1.0/d2 as avg2 , 'Role and responsibilities in BC' as module
from profile_16619 as p2
			
left join ds_mysql_prod_project fac
on p2.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id		
			
where date_2 is not null 
group by  date_2 , p2.projectId , cou.name,module,mgmt_rep , worker_rep ,  mgmt_rep_3 , worker_rep_3
)

,

table3  as (select projectid,cou.name as country,date_3 ,mgmt_rep , worker_rep ,  mgmt_rep_4 , worker_rep_4 , mgmt_rep_4 + worker_rep_4 as n3 , mgmt_rep + worker_rep as d3 , n3*1.0/d3 as avg3 , 'Risk assessment' as module
from profile_16619 as p3
			
left join ds_mysql_prod_project fac
on p3.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id			
			
where date_3 is not null 
group by  projectid,cou.name,p3.date_3 , p3.mgmt_rep_4 , p3.worker_rep_4 , p3.mgmt_rep , p3.worker_rep,module
)


,


table4  as (select projectid,cou.name as country,date_4 ,mgmt_rep , worker_rep ,  mgmt_rep_5 , worker_rep_5 , mgmt_rep_5 + worker_rep_5 as n4 , mgmt_rep + worker_rep as d4 , n4*1.0/d4 as avg4 , 'Problem solving' as module
from profile_16619 as p4
left join ds_mysql_prod_project fac
on p4.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id			
			
where date_4 is not null 
group by  projectid,cou.name,p4.date_4 , module,mgmt_rep , worker_rep ,  mgmt_rep_5 , worker_rep_5
)

,

table5  as (select projectid,cou.name as country, date_5 ,mgmt_rep , worker_rep ,  mgmt_rep_6 , worker_rep_6 , sum(mgmt_rep_6 + worker_rep_6) as n5 , sum(mgmt_rep + worker_rep) as d5 , CAST(n5 AS float) / CAST(d5 AS float) as avg5 , 'Managing Health and Safety' as module
from profile_16619 as p5
			
left join ds_mysql_prod_project fac
on p5.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id				
where date_5 is not null 
group by  projectid,cou.name,p5.date_5 , p5.mgmt_rep_6 , p5.worker_rep_6 , p5.mgmt_rep , p5.worker_rep,module
)

,

table6  as (select projectid,cou.name as country, date_6 ,mgmt_rep , worker_rep ,  mgmt_rep_7 , worker_rep_7 , mgmt_rep_7 + worker_rep_7 as n6 , mgmt_rep + worker_rep as d6 , CAST(n6 AS float) / CAST(d6 AS float) as avg6 , 'Grievance Mechanisms' as module
from profile_16619 as p6
			
left join ds_mysql_prod_project fac
on p6.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id			
where date_6 is not null 
group by  projectid,cou.name,p6.date_6 , p6.mgmt_rep_7 , p6.worker_rep_7 , p6.mgmt_rep , p6.worker_rep,module
)


,

table7  as (select projectid,cou.name as country,date_7 ,mgmt_rep , worker_rep ,  mgmt_rep_8 , worker_rep_8 , mgmt_rep_8 + worker_rep_8 as n7 , mgmt_rep + worker_rep as d7 , CAST(n7 AS float) / CAST(d7 AS float) as avg7 , 'Negotiation skills' as module
from profile_16619 as p7
			
left join ds_mysql_prod_project fac
on p7.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id				
where date_7 is not null 
group by  projectid,cou.name,module,p7.date_7 , p7.mgmt_rep_8 , p7.worker_rep_8 , p7.mgmt_rep , p7.worker_rep
)

,

table8  as (select projectid,cou.name as country,date_8 ,mgmt_rep , worker_rep ,  mgmt_rep_9 , worker_rep_9 , sum(mgmt_rep_9 + worker_rep_9) as n8 , sum(mgmt_rep + worker_rep) as d8 , CAST(n8 AS float) / CAST(d8 AS float) as avg8 , 'Strengthening Industrial Relations' as module
from profile_16619 as p8
left join ds_mysql_prod_project fac
on p8.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id			
where date_8 is not null 
group by projectid,cou.name,module, p8.date_8 , p8.mgmt_rep_9 , p8.worker_rep_9 , p8.mgmt_rep , p8.worker_rep
)

select projectid,country,date,mgmt_rep , worker_rep ,  mgmt_rep_2 , worker_rep_2 , n1,d1, avg1 from table1
Union all
select projectid,country,date_2,mgmt_rep , worker_rep ,  mgmt_rep_3 , worker_rep_3 , n2,d2, avg2 from table2