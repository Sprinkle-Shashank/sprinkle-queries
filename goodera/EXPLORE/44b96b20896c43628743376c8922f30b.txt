with sub1 as(
select projectId, fy_timerange, p_d, p_d_attendance, academics, academics_attendance, lifeskills, lifeskills_attendance, (p_d+academics+lifeskills) as total_sessions from profile_52389),
sub2 as (
select projectId, fy_timerange, p_d, p_d_attendance, academics, academics_attendance, lifeskills, lifeskills_attendance, total_sessions, count(*), average(p_d_attendance+academics_attendance+lifeskills_attendance) as avg_attendance from sub1 group by projectId, fy_timerange, p_d, p_d_attendance, academics, academics_attendance, lifeskills, lifeskills_attendance, total_sessions)
select projectId, fy_timerange, p_d, p_d_attendance, academics, academics_attendance, lifeskills, lifeskills_attendance, total_sessions,count, 
--(p_d_attendance+academics_attendance+lifeskills_attendance)/3 as 
avg_attendance from sub2 order by fy_timerange asc