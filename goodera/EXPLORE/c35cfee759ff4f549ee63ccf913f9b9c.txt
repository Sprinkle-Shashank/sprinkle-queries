with table1 as(select datatable,xprojectId,time.name as Time_period,split_part(split_part(fy_timerange,'|',1),'-',1) as time

  from sus_59938 sus

Left join ds_mysql_prod_tagelement time
on sus.financialperiod = time.id

where keyword in ('emp_turnover')
),table3 as(
select xprojectId,t1.Time_period,t1.time,table2.turnover_type, table2.gender, SUM(table2.value) as total from table1 t1, unpivot t1.datatable  table2

group  by xprojectId,t1.Time_period,t1.time,table2.turnover_type , table2.gender
  
),

table4 as (select t3.*,CAST(wt as varchar),  t3.gender gn from table3 t3,t3.turnover_type wt 
)

SELECT wtype.name as wt, gtype.name as gn , xprojectId,t4.Time_period,t4.time,total  

from table4 t4
case when gn = 960512 
then gn = 'Male' ,
when gn = 960513 
then gn = 'Female' ,
when gn = 960514
then gn = 'Overall'
end as gn
LEFT JOIN ds_mysql_prod_tagelement wtype on
t4.wt = wtype.id
