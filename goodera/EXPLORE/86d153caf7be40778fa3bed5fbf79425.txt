with tab1 as(select t2.name as fy1,split_part(split_part(p.name,'[',1),'-',1) as project_code,t.name as tranche,p.uc,case when p.amnt_nt_utlzd is null then 0 else p.amnt_nt_utlzd  end as amnt_not_utilised,case when p.payment_amount is null then 0 else p.payment_amount  end as amnt_disbursed,concat(project_code,fy1) as CODE from profile_27398 p
left join ds_mysql_prod_tagelement t
on p.tranche=t.id
left join ds_mysql_prod_tagelement t2
on p.fy=t2.id),
Base1 as
(select p.name as project_code,f.name as fy1,concat(project_code,fy1) as CODE,m.name  as project_manager from profile_27396 p
left join ds_mysql_prod_tagelement m on
p.project_manager=m.id
left join ds_mysql_prod_tagelement f on
p.fy=f.id
union
select l.name as project_code,f.name as fy1,concat(project_code,fy1) as CODE,m.name as project_manager
from profile_27420 p
left join profile_27396 l on
p.project_code=l._id
left join ds_mysql_prod_tagelement m on
p.project_manager=m.id
left join ds_mysql_prod_tagelement f on
p.fy=f.id
),
base2 as(select p.project_code,p.fy1,l.project_manager,p.tranche,p.amnt_not_utilised,p.amnt_disbursed,p.CODE,l.CODE from tab1 p left join Base1 l on p.CODE=l.CODE)

select * from base2