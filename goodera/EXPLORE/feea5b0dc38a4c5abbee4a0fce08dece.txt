WITH t1 AS (
SELECT *
FROM (
SELECT p.month_timerange, p.kannada, p.evs, p.maths, p.science, p.social_science, p.hindi, p.computer, p.english, p1.schoolname AS school
FROM profile_60441 p
LEFT JOIN profile_60437 p1 ON p1._id = p.sats
)


with t1 as
(SELECT * 
FROM
(Select   p.month_timerange, p.kannada, p.evs, p.maths, p.science, p.social_science, p.hindi, p.computer, p.english,p1.schoolname as school from profile_60441 p
 left join profile_60437 p1
on p1._id= p.sats
 
)
UNPIVOT (
    val FOR dim IN ( kannada, evs, maths, science, social_science, hindi, computer, english))

)

select school, month_timerange as fy_timerange,   avg(val) as val,dim  from t1 as p
   where val is not null 
Group By school, fy_timerange,dim
  


