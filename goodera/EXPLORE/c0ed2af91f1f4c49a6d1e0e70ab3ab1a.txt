with table1 as 
(
   select p1.* from profile_63438 as p1
 )

select p.projectId, cou.name as country, ven.name as vendor, total_score, trainer_organization,  case when extract(month from date)=1 then (extract(year from date)-1) else extract(year from date) end as year,
count(p.projectId) as post_worker_respondents_total 
from profile_65221 p

left join table1 on 
p._id = table1.survey

left join ds_mysql_prod_project fac
on p.projectid = fac.id

left join ds_mysql_prod_project ven
on fac.parent = ven.id

left join ds_mysql_prod_project cou
on ven.parent = cou.id



-- group by p.projectId, worker_leave, timeline_miss, supervisor_loud, worker_late, supervisor_overall, conflict, wages, discussion, profile_63438.trainer_organization, total_score,  cou.name, ven.name, year

group by table1.trainer_organization, total_score, country, vendor, year, p.projectId
