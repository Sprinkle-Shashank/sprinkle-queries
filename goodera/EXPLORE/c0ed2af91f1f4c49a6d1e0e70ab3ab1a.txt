with table1 as 
(
   select p1.*,cast(survey as varchar), trainer_organization as trainer_org from profile_63438 as p1, p1.survey_arr survey
 )
 

select p.projectId, cou.name as country, ven.name as vendor, total_score , tabl1.tra_i.name as training_id, table1.trainer_org , case when extract(month from date)=1 then (extract(year from date)-1) else extract(year from date) end as year,
count(p.projectId) as post_worker_respondents_total 
from profile_65221 p

left join table1 on 
p._id = table1.survey


left join ds_mysql_prod_tagelement tra_i 
on table1.training_id = tra_i.id

left join ds_mysql_prod_project fac
on p.projectid = fac.id

left join ds_mysql_prod_project ven
on fac.parent = ven.id

left join ds_mysql_prod_project cou
on ven.parent = cou.id

group by   table1.trainer_org, total_score, country, vendor, year, p.projectId, training_id , tra_i.name
