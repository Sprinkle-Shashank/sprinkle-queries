with sub1 as(
with temp as(
  Select 'male' as col
  union all
  Select 'female' as col
)
Select t2.name as sq.projectId, fy_timerange, t1.name as school_2, session_topic,temp.col as Gender,p1.name as location_filter,
avg(case col
	when 'male' then sq.attendance_male
	when 'female' then sq.attendance_female
end)as Attendance
FROM profile_75010 sq
cross join temp
left join ds_mysql_prod_project p1
ON sq.projectId=p1.id  
LEFT JOIN ds_mysql_prod_project t1
ON t1.id=sq.school_2
LEFT JOIN ds_mysql_prod_project t2
ON t1.id=sq.projectId
GROUP BY t2.name, fy_timerange, t1.name, session_topic, Gender,p1.name
 )
  Select projectId, fy_timerange, school_2, session_topic, Gender, split_part(location_filter ,'-',3) as location_filter,Attendance
  FROM sub1