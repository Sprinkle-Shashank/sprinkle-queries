with sub1 as(
  select p1.name as projectid, a.timerange_timerange as fy_timerange, t1.name as class, a.kali_id,  
row_number() over (partition by a.kali_id order by a.timerange_timerange.start desc) as row,
  
(attend_days_2 / nullif(tot_days_2,0)) * 100 as attend_2
  
from profile_54071 a

left join ds_mysql_prod_project p1 on p1.id = a.projectid
left join ds_mysql_prod_tagelement t1 on t1.id = a.class)

select s1.projectid, s1.fy_timerange, s1.class, s1.kali_id, s1.attend_2

from sub1 s1

where row = 1

group by s1.projectid, s1.fy_timerange, s1.class, s1.kali_id, s1.attend_2


