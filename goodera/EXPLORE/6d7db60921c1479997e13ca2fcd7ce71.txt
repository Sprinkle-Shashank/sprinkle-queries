with sub1 as(
  select vendor_name, vendor_vms_id, vendor_region, factory_name, factory_cdms_id, fy_timerange,
dense_rank() over(order by fy_timerange.start desc) as row
from profile_81459)

select vendor_name, vendor_vms_id, count(*) as vendor_factories
from sub1 
where row = 1
group by vendor_name, vendor_vms_id