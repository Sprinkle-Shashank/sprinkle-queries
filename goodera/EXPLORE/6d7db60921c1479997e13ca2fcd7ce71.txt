with sub1 as(
  select p1._id as id, p1.factory_id, nvl(t1.name, 'NULL')  as cr_tier_new, 
  nvl(t2.name, 'NULL') as cr_rating_new,
extract(year from cast(p1.timeperiod_timerange.start as date)) as year
  
from profile_60928 p1
  
left join ds_mysql_prod_tagelement t1 on t1.id = p1.cr_tier
left join ds_mysql_prod_tagelement t2 on t2.id = p1.curr_cr_rating

where p1.factory_id is not null 
and cr_tier_new not in ('Exit', 'Deactivated')
and cr_rating_new not in ('Gray', 'Red', 'White', 'No Rating') and s2.year > 2019  
)

select * from sub1