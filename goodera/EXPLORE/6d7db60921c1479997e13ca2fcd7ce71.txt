with sub1 as(
  select p1.factory_id, p2.cr_tier, p2.source_div, p2.region, p2.curr_cr_rating,
  
row_number() over (partition by p1.factory_id order by p2.timeperiod_timerange.start) as row,
  
extract(year from cast(p1.timeperiod_timerange.start as date)) as year
  
from profile_60928 p1

left join profile_60928 p2 on p2.factory_id = p1.factory_id

where p1.factory_id is not null)

select * from sub1
