with sub1 as(
  select p1.kali_id, p1.timerange_timerange as fy_timerange, t1.name as class, 
row_number () over (partition by p1.kali_id order by p1.timerange_timerange.start desc) as row

from profile_54071 p1
left join ds_mysql_prod_tagelement t1 on t1.id = p1.class)

select s1.kali_id, s1.fy_timerange, s1.class, 1 as count
from sub1 s1
where row = 1

group by s1.kali_id, s1.fy_timerange, s1.class
