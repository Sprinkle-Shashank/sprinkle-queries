with t1 as 
( 
  select  p3.name as projectId, tag1.name as training_type, tag2.name as  year, p1.num_workers, num_management, p1._id,  tag3.name as country,p2.vendor, p2.cycle, tag4.name as consultant ,p2.product_category,
 

 case  when  p2.cycle is null then p2.cycle='null'
  else p2.cycle
 end as new_cycle
  
  from profile_61613 as p1
 
 left join profile_64362 as p2
on p1.projectId = p2.projectId
 left join ds_mysql_prod_project p3
on p1.projectId= p3.id
left join ds_mysql_prod_tagelement tag1
on p1.training_type = tag1.id
left join ds_mysql_prod_tagelement tag2
on p1.year = tag2.id
left join ds_mysql_prod_tagelement tag3
on p2.country = tag3.id
left join ds_mysql_prod_tagelement tag4
on p2.consultant_tag = tag4.id

),

 sub1  as(select a.*, unwind_cycle from t1 a,a.new_cycle as unwind_cycle)

 
select c._id, c.projectId,  c.training_type, c.year ,c.num_workers,c.num_management,c.country,  c.vendor,c.consultant   , c.cycle,tag5.name as un_cycle, c.product_category,
 case when  c.product_category = '[]' 
 then c.product_category is null
  
else c.product_category
  end as new_product_category
from sub1 c
left join ds_mysql_prod_tagelement tag5
on c.unwind_cycle = tag5.id 
