with sub1 as(
  select (p1.date_visit || '|' || p1.date_visit) as fy_timerange, t1.name as plant, p3.name as trucker_id,
row_number() over (partition by p3.name order by p1.date_visit asc) as row_num, 
extract(Month from p1.date_visit) as month, extract(Year from p1.date_visit) as year,
  
case
  when month = 1 then 'Jan'
  when month = 2 then 'Feb'
  when month = 3 then 'Mar'
  when month = 4 then 'Apr'
  when month = 5 then 'May'
  when month = 6 then 'Jun'
  when month = 7 then 'Jul'
  when month = 8 then 'Aug'
  when month = 9 then 'Sep'
  when month = 10 then 'Oct'
  when month = 11 then 'Nov'
  else 'Dec'
end as mon,
case
  when month < 10 then cast((0 || month) as INT)
  else month
end as mon_two,
  
(mon || '`' || year - 2000) as mon_year,
mon_two as month_sort
from profile_73098 p1
left join profile_73150 p2 on p2._id = p1.clinic
left join profile_73096 p3 on p3._id = p1.trucker_id
left join ds_mysql_prod_tagelement t1 on t1.id = p2.plant)

select s1.fy_timerange, s1.plant, s1.mon_year, s1.month_sort, s1.trucker_id, count(*) from sub1 s1
where s1.row_num > 1
group by s1.fy_timerange, s1.plant, s1.mon_year, s1.month_sort, s1.trucker_id