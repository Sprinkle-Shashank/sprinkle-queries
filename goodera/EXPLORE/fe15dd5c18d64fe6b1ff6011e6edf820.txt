with sub1 as(
  select p1.name as projectid, a.timerange_timerange as fy_timerange, t1.name as class, 
extract(year from cast(a.dob as date)) as birth_year, a.kali_id, 
extract(year from current_date) as current_year,
  
row_number() over (partition by a.kali_id order by a.timerange_timerange.start desc) as row
  
from profile_54071 a

left join ds_mysql_prod_project p1 on p1.id = a.projectid
left join ds_mysql_prod_tagelement t1 on t1.id = a.class)

select s1.projectid, s1.fy_timerange, s1.class, s1.kali_id, birth_year,

case
	when s1.current_year - s1.birth_year = 7 or s1.current_year - s1.birth_year = 8 
		then '7-8'
	when s1.current_year - s1.birth_year = 9 or s1.current_year - s1.birth_year = 10 
		then '9-10'
	when s1.current_year - s1.birth_year = 11 or s1.current_year - s1.birth_year = 12 
		then '11-12'
	when s1.current_year - s1.birth_year > 12 then 'Above 12'
	else NULL
end as age_bucket

from sub1 s1
where row = 1