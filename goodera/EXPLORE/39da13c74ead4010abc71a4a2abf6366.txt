with table1 as 
(
   select p.projectid , p._id , 
  case when p.name_subunit is null or p.name_subunit=' ' then 'N/A' else p.name_subunit end  as unit , ven.name as vendor , cou.name as country 
  
  , fac.name as factory , factory_id  ,  case when extract(month from date_enrollment)=1 then (extract(year from date_enrollment)-1) else extract(year from date_enrollment) end as batch  from profile_16619 as p
  
left join ds_mysql_prod_project fac 
on p.projectId = fac.id

left join ds_mysql_prod_project ven 
on fac.parent = ven.id

left join ds_mysql_prod_project cou 
on ven.parent = cou.id
  
left join profile_4722 p2 on
 p.projectid = p2.projectid  
 
where status != 437658 and status != 437659
  )
  
  select * from table1