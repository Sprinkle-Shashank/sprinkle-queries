with sub1 as(
  select p1.*,
cast(timestamp 'epoch' + CAST(p1.eventdate AS BIGINT)/1000 * interval '1 second' as varchar) as event_date,
cast(timestamp 'epoch' + CAST(p1.created AS BIGINT)/1000 * interval '1 second' as varchar) as create_date,
is_array(p1.focus_area) as array_check,
case
	when array_check = false then array(p1.focus_area)
	else p1.focus_area
end as focus_area_new
from profile_26729 p1),

sub2 as(
  select s1.*, focus_area from sub1 s1, s1.focus_area_new focus_area)
  
select s2._id as id, nvl(s2.one_day_date, s2.long_term_start_date, s2.event_date, s2.create_date) as start_date,
nvl(s2.one_day_date, s2.long_term_end_date, s2.event_date, s2.create_date) as end_date,
nvl(s2.country, s2.officecountry) as country, t1.name as focus_area, t2.name as focus_area_2, s2.hours_contributed as hours
from sub2 s2
left join ds_mysql_prod_refFocusArea t1 on t1.id = s2.focus_area
left join ds_mysql_prod_tagElement t2 on t2.id = s2.focus_area_2