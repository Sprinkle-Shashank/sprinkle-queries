SELECT
P.name AS projectId,
SH.quarter_timerange AS fy_timerange,
AVG(SH.attendance),
COUNT(SH.shalini) AS shalinis,

CASE
	WHEN SH.attendance < 60 THEN 'Below 60%'
	WHEN SH.attendance >= 60 AND SH.attendance <= 80 THEN '60-80%'
	WHEN SH.attendance > 80 THEN 'Above 80%'
END AS attendance_type 

FROM profile_55296 AS SH

LEFT JOIN ds_mysql_prod_project AS P
ON SH.projectId = P.id

--LEFT JOIN profile_55294 AS B
--ON SH.shalini = B._id

GROUP BY P.name, SH.quarter_timerange, SH.attendance



/*
WITH tab1 as(Select p1.quarter_timerange,p1.attendance as attendance1,p2.name as shalini,
CASE
	WHEN EXTRACT (Month from cast(p1.quarter_timerange.start as date))=01 then 'Q1'
	WHEN EXTRACT (Month from cast(p1.quarter_timerange.start as date))=04 then 'Q2'
	WHEN EXTRACT (Month from cast(p1.quarter_timerange.start as date))=07 then 'Q3'
	WHEN EXTRACT (Month from cast(p1.quarter_timerange.start as date))=10 then 'Q4'
END AS Quarter
from profile_55296 p1
left join profile_55294 p2
on p1.shalini=p2._id
group by p1.quarter_timerange,p2.name,Quarter,p1.attendance)

Select Quarter,shalini,count(shalini),
CASE
	WHEN attendance1<60 then 'Below 60%'
	WHEN attendance1>=60 and  attendance1<=80 then '60-80%'
	WHEN attendance1>80 then 'Above 80%'
END AS types
From tab1
group by types,Quarter,shalini
*/



/*CAST(p1.quarter_timerange.start AS DATE) AS start,
EXTRACT(MONTH FROM start) AS month,
EXTRACT(YEAR FROM start) AS year,

CASE
	WHEN month = 1 THEN 'Q4'
	WHEN month = 2 THEN 'Q4'
	WHEN month = 3 THEN 'Q4'
	WHEN month = 4 THEN 'Q1'
	WHEN month = 5 THEN 'Q1'
	WHEN month = 6 THEN 'Q1'
	WHEN month = 7 THEN 'Q2'
	WHEN month = 8 THEN 'Q2'
	WHEN month = 9 THEN 'Q2'
	WHEN month = 10 THEN 'Q3'
	WHEN month = 11 THEN 'Q3'
	WHEN month = 12 THEN 'Q3'
	ELSE 'No Data Entry'
	END AS quarter,

CASE
	WHEN attendance<60 then 'Below 60%'
	WHEN attendance>=60 and  attendance<=80 then '60-80%'
	WHEN attendance>80 then 'Above 80%'
END AS types*/
/*group by quarter,year,month,start,p1.quarter_timerange,p2.name)*/

/*Select quarter_timerange,attendance1,
CASE
	WHEN attendance1<60 then 'Below 60%'
	WHEN attendance1>=60 and  attendance1<=80 then '60-80%'
	WHEN attendance1>80 then 'Above 80%'
END AS types,
count(shalini)
FROM tab1
group by quarter_timerange,attendance1,types*/