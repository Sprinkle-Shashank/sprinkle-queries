with Base1 as(select PCODE,Village,Planned,Actual,Month,fy_timerange,m.name as Project_Manager,focusarea,Activity_Category,Activity_Sub_Category(select split_part(split_part(prod.name,'|',1),'.',1) as PCODE,split_part(prod.name,'|',2) as Village,p.sub_cat_out_plan as Planned,p.subcat_output as Actual,m.name as Month,y.name as fy_timerange,f.name as focusarea,a.name as Activity_Category,s.name as Activity_Sub_Category from profile_54963
p left join ds_mysql_prod_project prod on
prod.id=p.projectid
left join ds_mysql_prod_tagelement f on
p.focus_area=f.id
left join ds_mysql_prod_tagelement a on
p.act_cat=a.id
left join ds_mysql_prod_tagelement s on
p.subcat=s.id
left join ds_mysql_prod_tagelement m on
p.month=m.id
left join ds_mysql_prod_tagelement y on
p.fy=y.id)
left join profile_27396 n on
PCODE=n.name
left join ds_mysql_prod_tagelement m on
n.project_manager=m.id)
,Base2 as(select 
		 fy_timerange,Project_Manager,PCODE,Village,focusarea,Activity_Category,Activity_Sub_Category,Month,count(Planned) as Plannned,count(Actual) from Base1 group by focusarea,Activity_Category,Activity_Sub_Category,Month,fy_timerange,Project_Manager,PCODE,Village)
select * from Base2