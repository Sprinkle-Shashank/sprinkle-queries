with Base1 as(select split_part(split_part(prod.name,'|',1),'.',1) as PCODE,p.sub_cat_out_plan as Planned,p.subcat_output as Actual,m.name as Month,y.name as fy_timerange,f.name as focusarea,a.name as Activity_Category,s.name as Activity_Sub_Category from profile_54963
p left join ds_mysql_prod_project prod on
prod.id=p.projectid
left join ds_mysql_prod_tagelement f on
p.focus_area=f.id
left join ds_mysql_prod_tagelement a on
p.act_cat=a.id
left join ds_mysql_prod_tagelement s on
p.subcat=s.id
left join ds_mysql_prod_tagelement m on
p.month=m.id
left join ds_mysql_prod_tagelement y on
p.fy=y.id),Base2 as(select fy_timerange,focusarea,Activity_Category,Activity_Sub_Category,Month,count(Planned) as Plannned,count(Actual) from Base1 group by focusarea,Activity_Category,Activity_Sub_Category,Month,fy_timerange)
select * from Base1