with table1 as 
(
  select projectId,
  cou.name as country , 
nvl2(SUBSTRING(ven.name, 1, POSITION(' (' in ven.name)), SUBSTRING(ven.name, 1, POSITION(' (' in ven.name)),ven.name) as vendor_name, case when vendor_name='' then ven.name else vendor_name end as vendor, fac.name as factory ,
case when country in ('India', 'Bangladesh', 'Sri Lanka')
then 'South Asia'
when country in ('China')
then 'North Asia'
when country in ('Guatemala', 'El Salvador', 'Dominican Republic')
then 'Americas'
when country in ('Philippines', 'Cambodia',  'Vietnam',  'Indonesia', 'Myanmar')
then 'South East Asia'
end as region , sub_unit as unit,
--cast(DATEPART(YEAR,p.date_enrollment) as varchar) as year_new ,

total_raised,total_raised_2,total_raised_3,total_raised_4,total_raised_5,total_raised_6,total_raised_7,total_raised_8,total_raised_9, 
   case when rights_based is null then 0 else rights_based end ,
   case when rights_based_2 is null then 0 else rights_based_2 end ,
   case when rights_based_3 is null then 0 else rights_based_3 end ,
   case when rights_based_4 is null then 0 else rights_based_4 end ,
   case when rights_based_5 is null then 0 else rights_based_5 end ,
   case when rights_based_6 is null then 0 else rights_based_6 end ,
   case when rights_based_7 is null then 0 else rights_based_7 end ,
   case when rights_based_8 is null then 0 else rights_based_8 end ,
   case when rights_based_9 is null then 0 else rights_based_9 end ,
  
   case when interest_based is null then 0 else interest_based end ,
   case when interest_based_2 is null then 0 else interest_based_2 end ,
   case when interest_based_3 is null then 0 else interest_based_3 end ,
   case when interest_based_4 is null then 0 else interest_based_4 end ,
   case when interest_based_5 is null then 0 else interest_based_5 end ,
   case when interest_based_6 is null then 0 else interest_based_6 end ,
   case when interest_based_7 is null then 0 else interest_based_7 end ,
   case when interest_based_8 is null then 0 else interest_based_8 end ,
   case when interest_based_9 is null then 0 else interest_based_9 end ,
  
   case when resolved is null then 0 else resolved end ,
   case when resolved_2 is null then 0 else resolved_2 end ,
   case when resolved_3 is null then 0 else resolved_3 end ,
   case when resolved_4 is null then 0 else resolved_4 end ,
   case when resolved_5 is null then 0 else resolved_5 end ,
   case when resolved_6 is null then 0 else resolved_6 end ,
   case when resolved_7 is null then 0 else resolved_7 end ,
   case when resolved_8 is null then 0 else resolved_8 end ,
   case when resolved_9 is null then 0 else resolved_9 end 
    
from profile_16863
  
  
left join ds_mysql_prod_project fac
on projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id
  
  --where p.projectId ilike '%%' and cou.name <> 'Test Country' and (p.status = 1400365 or p.status is null)  and country <> 'GAP Inc.'

group by projectid,cou.name , fac.name , ven.name ,sub_unit , total_raised,total_raised_2,total_raised_3,total_raised_4,total_raised_5,total_raised_6,total_raised_7,total_raised_8,total_raised_9,      rights_based,rights_based_2,rights_based_3,rights_based_4,rights_based_5,rights_based_6,rights_based_7,rights_based_8,rights_based_9,  
interest_based,interest_based_2,interest_based_3,interest_based_4,interest_based_5,interest_based_6,interest_based_7,interest_based_8, interest_based_9,resolved,resolved_2,resolved_3,resolved_4,resolved_5,resolved_6,resolved_7,resolved_8,resolved_9
  )
  select projectId , country , factory , vendor , unit ,region ,  Sum(total_raised+total_raised_2+total_raised_3+total_raised_4+total_raised_5+total_raised_6+total_raised_7+total_raised_8+total_raised_9) as total_raised,     
sum( rights_based+rights_based_2+rights_based_3+rights_based_4+rights_based_5+rights_based_6+rights_based_7+rights_based_8+rights_based_9) as right_based, 
sum(interest_based+interest_based_2+interest_based_3+interest_based_4+interest_based_5+interest_based_6+interest_based_7+interest_based_8+interest_based_9) as interest_based,   
sum(resolved + resolved_2 + resolved_3 + resolved_4 + resolved_5 + resolved_6 + resolved_7 + resolved_8 + resolved_9) as resolved

from table1

group by projectid, country , factory , vendor , unit ,region 