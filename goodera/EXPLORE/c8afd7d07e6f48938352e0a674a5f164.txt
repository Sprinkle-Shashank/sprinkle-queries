with table1 as (
  select t3.name as projectid, p.fy_timerange,t1.pvh_id, t2.region, cast(p.fy_timerange.start as date) as start_date
  from profile_62491 p
	left join profile_62948 t1 on t1.projectid = p.projectid
	left join profile_60928 t2 on t1.pvh_id = t2.factory_id
	left join ds_mysql_prod_project t3 on t3.id = p.projectid
	),
	
table2 as(
  select projectid, fy_timerange, reg, start_date, pvh_id from table1, region reg)
	
select projectid, fy_timerange, pvh_id, last_value(reg) over (partition by projectid, pvh_id order by start_date desc rows between unbounded preceding and unbounded following) from table2

