with lookup as (select
				JSON_SERIALIZE(table_52810.pace_brands) as pace_brand,
				LISTAGG(DISTINCT projcode_vendor) as vendorcode,
				(projid_vendor) as vendorID,
				name_vendor_filter as vendorname,
				projid_country as country_id,
				listagg(DISTINCT projid_factory,',') as factory_list,
				case when pace_brand like '%1151834%' then 1 else 0 end  as brand
				from profile_54646 p
left join profile_52810 table_52810 on
table_52810.projectid=p.projectid
left join profile_4227 table_4227 on
table_4227.projectid=p.projectid
group by  name_vendor_filter,table_52810.pace_brands
order by profile_54646.name_vendor_filter)			   )
select * from lookup p where brand = 1









--select LISTAGG( projcode_vendor) as vendorcode, (projid_vendor) as vendorID, (projid_country) as countryID, LISTAGG(projid_factory) as factorylist, name_vendor_filter as vendorname, profile_52810.pace_brands from profile_54646

--INNER JOIN profile_52810 on
--	profile_54646.projectId = profile_52810.projectId
--where profile_52810.pace_brands LIKE 1151834

--group by name_vendor_filter,profile_52810.pace_brands,projid_country,projid_vendor
--,projcode_vendor

--order by profile_54646.name_vendor_filter



