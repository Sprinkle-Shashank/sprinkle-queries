with sub1 as (
  select p1.personal_vehicle as Personal_Vehicle, p1.motorbike_mileage as Motorbike, p1.bus_mileage as Bus,p1.train_mileage as Train,p1.metro_mileage as Metro, p1.walk_mileage as Walk, p1.bicycle_mileage as Bicycle, p1.other_mileage as Others, p1.tram_mileage as Tram, p1.scooter_mileage as Scooter from profile_64637 p1),
  
sub2 as(select 'Personal_Vehicle' as col
union all
select 'Motorbike' as col
union all
select 'Bus' as col
union all
select 'Train' as col
union all
select 'Metro' as col
union all
select 'Walk' as col
union all
select 'Bicycle' as col
union all
select 'Others' as col
union all
select 'Tram' as col
union all
select 'Scooter' as col)

select p2.name as projectId, p1.year_timerange as Timerange,sub2.col as dimensions, count as 1,
sum(
  case col
	when 'Personal_Vehicle' then p1.personal_vehicle
  	when 'Motorbike' then p1.motorbike_mileage
  	when 'bus_mileage' then p1.Bus
  	when 'Train' then p1.train_mileage
	when 'Metro' then p1.metro_mileage
	when 'Walk' then p1.walk_mileage
	when 'Bicycle' then p1.bicycle_mileage
	when 'Others' then p1.other_mileage
	when 'Tram' then p1.tram_mileage
	when 'Scooter' then p1.scooter_mileage
	else null
  end
  ) as commute_mileage,
  case
	when commute_type='Others' then 'Others'
	when commute_type='Personal Vehicle' then 'Car'
	when commute_type='Walk' then 'Walking/ Bike/E-Scooter/ E-Bike'
	when commute_type='Motorbike' then 'Motorbike/Scooter'
	when commute_type='Bicycle' then 'Walking/ Bike/E-Scooter/ E-Bike'
	else 'Public Transport'
end as commute

from sub2,sub1
  
cross join sub2
left join ds_mysql_prod_project p2 on p2.id= p1.projectId
where commute_mileage is not null and commute_mileage is 0)
  
