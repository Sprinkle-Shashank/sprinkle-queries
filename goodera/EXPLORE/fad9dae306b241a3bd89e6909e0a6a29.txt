
with temp1 as
(select m.projectid, m.indicator, m.proj, m.target, indi_parent.name as int_indi , project_code_new, cast(year as varchar) as year_update, indi.name,  r.vertical, r.focus, n1.state, r.direct_or_partner, r.district, r.csr, r.budget_outlay, r.entity
from profile_61044 as m
 
left join ds_mysql_prod_tagelement as indi
on m.indicator = indi.id
 
left join ds_mysql_prod_tagelement as indi_parent
on indi.parent = indi_parent.id
 
left join profile_62881 AS n1
on r.project_code_new = n1._id
 
 left join profile_55194 AS r 
on m.proj = r._id
 
 group by indicator, target, int_indi, project_code_new, year
),

temp2 as
(
  
select int_indi, year_update, indicator, project_code_new, vertical, focus,state, direct_or_partner, district, csr, entity, budget_outlay, sum(target) as target_update from temp1
  
  group by indicator, int_indi, year_update
  ),
temp3 as
(
select int_indi, year_update, indicator, project_code_new, vertical, focus,state, direct_or_partner, district, csr, entity, budget_outlay, concat(indicator,concat(' - ',target_updated)) from temp2
	
),
	
temp4 as 
(
select concat(year_update,concat(' - ',project_code_new)) as yearc, int_indi, year, indicator, project_code_new, vertical, focus,state, direct_or_partner, district, csr, entity, budget_outlay, month_timerange, amount, target_updated from temp3
						 				  
)
	
select * from temp4
				


