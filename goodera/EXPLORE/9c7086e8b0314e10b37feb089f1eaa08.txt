With temp as (
Select 'Male' as col
  union all
Select 'Female' as col
),
s1 as(
Select t2.name as projectIdd,t.name as proj_location,t1.name as partner,pl.location,po.impl_agency as imp_partner,
  --concat(concat(concat(concat('{"start":"', ss.start_date),'","end":"'),ss.end_date),'"}') as fy_timerange,
  ss.school_name,ss.class,sum(ss.no_girls) Female,sum(ss.no_boys) Male,ss.age
from profile_67673 ss
left join ds_mysql_prod_project t
on ss.projectid=t.id
left join ds_mysql_prod_project t1
on t.parent=t1.id
left join ds_mysql_prod_project t2
on t1.parent=t2.id
left join profile_65603 pl
on pl.projectid=ss.projectid
left join profile_65552 po
on t.parent=po.projectid
 group by proj_location, ss.class, 
  --fy_timerange, 
  partner, projectIdd, pl.location, imp_partner, ss.school_name,ss.age

),
s2 as (
Select s1.proj_location, s1.class, 
  --s1.fy_timerange,
  s1.partner, s1.projectIdd as projectid, tt2.name as location, tt3.name as imp_partner, s1.school_name,
'School' as center_school,
  case col 
  	when 'Male' then s1.male
   when 'Female' then s1.female
  else null
  end as benef,temp.col as gender,
case 
		when s1.age<=6 then 'Less than 6'
		when s1.age>=6 and s1.age<=10 then '6 to 10'
		when s1.age>=10 and s1.age<=15 then '10 to 15'
		when s1.age>=15 and s1.age<=18 then '15 to 18'
		when s1.age>=18 and s1.age<=35 then '18 to 35'
		when s1.age>=35 and s1.age<=60 then '35 to 60'
		else 'Greater than 60'
		end as age_bucket,st.name as state_code
from s1
  cross join temp
  left join profile_73573 st
on st.loc_select=s1.location
left join ds_mysql_prod_tagelement tt2
 on s1.location=tt2.id
left join ds_mysql_prod_tagelement tt3
 on s1.imp_partner=tt3.id
  ),
  
  s3 as (
  Select  s2.proj_location, 
	--s2.fy_timerange, 
	s2.partner, s2.projectId, s2.location, s2.age_bucket, s2.state_code, s2.center_school, s2.gender,sum(s2.benef) no_benef
	from s2
	group by s2.proj_location
	--, s2.fy_timerange
	, s2.partner, s2.projectId, s2.location, s2.age_bucket, s2.state_code, s2.center_school, s2.gender
  )
  
  Select * from s3