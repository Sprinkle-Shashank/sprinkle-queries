with test1 as(
select p.fy_timerange, p.projectid, 'Trucker' as f_category, 'Reactive' as hiv, p.hiv_reactive_truck as final_sum from profile_63886 p
  union all
select p.fy_timerange, p.projectid, 'Trucker' as f_category, 'On ART' as hiv, p.linked_art_truck as final_sum from profile_63886 p
  union all
select p.fy_timerange, p.projectid, 'Allied' as f_category, 'Reactive' as hiv, (p.hiv_reactive_allied + p.hiv_reactive_partner) as final_sum from profile_63886 p
  union all
select p.fy_timerange, p.projectid, 'Allied' as f_category, 'On ART' as hiv, (p.linked_art_allied + p.linked_art_partner) as final_sum from profile_63886 p
),

non_react as(
select p2.fy_timerange, p2.projectid, 'Trucker' as f_category, 'Non Reactive' as hiv, (p2.hiv_truckers - coalesce(p1.hiv_reactive_truck,0)) as final_sum from profile_63886 as p1, profile_63885 as p2
where p1.projectid = p2.projectid and p1.fy_timerange = p2.fy_timerange
  union all
select p2.fy_timerange, p2.projectid, 'Allied' as f_category, 'Non Reactive' as hiv, ((p2.hiv_allied + p2.hiv_partner)  - (coalesce(p1.hiv_reactive_allied,0) + coalesce(p1.hiv_reactive_partner,0))) as final_sum from profile_63886 as p1, profile_63885 as p2
where p1.projectid = p2.projectid and p1.fy_timerange = p2.fy_timerange
)

select p2.fy_timerange, p2.projectid, 'Allied' as f_category, 'Non Reactive' as hiv, p2.hiv_allied, p2.hiv_partner, coalesce(p1.hiv_reactive_partner,0), (coalesce(p1.hiv_reactive_allied,0), ((p2.hiv_allied + p2.hiv_partner)  - (coalesce(p1.hiv_reactive_allied,0) + coalesce(p1.hiv_reactive_partner,0))) as final_sum from profile_63886 as p1, profile_63885 as p2
where p1.projectid = p2.projectid and p1.fy_timerange = p2.fy_timerange