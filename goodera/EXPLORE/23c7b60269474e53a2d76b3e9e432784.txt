with item as 
(
select 'pre_assessment' as Assessment
union all
select 'post_assessment' as Assessment
)  

t1 as 
(select tag1.name as projectId, p1.fy_timerange, p1.pre_assessment, p1.post_assessment, p2.name as beneficiary, tag2.name as location, tag3.name as batch,
sum(case Assessment
when 'pre_assessment' then t1.pre_assessment
when 'post_assessment' then t1.post_assessment
else null
end) as Val, item.assessment as it
from profile_61656 p1
left join ds_mysql_prod_project tag1
on p1.projectId = tag1.id
left join profile_61651 p2
on p1.beneficiary = p2._id
left join ds_mysql_prod_tagelement tag2
on p2.location = tag2.id
left join ds_mysql_prod_tagelement tag3
on p2.batch = tag3.id),
cross join item 
)

select t1.projectId, t1.beneficiary, t2.it, t2.Val, t1.batch, t1.location
from t1, t2



  

