with table1 as
(
  select p.projectid , p._id , cou.name as country_1 , fac_c_i.name as fac_c_i_1 , vendor_n_i.name as vendor_n_i_1 , primary_category from profile_52810 as p
  
  left join ds_mysql_prod_tagelement cou on 
  p.country = cou.id 
  
  left join ds_mysql_prod_tagelement fac_c_i on
  p.fac_cl_vpid = fac_c_i.id
  
  left join ds_mysql_prod_tagelement vendor_n_i on
  p.vendor_ngo_id = vendor_n_i.id 
  
  ),
  
  
	table2 as 
	(
	  select p.projectid , p._id , country_1 , fac_c_i_1 , vendor_n_i_1 ,  listagg(primary_category) as primary_category_id from table1 p
	  
	  group by p.projectid , p._id , country_1 , fac_c_i_1 , vendor_n_i_1
	  ),
	
  table3 as
  (
select p.projectid , fac.name as factory_name, ven.name as vendor, cou.name as country , t2.country_1 , t2.fac_c_i_1 , t2.vendor_n_i_1 ,  t2.primary_category_id from profile_64075 p

left join ds_mysql_prod_project fac
on  p.projectid = fac.id

left join ds_mysql_prod_project ven
on fac.parent = ven.id

left join ds_mysql_prod_project cou
on ven.parent = cou.id
	
left join table2 t2 on 
	p.projectid = t2.projectid 
	)
	
	select * from table3
	
	