with table1 as
(
  select p.projectid , p._id , cou.name as country_1 , fac_c_i.name as fac_c_i_1 , vendor_n_i.name as vendor_n_i_1 , primary_category_id.name as primary_category_id_1  from profile_52810 as p
  
  left join ds_mysql_prod_tagelement cou on 
  p.country = cou.id 
  
  left join ds_mysql_prod_tagelement fac_c_i on
  p.fac_cl_vpid = fac_c_i.id
  
  left join ds_mysql_prod_tagelement vendor_n_i on
  p.vendor_ngo_id = vendor_n_i.id
  
  left join ds_mysql_prod_tagelement primary_category_id on
  p.primary_category = primary_category_id.id 
  
  ),
  
  table2 as 
	(
	  select p.projectid , listagg(primary_category_id_1) as primary_category_id_1 from table1 p 
	  
	  group by  p.projectid  
	  ),
	 
  
	  table4 as 
	  (
		 select p.projectid , p._id ,country_1 , row_number() over 
(partition by p.projectid
 order by p._id desc) as row from table1 p 
	  ), 
	  table5 as 
	  (
	select * from table4 where row=1 
		),
		

	 table6 as 
	 (
	    select p.projectid , p._id ,fac_c_i_1 , row_number() over 
(partition by p.projectid
 order by p._id desc) as row from table1 p 
	  ),
	  table7 as 
	  ( 
	select * from table6 where row=1 
		),
		
		
	table8 as 
	 (
	    select p.projectid , p._id , vendor_n_i_1 , row_number() over 
(partition by p.projectid
 order by p._id desc) as row from table1 p 
	  ),
	  table9 as 
	  (
	select * from table8 where row=1 
		),
	  
	
  table3 as
  (
select p.projectid , fac.name as factory_name, ven.name as vendor, cou.name as country , t4.country_1 , t6.fac_c_i_1 , t8.vendor_n_i_1 , t2.primary_category_id_1 from profile_64075 p

left join ds_mysql_prod_project fac
on  p.projectid = fac.id

left join ds_mysql_prod_project ven
on fac.parent = ven.id

left join ds_mysql_prod_project cou
on ven.parent = cou.id
	
left join table2 t2 on 
p.projectid = t2.projectid
	
left join table4 t4 on 
p.projectid = t4.projectid
	
left join table6 t6 on 
p.projectid = t6.projectid
	
left join table8 t8 on 
p.projectid = t8.projectid

	)
	
	select * from table5
	
	
	
	  
