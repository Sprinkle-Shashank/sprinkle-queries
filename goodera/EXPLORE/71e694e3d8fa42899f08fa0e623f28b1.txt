with sub1 as(
  select p1.indicator, is_array(p1.aggregation_logic) as logic_array_check,
case
	when (logic_array_check = false) then array(p1.aggregation_logic)
	else p1.aggregation_logic
end as logic_new
from profile_55604 p1),

sub2 as(
  select s1.*, logic from sub1 s1, s1.logic_new logic),
  
sub3 as(
  select s2.indicator, p2.year, p2.add_up_2
from sub2 s2
left join profile_78780 p2 on p2._id = s2.logic),

sub4 as(
  select s3.*, add_up from sub3 s3, s3.add_up_2 add_up)
  
select s4.indicator, t1.name as year_text, t2.name as add_up
from sub4 s4
left join ds_mysql_prod_tagelement t1 on t1.id = s4.year_text
left join ds_mysql_prod_tagelement t2 on t2.id = s4.add_up