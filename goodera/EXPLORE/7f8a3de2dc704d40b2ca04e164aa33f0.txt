with test0 as(Select p.* ,CAST(pace_goals as VARCHAR) from profile_76755 p
, p.pace_goals_arr pace_goals 
),
 test1 as(Select p.projectId , p.facility_name, p.pace, p.strategic_yn, p.year_timerange, p.country as country, p.director_region as director_region,p.pace_goals,p.facility_type,p.female_workers, p.pace_enrolled,

pace_enrolled*100/female_workers as pace_1,
p2.name_vendor_filter as vendor,
CASE
	WHEN 1=1
	THEN  1
	ELSE 0
	END
	AS count,
CASE WHEN pace_1 >= 50  THEN 'YES'
ELSE
'NO'
END AS result_kpi3,
((certified_mts*100.0)/certified_trainers) as master
--(cast(a1 as float)/cast(p1.certified_trainers as float)) AS master,
--cast(master as float),		 
,p1.certified_trainers , p1.certified_mts , p1.pace_introduced ,

CASE WHEN (pace = 'Yes') AND (master>30)  AND (pace_introduced = 57472) THEN 'YES'
ELSE 
'NO'
END AS result_kpi4,
CASE WHEN (result_kpi3 = 'YES') AND (result_kpi4 = 'YES') THEN 
'YES'
ELSE
'NO'
END AS final_result

from test0 p

left join profile_76895 p1
on p.pace_goals = p1._id

left join profile_54646 p2 
on p.projectid = p2.projectid


WHERE p.strategic_yn = 'Yes' AND  final_result = 'YES'
Group by  p.projectId, p.facility_name, p.strategic_yn, p.year_timerange, p.country,p.facility_type,p.female_workers, p.pace_enrolled,  vendor,p1.certified_mts,p1.pace_introduced,p1.certified_trainers,p.pace,
p.director_region,p.pace_goals,result_kpi3,result_kpi4,final_result
)
Select p.* from test1 p
--(pace_enrolled*100) AS p2, cast(p2 as float)/cast(female_workers as float) AS PACE,