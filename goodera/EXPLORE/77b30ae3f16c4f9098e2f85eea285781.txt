
with table1 as(Select p._id, p.fac_vpid,f_y.name as fy,mth.name as month,rating.name as facility_rating,profile_54646.name_country as country,profile_54646.name_vendor as partner,profile_54646.name_vendor_filter as partner_consolidated,concat(f_y.name,mth.name) as temp,
profile_52713.factory_vpid_1,status.name as pace_status,src.name as sourcing_yn,count(*) from profile_54267 p



left join profile_52713 on 
p.projectId= profile_52713.projectId

left join profile_54646 on 
p.projectId= profile_54646.projectId
left join ds_mysql_prod_tagelement f_y
on p.fy = f_y.id
left join ds_mysql_prod_tagelement mth
on p.month = mth.id
left join ds_mysql_prod_tagelement status
on p.pace_status = status.id
left join ds_mysql_prod_tagelement rating
on p.facility_rating = rating.id
left join ds_mysql_prod_tagelement src
on profile_52713.sourcing_yn = src.id

where pace_status = 845114 and sourcing_yn = 57472


group by p.fac_vpid,f_y.name ,mth.name ,rating.name,
profile_52713.factory_vpid_1,status.name ,src.name,profile_54646.name_country,profile_54646.name_vendor,profile_54646.name_vendor_filter,p._id,p.fy,p.month
 )
 
 Select sum(count),temp,facility_rating,_id from table1
 
 group by temp,facility_rating,_id
