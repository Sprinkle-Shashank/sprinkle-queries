with sub1 as(select p1.name as projectid,t1.name as financial_period,p1.fy_timerange,sum(datanumbase) as values,measureunitbase as units,('FY' || ' ' || split_part(financial_period, ' ', 2)) as FY,questiontext

from sus_56551 p1
left join ds_mysql_prod_tagelement t1 on t1.id=p1.financialPeriod
where keyword in('gri_energy_upstream_inbound', 'gri_energy_downstream_outbound', 'gri_energy_business_travel', 'gri_consumed_purchased') and datanumbase is not null
group by p1.name,t1.name,units,p1.fy_timerange,FY,questiontext),

sub2 as(
select 'Upstram-Inbound' as consumption_type
union all
select 'Downstream-Outbound' as consumption_type
union all
select 'Business Travel' as consumption_type
union all
select 'Electricity Purchased Outside Tata Chemicals' as consumption_type)

select projectid,financial_period,fy_timerange,consumption_type,units,FY,questiontext,values,
sum(
case consumption_type
when 'Upstram-Inbound' then 'gri_energy_upstream_inbound'
when 'Downstream-Outbound' then 'gri_energy_downstream_outbound'
when 'Business Travel' then 'gri_energy_business_travel'
when 'Electricity Purchased Outside Tata Chemicals' then 'gri_consumed_purchased'
else null
end ) as values,
case 
when FY='FY 2019-20' or FY='FY (2019-20)' then 'FY (2019-20)'
when FY='FY 2020-21' or FY='FY (2020-21)' then 'FY (2020-21)'
when FY='FY 2021-22' or FY='FY (2021-22)' then 'FY (2021-22)'
when FY='FY 2022-23' or FY='FY (2022-23)' then 'FY (2022-23)'
else null
end as financial_year
		
from sub1
cross join sub2
group by projectid,financial_period,fy_timerange,consumption_type,financial_year,FY,units,questiontext,sub1.values
