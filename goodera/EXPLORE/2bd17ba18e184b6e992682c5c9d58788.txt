with sub1 as(select p1.name as projectid,t1.name as financial_period,p1.fy_timerange,datanumbase

from sus_56551 p1
left join ds_mysql_prod_tagelement t1 on t1.id=p1.financialPeriod
where keyword= 'gri_energy_upstream_inbound', 'gri_energy_downstream_outbound', 'gri_energy_business_travel', 'gri_consumed_purchased'),

sub2 as(
select 'Upstram-Inbound' as consumption_type
union all
select 'Downstream-Outbound' as consumption_type
union all
select 'Business Travel' as consumption_type
union all
select 'Electricity Purchased Outside Tata Chemicals' as consumption_type),

sub3 as( select projectid,financial_period,fy_timerange,consumption_type,
sum(
case consumption_type
when 'Upstram-Inbound' then gri_energy_upstream_inbound
when 'Downstream-Outbound' then gri_energy_downstream_outbound
when 'Business Travel' then gri_energy_business_travel
when 'Electricity Purchased Outside Tata Chemicals' then gri_consumed_purchased
else null
end ) as values,
case consumption_type

