with tab1 as (select cast((split_part(prod.name,'|',1)) as varchar) as prj1,cast((split_part(split_part(prod.name,'|',1),'.',1)) as varchar) as prj2,prj_code,f.name as fy_timerange from profile_54963 p
left join ds_mysql_prod_project prod
on p.projectid=prod.id
left join ds_mysql_prod_tagelement f on
p.fy=f.id),
tab3 as (select q.prj2 as prj3,count(q.prj1) as c,q.fy_timerange,st from profile_27396 p, p.state st
		 left join tab1 q
		 on p._id=q.prj_code
		group by prj3,fy_timerange)

select t1.prj3,t1.c,t1.fy_timerange,t.name from tab3 t1
left join ds_mysql_prod_project t
on t.id=t1.st
 

 