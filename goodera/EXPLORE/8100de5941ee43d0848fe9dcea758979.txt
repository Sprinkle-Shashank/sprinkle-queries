with x as (select xprojectid, financialperiod,datatablebase from sus_9539 where keyword in ('company_vehicles')
		   and datatablebase is not null),
		   
temp2 as (select * ,temp1.type_company, temp1.fuel_company_type, temp1.fuel_company from x as temp,
		  unpivot temp.datatablebase as temp1 at row) ,
		 
 y as (select xprojectid,financialperiod,datatablebase,fuel_company,type_company,fuel_company_type from 
		temp2 ytemp,ytemp.type_company as type_company,ytemp.fuel_company_type as fuel_company_type),
 
  t as (select 'Emissions' as col
	   union all
	   select 'Consumption' as col),
	   
 z as (select t2.name as projectid, timerange.name as financialperiod, datatablebase, fuel_company, d.name as type_company,  d1.name as fuel_company_type, case d1.name when 'Petrol' then 0.00220904 
                                   when 'Diesel' then 0.00259411
	                               else   0
	                               end  as Multiplicationfactortotal,
	  (fuel_company*Multiplicationfactortotal) as CompanyVehicleconsumption,'Scope 1' as scope ,'Company Vehicles' as type
	   
from y 
 left join ds_mysql_prod_tagelement d1
on d1.id=y.fuel_company_type 
 left join ds_mysql_prod_tagelement d
on d.id=y.type_company
	   
left join ds_mysql_prod_project t1
on t1.id=y.xprojectid
left join ds_mysql_prod_project t2
on t2.id=t1.parent/*projectid*/
	   
left join ds_mysql_prod_tagelement quarter
on quarter.id=y.financialPeriod
left join ds_mysql_prod_tagelement half
on half.id=quarter.parent
left join ds_mysql_prod_tagelement fy
on fy.id=half.parent
left join ds_mysql_prod_tagelement timerange
on timerange.id=fy.parent/*time_timerange*/)
select * from z
--select z.projectid,z.financialperiod,z.scope,z.type
/*sum(case col
	when t.col = 'Emissions' then z.CompanyVehicleconsumption
	when t.col = 'Consumption' then z.fuel_company 
	else null													
	end ) as Total,
 t.col as Dim
from z 
cross join t*/
--from z
--group by z.projectid,z.financialperiod,z.scope,z.type
  

  
/* x (select year_timerange, subsection_title, content, report_section, gri_section,  djsi_section,

sort from  profile_62982 temp,temp.gri_sec as gri_section, temp.djsi_sec as djsi_section ) ,
x1 as (select year_timerange, subsection_title, content, report_section, d.name as gri_sec,  d1.name as djsi_sec,

sort from x 
	  
left join ds_mysql_prod_tagelement d1
on d1.id=x.djsi_section 
 left join ds_mysql_prod_tagelement d
on d.id=x.gri_section)
  select * from temp2*/

