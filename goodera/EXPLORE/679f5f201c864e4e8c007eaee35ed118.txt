with table1 as (Select p.profileid as pid1, p.status ,
			
				case when p.status = 'SUBMITTED' or p.status = 'PENDING_APPROVAL' then 1 else 0 end as status1,
				case when p.data.subcat_output is null then 0 else 1 end as output,
				data54963.fy as fy,
				data54963.month as month,
				json_serialize(approvalLog) as approvalStatus1,
				p.data.subcat_output as subcat_output1,
				reverse(reverse(SPLIT_PART((dataproj.name), '|',3))) as censusCode1,
				case when dataproj.parent = 18943 then dataproj.id else dataproj.parent end as parent1,
				case when dataproj.parent = 18943 then 'Cluster' else censusCode1 end as censusCode,
				f.name as fy_timerange1,
				m.name as Month1
				
			from ds_mongo_taskresponse p
				
left join profile_54963 data54963 on 
data54963._id = p.profileInstanceId
				
left join ds_mysql_prod_project dataproj on
dataproj.id = p.projectId
							
left join ds_mysql_prod_tagelement f on
data54963.fy=f.id
left join ds_mysql_prod_tagelement m on
data54963.month=m.id
),

table2 as (Select pid1, status1, output, fy, month, approvalStatus1, subcat_output1, parent1,censusCode, fy_timerange1, month1 ,
		   reverse(reverse(SPLIT_PART((data1.name), '|',1))) as projectCode,
		   reverse(reverse(SPLIT_PART((dataParent.name), '|',1))) as parentCode,
		   case when approvalStatus1 is null then '[]' else approvalStatus1 end as approvalStatus1
		   
		   from table1 p
left join ds_mysql_prod_project data1 on
data1.id = parent1
		   
left join ds_mysql_prod_project dataParent on
dataParent.id = parent1
)




Select * from table2 p where pid1 = '54963' and status1 = 1 and output = 1