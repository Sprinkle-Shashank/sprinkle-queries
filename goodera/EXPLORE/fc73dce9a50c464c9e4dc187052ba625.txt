with t1 as
(
  select p.projectId, proj.name as projectid_up, fy_timerange, p.allocated, allo.name as  allocated_up, p1.partner
  from profile_56357 as p
  
  left join profile_56342 p1
  on p.projectid = p1.projectid
  
  left join ds_mysql_prod_tagelement proj
  on p.projectId = proj.id
  
  left join ds_mysql_prod_tagelement allo
  on p.allocated = allo.id
  ),
  t2 as
  (
	select fy_timerange, sum(allocated_up) as allocated_up, projectid_up, partner from t1
	group by projectid_up, fy_timerange, partner
	order by projectid_up, partner ASC
	)
	select * from t2