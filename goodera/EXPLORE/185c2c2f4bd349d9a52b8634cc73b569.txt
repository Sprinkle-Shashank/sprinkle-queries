with table1 as(
select p.projectId , fac.name as factory ,p3.name as training_id, p.trainer_org, p.prospect_female, p.total_other_participants, p.prospect_total, p.prospect_male, p.remarks,
nvl2(SUBSTRING(ven.name, 1, POSITION(' (' in ven.name)), SUBSTRING(ven.name, 1, POSITION(' (' in ven.name)), ven.name) as vendor_name, case when vendor_name='' then ven.name else vendor_name end as vendor,
cou.name as country ,
 p2.fac_cl_vpid, p2.vendor_ngo_id,        --p2
primary_category1.name as primary_category ,         --p2
p3.year,sum(p3.num_supervisors) as num_supervisors, sum(p3.total_employed) as total_employed ,
avg(p3.saturation) as saturation, p3.timerange_timerange ,                       --p3
p4.date, single_multi1.name as training_type , p4.responsible_person,            --p4
p.num_male, p.num_female, p.total_supervisors,                 
to_char( p.date_1 ,'dd-mm-yyyy')as date_1 ,   
p7.users_sst,p7.gap_sst,
p6.male_certified , p6.female_certified                                 --
  
  
from profile_64075 p

left join ds_mysql_prod_project fac
on  p.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id


left join profile_52810 p2
on p.projectId = p2.projectId
left join profile_65283 p3
on p.projectId = p3.projectId
left join profile_61498 p4
on p.training_id = p4._id
left join profile_61483 p6
on p.projectId = p6.factory_name
left join profile_75144 p7
on p.projectId = p7.projectId
left join profile_61498 p5
on p.training_id = p3._Id

left join ds_mysql_prod_tagelement primary_category1 on
	p2.primary_category = primary_category1.id
left join ds_mysql_prod_tagelement single_multi1  on
	p4.single_multi = single_multi1.id




group by p.projectId ,fac.name ,ven.name ,cou.name ,p2.fac_cl_vpid, p2.vendor_ngo_id,p3.name , primary_category1.name , p3.year, p3.num_supervisors, p3.total_employed,
p3.saturation, p3.timerange_timerange,p4.date, single_multi1.name , p4.responsible_person, p.num_male, p.num_female, p.total_supervisors,p.date_1 , 
p7.users_sst,p7.gap_sst, p6.male_certified , p6.female_certified ,  p.training_id, p.trainer_org, p.prospect_female, p.total_other_participants, p.prospect_total, p.prospect_male, p.remarks
  )
  
  select projectId, trainer_org, num_female, num_male, total_other_participants, prospect_total, fac_cl_vpid, vendor_ngo_id, country, vendor, training_type, date_1,
CASE when saturation is null then 0 else saturation end as saturation, 
CASE when male_certified is null then 0 else male_certified end as male_certified,
CASE when female_certified is null then 0 else female_certified end as female_certified from table1
  
 -- where (projectId <> 31303 and projectId <> 46455 and projectId <> 54832 and projectId <> 31299) and projectId ilike'%%'
  
  group by projectId, trainer_org, num_female, num_male, total_other_participants, prospect_total, fac_cl_vpid, vendor_ngo_id, country, vendor, training_type, date_1, male_certified, female_certified, saturation