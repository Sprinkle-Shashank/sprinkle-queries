select p.fy_timerange,p2.name as van,p3.name as partner,p.name,p.bene_age,p.bene_gender as gender,t1.name as referral, t2.name as institutions, count(*), 1 as unique_count, t3.name as treatment_mode,
case
when t1.name is null then 0
else 1
end as referral_count

from profile_83301 p
left join tagElement_10099 t1 on p.ref_type = t1.id
left join tagElement_10099 t2 on p.referral_destination = t2.id
left join tagElement_10099 t3 on p.treatment_mode = t3.id
left join ds_mysql_prod_project p2 on p2.id=p.projectid 
left join ds_mysql_prod_project p3 on p3.id=p2.parent

where p.projectid like '%%'

group by p.fy_timerange,p2.name, p3.name, p.name,p.bene_age,p.bene_gender,t1.name, t2.name,t3.name