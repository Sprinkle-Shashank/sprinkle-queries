




with x as (select name as Project_code from profile_27396 
/*union all
select p1.name as Project_code from profile_29974 p2
left join profile_27396  p1 on p1._id=p2.prj_code*/
union all
select  p1.name as Project_code from profile_27420 p3
left join profile_27396  p1 on p1._id=p3.project_code
/*union all
select p1.name as Project_code from profile_27398 p4
left join profile_27396  p1 on p1._id=p4.project_name 
union all
select p1.name as Project_code from profile_27398 p5
left join profile_27396  p1 on p1._id=split_part(p5.project_renew,'[',1)*/
), /* project code from all profiles*/


y as  (Select p1.name as Project_Code, p7.name as ImplementingAgency,  p9.name as ProjectLive, p8.name as intervention_type, p10.name as CoreArea , concat(concat(split_part(p1.start_date,' ',1),' to '), split_part(p1.end_date,' ',1)) as duration,m.name as project_manager ,f.name as fy_timerange
from profile_27396 p1
/*left join profile_30171 p6 on
p1._id=p6.prj_code*/
	   
left join profile_27395 p7
on p7._id=p1.ngo_partner
left join profile_28235 p8
on p8._id=p1.intervention_type
left join ds_mysql_prod_tagelement p9
on p9.id=p1.monitoring_live
left join ds_mysql_prod_tagelement p10
on p10.id=p1.focus_area
/*left join profile_29974 p2 on
p1._id=split_part(split_part(p2.name,'|',1),'.',1)
left join profile_27420 p4 on
p1._id=p4.project_code*/
left join ds_mysql_prod_tagelement f on
p1.fy=f.id
left join ds_mysql_prod_tagelement m on
p1.project_manager=m.id
	 group by  p1.name,p7.name, p9.name,p8.name ,p10.name,duration,m.name ,f.name),
	 
z as (select  p1.name as Project_Code ,sum(p2.hdfc_cost_monthly+p6.monthly_cost+p4.curr_yr_budget) as AmountallocatedforthecurrentFYinINR
	 from profile_27396 p1
	  left join profile_30171 p6 on
p1._id=p6.prj_code
	 left join profile_29974 p2 on
p1._id=p2.prj_code
left join profile_27420 p4 on
p1._id=p4.project_code 
	 group by p1.name),
	 
Temp as (
  select 'AmountallocatedforQ1' as col
  Union all select 'AmountallocatedforQ2' as col
  Union all select 'AmountallocatedforQ3' as col
  Union all select 'AmountallocatedforQ2' as col)
	  

select  distinct x.*, y.ImplementingAgency, y.ProjectLive, y.intervention_type, y.CoreArea ,y.duration, z.AmountallocatedforthecurrentFYinINR,y.project_manager ,y.fy_timerange, Temp.AmountallocatedforQ1 from x 
left join y on y.Project_Code=x.Project_code
left join z on z.Project_Code=x.Project_code
,Temp



/*select sum(p2.hdfc_cost_monthly+p6.monthly_cost) as allocatedamount, t2.name as quarter from 
 profile_30171 p6 
left join profile_29974 p2 on
p6._id=split_part(split_part(p2.name,'|',1),'.',1)
left join ds_mysql_prod_tagelement t1
on p6.month_number=t1.id
left join ds_mysql_prod_tagelement t2
on t1.parent=t2.id
group by t2.name*/


/*,sum(p2.hdfc_cost_monthly+p6.monthly_cost) as AmountallocatedforQ1inINR, t2.name as quarter*/
 
	  /* left join ds_mysql_prod_tagelement t1
on p6.month_number=t1.id
left join ds_mysql_prod_tagelement t2
on t1.parent=t2.id*/




/*z as(select m.name as project_manager ,f.name as fy_timerange from profile_27396 p1
left join ds_mysql_prod_tagelement f on
p1.fy=f.id
left join ds_mysql_prod_tagelement m on
p1.project_manager=m.id
union all 
select m.name as project_manager, f.name as fy_timerange from profile_27420 p2
left join ds_mysql_prod_tagelement f on
p2.fy=f.id
left join ds_mysql_prod_tagelement m on
p2.project_manager=m.id)/* project manager and fy_timerange*/

select  * from x, y, z




/*select distinct p1.name as Project_code  , p7.name as ImplementingAgency,  p9.name as ProjectLive, p8.name as intervention_type, p10.name as CoreArea , concat(concat(split_part(p1.start_date,' ',1),' to '), split_part(p1.end_date,' ',1)) as duration, (p2.hdfc_cost_monthly+p6.monthly_cost/*+p4.curr_yr_budget*/) as AmountallocatedforthecurrentFYinINR
from profile_27396 p1
left join profile_27420 p3 on
p1._id=p3.project_code 
left join profile_27398 p4 on
p3._id=p4.project_name 
left join profile_27398 p5 on
p4._id=split_part(p5.project_renew,'[',1)
left join profile_29974 p2 on
p5._id=p2.prj_code

left join profile_30171 p6 on
p1._id=p6.prj_code
left join profile_27395 p7
on p7._id=p1.ngo_partner
left join profile_28235 p8
on p8._id=p1.intervention_type
left join ds_mysql_prod_tagelement p9
on p9.id=p1.monitoring_live
left join ds_mysql_prod_tagelement p10
on p10.id=p1.focus_area*/







