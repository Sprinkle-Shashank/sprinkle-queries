WITH table1 AS (SELECT *
FROM (
SELECT cou.name AS country,p.name,fy_timerange,keyword,datanum,datanumbase,startdate
FROM sus_80584 p

LEFT JOIN ds_mysql_prod_project pro ON
p.xprojectid = pro.id

LEFT JOIN ds_mysql_prod_project cou ON
pro.parent = cou.id

WHERE keyword IN ('total_water_consumtion','water_prod_mfg','water_withdrawn_rainwater','percentage_recycledwater') 

ORDER BY fy_timerange ASC
  
) ),/*PIVOT (
   SUM(datanum) FOR keyword IN ('total_water_consumtion','water_prod_mfg','water_withdrawn_rainwater','percentage_recycledwater')
) */
	

table2 AS (
		SELECT country,name,fy_timerange,keyword,datanum,
		EXTRACT(MONTH FROM cast (startdate as datetime))AS month1,
		EXTRACT(YEAR FROM cast (startdate as datetime))AS year1,
		CASE
		WHEN MONTH1 <= 3
		THEN YEAR1-1
		ELSE
		YEAR1
		END AS start,
		start+1 AS end1,
CONCAT(start,'-04-01T00:00:00.000Z') AS start1,
CONCAT(end1,'-04-01T00:00:00.000Z') AS end2,
CONCAT(CONCAT(CONCAT(CONCAT('{"start":"',start1),'","end":"'),end2),'"}') AS fy_1,
CONCAT('FY(',CONCAT(start,CONCAT('-',CONCAT(end1,')')))) AS fy_2 
  from table1 t1
	)
SELECT * FROM table2