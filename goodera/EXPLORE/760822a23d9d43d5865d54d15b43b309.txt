with table1 as 
(
   select p1.*,cast(survey as varchar), trainer_organization as trainer_org from profile_63439 as p1, p1.survey_arr survey
 )
 
select ven.name as vendor, cou.name as country , tra_i.name as training_id ,  case when extract(month from table1.date)=1 then (extract(year from table1.date)-1) else extract(year from table1.date) end as year, table1.trainer_org as trainer_organization, case when score_total=6 or score_total>6 then score_total end as score_total from profile_65222 as p

left join table1 on 
p._id = table1.survey

left join profile_61498 tra_i 
on table1.training_id = tra_i._id

left join ds_mysql_prod_project fac
on p.projectid = fac.id

left join ds_mysql_prod_project ven
on fac.parent = ven.id

left join ds_mysql_prod_project cou
on ven.parent = cou.id

where score_total <> ' '