with sub1 as (
select resp.status, resp.approvallog, p_54963.subcat_output, p_54963.deviation_check, p_54963._id, p_54963.focus_area, p_54963.fy, p_54963.month, p_54963.projectId, p_54963.flag_deviation_delay
from profile_54963 p_54963

left join (select y.profileinstanceid, y.status, y.approvallog from ds_mongo2_taskresponse y) resp on p_54963._id = resp.profileinstanceid
),

sub2 as (
select subcat_output, deviation_check, _id, focus_area, fy, month, projectId, flag_deviation_delay, status, approvallog,
  case
  when (status = 'SUBMITTED' and cardinality(approvallog) = 0) then '0'
  else '1'
  end as datacheck
from sub1
)

select subcat_output, deviation_check, _id, focus_area, fy, month, projectId, flag_deviation_delay, status, approvallog, datacheck
from sub2