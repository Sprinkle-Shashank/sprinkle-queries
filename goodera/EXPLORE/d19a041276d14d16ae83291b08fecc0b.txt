with base1 as (select g1.code,gpr.action
from ds_mysql_prod_grantflowtaskgrantproposalrecord gpr
left join ds_mysql_prod_grantproposal g1
on g1.id = gpr.grantproposalid
where gpr.grantflowtaskid = '821'
),
base2 as (select *, row_number() over (partition by code order by action asc) as row_number from base1)

select * from base2 where row_number = 1 and action = 'COMPLETED'
