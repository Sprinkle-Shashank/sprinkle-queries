with sub1 as(
  select p1.*, to_char(cast(p1.start_date as date),'DD/MM/YYYY') as start_date_new,
to_char(cast(p1.end_date as date),'DD/MM/YYYY') as end_date_new, 
to_char(cast(p1.mou_date as date),'DD/MM/YYYY') as mou_date_new, 
(p1.start_date || '|' || p1.end_date) as fy_timerange,
  case
  		when is_array(p1.sdgs) = false or get_array_length(p1.sdgs) = 0 then array(p1.sdgs)
  		else p1.sdgs
  end as sdgs_new,
  case
  		when is_array(p1.schedule_7) = false or get_array_length(p1.schedule_7) = 0 then array(p1.schedule_7)
  		else p1.schedule_7
  end as schedule_7_new,
  case
  		when is_array(p1.sdgs_photo) = false or get_array_length(p1.sdgs_photo) = 0 then array(p1.sdgs_photo)
  		else p1.sdgs_photo
  end as sdgs_photo_new
  from profile_73154 p1),


sub3 as(
  select p3.name as partner, p2.name as projectid, p1.description, p1.start_date, p1.end_date, t1.name as theme, t2.name as projects, t3.name as proj_partner, p1.sdgs, p1.schedule_7, p1.mou_date, p1.sdgs_photo, p1.duration, p1.logo
from profile_73154 p1
left join ds_mysql_prod_project p2 on p2.id = p1.projectid
left join ds_mysql_prod_project p3 on p3.id = p2.parent
left join ds_mysql_prod_tagelement t1 on t1.id = p1.theme
left join ds_mysql_prod_tagelement t2 on t2.id = p1.projects
left join ds_mysql_prod_tagelement t3 on t3.id = p1.partner)

select * from sub1
