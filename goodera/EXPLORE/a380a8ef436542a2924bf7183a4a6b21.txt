

with table1 as
(
  select pr_13.projectid , fac.name as factory_name , case when sourcing_yn = 57473 then pace_2.name when sourcing_yn = 57472 then pace.name end as pace_status_name , pace.name as updated_pace ,  row_number() over 
(partition by factory_name --factory
 order by pr_13._id desc) as row1 
  from profile_52713 pr_13 
  
left join ds_mysql_prod_tagelement pace_2
on pr_13.pace_status_2 = pace_2.id
  
left join ds_mysql_prod_tagelement pace 
on pr_13.pace_status = pace.id
  
 left join ds_mysql_prod_project fac 
on pr_13.projectId = fac.id
  
left join profile_54267 pr_67 on 
pr_13.projectid = pr_67.projectid 
)
select updated_pace from table1


/*
with table3 as 
(
 select pr_27.projectid , cast(pr_27.name as varchar) as name, row_number() over 
(partition by pr_27.projectid  --factory
 order by pr_27.start_date desc) as row2 , position(' Batch' in name) as index_value , right( name , (len(name) - index_value)) as updated_name  from profile_4227 pr_27 
 )
 
 select tab3.projectid,  updated_name from table3 tab3
 */