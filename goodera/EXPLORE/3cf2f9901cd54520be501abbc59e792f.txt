with tab1 as (select p.projectid, p.name as names, f.name as fy_timerange,f1.name as focus_area,m.name as Project_Manager,p2.name as ngo_partners
from profile_27396 p
left join profile_27395 p2
on p.ngo_partner = p2._id
left join profile_27420 l on
l.project_code=p._id
left join ds_mysql_prod_tagelement m on
p.project_manager=m.id
left join ds_mysql_prod_tagelement f on
p.fy=f.id
left join ds_mysql_prod_tagelement f1 on
p.focus_area=f1.id
union
select p.projectid,p.name as names,f.name as fy_timerange,f1.name as focus_area,m.name as Project_Manager,p2.name as ngo_partners
from profile_27396 p
left join profile_80183 p2
on p.ngo_partner = p2._id
left join profile_27420 l on
l.project_code=p._id
left join ds_mysql_prod_tagelement m on
p.project_manager=m.id
left join ds_mysql_prod_tagelement f on
p.fy=f.id
left join ds_mysql_prod_tagelement f1 on
p.focus_area=f1.id)
select count(q.census_code) as village_count, r.names,r.fy_timerange,r.focus_area,r.Project_Manager,r.ngo_partners from profile_29974  q
left join tab1 r on
r.projectid=q.projectid
group by r.names,r.focus_area,r.Project_Manager,r.ngo_partners
