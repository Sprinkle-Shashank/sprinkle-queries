with t1(select _id, tag2.name as subject,  tag1.name as type_of_assessment, half_yearly_timerange as fy_timerange, marks_obtained, max_marks_obtained, class , trunc((marks_obtained/max_marks_obtained) * 100,2) as percentage
from profile_77356 p1
left join ds_mysql_prod_tagelement tag1
on p1.type_of_assessment = tag1.id
left join ds_mysql_prod_tagelement tag2
on p1.subject= tag2.id
where type_of_assessment in(1525436 ,1525439)
),

select _id,fy_timerange,class,subject,type_of_assessment,avg(percentage) as perc_avg
from t1
--order by class ASC
group by _id, class, fy_timerange, subject, type_of_assessment