with table1 as (select add_factory.projectid,pace_mapping.name_factory as factory,pace_mapping.name_vendor_filter as vendor,pace_mapping.name_country as country,factory_vpid_1 as community_id, child_vendor_vpid as vp_id from profile_52713 add_factory

left join profile_54646 pace_mapping 
on add_factory.projectid = pace_mapping.projectid ),

table2 as ( 
  select projectid, start_date, end_date, end_date_2, num_females from profile_4227 p
  /*left join ds_mysql_prod_project as pro
on p.projectid = pro.id*/
  where end_date_2 is null 
),
table3 as ( select pro.name as projectid,count(*) as completed from profile_4228 p
		   
		   left join ds_mysql_prod_project as pro
on p.projectid = pro.id
		   where end_date is not null 
		  group by pro.name),
table4 as ( select pro.name as projectid,count(*) as ongoing from profile_4228 p
		   
		   left join ds_mysql_prod_project as pro
on p.projectid = pro.id
		   where end_date is  null 
		  group by pro.name	 ),
creationdate_table_for_batch as (	select projectid,substring(createddate,1,10)as batch_date,row_number() over 
(partition by projectid
 order by createddate desc) as row from profile_4227   ),
 
 creationdate_table_for_module as (	select projectid,substring(createddate,1,10)as module_date,row_number() over 
(partition by projectid
 order by createddate desc) as row from profile_4228   ),
 
 table5 as ( select * from creationdate_table_for_batch 
			where row = 1 ),
			
 table6 as ( select * from creationdate_table_for_module 
			where row = 1 ),
  
 creation_date as ( select t5.projectid,batch_date,t6.module_date from table5 t5
  
  left join table6 t6 on 
  t5.projectid= t6.projectid ),
  
  table7 as ( SELECT mon.creatorid, u.email as cemail, mon.modifierid, m.email as memail
from ds_mongo_profileinstance mon
left join ds_mysql_prod_user u on
mon.creatorid = u.id
left join ds_mysql_prod_user m  on
mon.modifierid = m.id
where mon.profileId='4227' and mon.active = 't' and mon.securitycontextid is not null
			 )
select * from table7			 