

with x as (select name as projectid, financialperiod,fy_timerange, datatablebase from sus_56551 where keyword='gri_consumption_pattern' ),
temp2 as (

select * ,temp1.gri_total_water_consumed
  from x as temp, unpivot temp.datatablebase as temp1 at row)

select projectid,  temp1.gri_total_water_consumed as consumption,t1.name as financialperiod , fy_timerange , sum (temp1.gri_total_water_consumed) as 
  gri_consumption_pattern_consumption, split_part(t1.name,' ',1) as month,  row as consumptiontype
 


from temp2  
left join ds_mysql_prod_tagelement t1 on t1.id = financialperiod 

group by
projectid,t1.name,  temp1.gri_total_water_consumed, temp1.consumption, month ,financialPeriod, fy_timerange, row

/*select * from sus_56551 where keyword in ('gri_total_water_consumed','gri_consumption_pattern')*/

