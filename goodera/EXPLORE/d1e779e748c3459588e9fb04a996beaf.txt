with x as (select name as projectid, financialperiod,fy_timerange, datatablebase from sus_56551 where keyword='gri_consumption_pattern' 
temp2 as (

select * , temp1.gri_total_water_consumed, temp1.gri_consumption_pattern
  from x as temp, unpivot temp.datatablebase as temp1 at row)

select projectid, temp1.gri_consumption_pattern, temp1.gri_total_water_consumed as consumption,t1.name as financialperiod , fy_timerange,c , sum (consumption) as 
  gri_consumption_pattern_consumption, split_part(t1.name,' ',1) as month,
 
 Concat((CASE month
WHEN 'January' THEN '1'
WHEN 'February' THEN '2'
WHEN 'March' THEN '3'
WHEN 'April' THEN '4'
WHEN 'May' THEN '5'
WHEN 'June' THEN '6'
WHEN 'July' THEN '7'
WHEN 'August' THEN '8'
WHEN 'September' THEN '9'
WHEN 'October' THEN '10'
WHEN 'November' THEN '11'
ELSE '12'
end), split_part(fy_timerange,'|',1))
as monthname

from temp2  
left join ds_mysql_prod_tagelement t1 on t1.id = financialperiod 

group by
projectid,t1.name,  temp1.gri_water_withdrawal_details, temp1.consumption, financialPeriod, fy_timerange, monthname,

