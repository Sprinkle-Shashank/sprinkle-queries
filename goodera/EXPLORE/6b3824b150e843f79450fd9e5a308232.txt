with temp1 AS
(select m._id AS old_id, progress, completed, m.project_code, fy_year_timerange , Extract(month from CAST(m.fy_timerange.start AS date)) AS month_1, r._id, r.name, project_name, vertical, focus, state, start_date, EXTRACT(year from start_date) AS start_year, EXTRACT(month from start_date) AS start_month, direct_or_partner, entity, completed_text.name as completed_text, concat(CAST(month_1 AS VARCHAR), concat('-', completed_text)) as month_2,

case when month_1 = 1 then 'Jan'
when month_1 = 2 then 'Feb'
when month_1 = 3 then 'Mar'
when month_1 = 4 then 'Apr'
when month_1 = 5 then 'May'
when month_1 = 6 then 'Jun'
when month_1 = 7 then 'Jul'
when month_1 = 8 then 'Aug'
when month_1 = 9 then 'Sep'
when month_1 = 10 then 'Oct'
when month_1 = 11 then 'Nov'
when month_1 = 12 then 'Dec'
else NULL
END AS month_name , fy_timerange

from profile_55471 as m

left join profile_62881 AS r
 on m.project_code = r.project_code
 
left join ds_mysql_prod_tagelement as completed_text
  on m.completed = completed_text.id),

  
 temp2 as
(select old_id, progress.name as progress, completed_update.name as completed_new, project_code, EXTRACT(year from CAST(m.fy_year_timerange.start as date)) as report_year, month_1, _id, m.name, project_name, vertical, focus_update.name as focus_new, state_update.name as state_new, start_date, direct_or_partner_update.name as direct_or_partner_new, entity_update.name as entity_new, start_year, start_month, completed_text, month_2,  
 
 case when start_month = 1 then 'Jan'
when start_month = 2 then 'Feb'
when start_month = 3 then 'Mar'
when start_month = 4 then 'Apr'
when start_month = 5 then 'May'
when start_month = 6 then 'Jun'
when start_month = 7 then 'Jul'
when start_month = 8 then 'Aug'
when start_month = 9 then 'Sep'
when start_month = 10 then 'Oct'
when start_month = 11 then 'Nov'
when start_month = 12 then 'Dec'
else NULL
END AS start_month_1 , fy_timerange
 
 from temp1 AS m

left join ds_mysql_prod_tagelement as progress_update
  on m.progress = progress_update.id
  
left join ds_mysql_prod_tagelement as completed_update
  on m.completed = completed_update.id
  
left join ds_mysql_prod_tagelement as focus_update
  on m.focus = focus_update.id

left join ds_mysql_prod_tagelement as direct_or_partner_update
  on m.direct_or_partner = direct_or_partner_update.id
  
left join ds_mysql_prod_tagelement as entity_update
  on m.entity = entity_update.id

left join ds_mysql_prod_tagelement as state_update
  on m.state = state_update.id),
  
temp3 as(
select project_code, project_name , report_year, month_1, , start_month, start_year,
  
  case when month_1 = 1 and start_month = 1 and report_year = start_year and completed = 'Yes' then 'Started, Reported & Completed'
  when start_month = 1 then 'Started'
  when month_1 = 1 and completed = 'Yes' then 'Reported & Completed'
  else '-'
  end AS January
  
from temp2)
  
  
 select * from temp3
