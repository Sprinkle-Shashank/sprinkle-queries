with temp1 AS
(select m._id AS old_id, progress, completed, m.project_code, fy_year_timerange , Extract(month from CAST(m.fy_timerange.start AS date)) AS month_1, r._id, r.name, project_name, vertical, focus, state, start_date, EXTRACT(year from start_date) AS start_year, EXTRACT(month from start_date) AS start_month, direct_or_partner, entity, completed_text.name as completed_text, concat(month_1, concat('-',concat(completed_text))) as month_2,

case when month_1 = 1 then 'Jan'
when month_1 = 2 then 'Feb'
when month_1 = 3 then 'Mar'
when month_1 = 4 then 'Apr'
when month_1 = 5 then 'May'
when month_1 = 6 then 'Jun'
when month_1 = 7 then 'Jul'
when month_1 = 8 then 'Aug'
when month_1 = 9 then 'Sep'
when month_1 = 10 then 'Oct'
when month_1 = 11 then 'Nov'
when month_1 = 12 then 'Dec'
else NULL
END AS month_name

from profile_55471 as m

left join profile_62881 AS r
 on m.project_code = r.project_code
 
left join ds_mysql_prod_tagelement as completed_text
  on completed_text.name = completed),


/*left join ds_mysql_prod_tagelement as vertical
  on r.vertical = vertical.id*/

  
 temp2 as
(select old_id, progress.name as progress, completed.name as completed, project_code, fy_year_timerange, month_1, _id, m.name, project_name, vertical, focus.name as focus, state.name as state, start_date, direct_or_partner.name as direct_or_partner, entity.name as entity, start_year, start_month, completed_text, month_2 
 
 from temp1 AS m

left join ds_mysql_prod_tagelement as progress
  on m.progress = progress.id
  
left join ds_mysql_prod_tagelement as completed
  on m.completed = completed.id
  
left join ds_mysql_prod_tagelement as focus
  on m.focus = focus.id

left join ds_mysql_prod_tagelement as direct_or_partner
  on m.direct_or_partner = direct_or_partner.id
  
left join ds_mysql_prod_tagelement as entity
  on m.entity = entity.id

left join ds_mysql_prod_tagelement as state
  on m.state = state.id)
 
 select * from temp2
