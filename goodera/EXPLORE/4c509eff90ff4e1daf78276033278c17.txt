SELECT
PD.mode, PD.local_area, PD.state, PD.districts, PD.csr_registration, BLI.fy_timerange, BLI.budget_amount, BLI.amount_spent, UA.unspent_amount,
P.name AS projectid,
SUBSTRING(PD.project_start_date, 1, 10) AS project_start_date,
SUBSTRING(PD.project_end_date, 1, 10) AS project_end_date,
S7.name AS schedule_7,
E.name AS entity,

CASE 
  WHEN (EXTRACT(MONTH FROM PD.project_start_date) < 4)
  THEN (EXTRACT(YEAR FROM PD.project_start_date)-1)
  ELSE  (EXTRACT(YEAR FROM PD.project_start_date))
  END AS fy_project_start_year,
  
 CASE 
  WHEN (EXTRACT(MONTH FROM PD.project_end_date) <4)
  THEN (EXTRACT(YEAR FROM PD.project_end_date)-1)
  ELSE (EXTRACT(YEAR FROM PD.project_end_date))
  END AS fy_project_end_year,

CASE
	WHEN fy_project_start_year = fy_project_end_year
	AND fy_project_end_year = (EXTRACT(YEAR FROM CAST(BLI.fy_timerange.end AS datetime)))
	THEN 1
	ELSE 0
	END AS result

FROM profile_81995 AS PD

LEFT JOIN ds_mysql_prod_project AS P
ON PD.projectid = P.id

LEFT JOIN ds_mysql_prod_tagelement AS S7
ON PD.schedule_7 = S7.id

LEFT JOIN profile_81997 AS BLI
ON PD.projectid = BLI.projectid

LEFT JOIN ds_mysql_prod_tagelement AS E
ON BLI.entity = E.id

LEFT JOIN profile_81346 AS UA
ON PD.projectid = UA.projectid