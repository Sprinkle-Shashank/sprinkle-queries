SELECT PF.projectid, PF.project_code_new AS _id, PD.name AS project_code_new,
EXTRACT(YEAR FROM(CAST(PF.month_timerange.start AS datetime))) AS fy_timerange,
/*SUM(PF.amount) AS amount_disbursed,*/
PD.start_date, t.name AS entity, PD.project_name, t3.name AS direct_or_partner, PD.partner, t2.name AS state, PD.budget_outlay, PD.item, PD.local_area, PD.csr_registration, PD.CSR,
PP.completed, PP.date AS end_date,

case 
  when (extract(month from PD.start_date) <04) then (extract(year from PD.start_date)-1)
  else  (extract(year from PD.start_date))
  end as fy_start_date,
  
 case 
  when (extract(month from PP.date) <4) then  (extract(year from PP.date)-1)
  else  (extract(year from PP.date))
  end as fy_end_date

/*CASE 
	WHEN EXTRACT(YEAR FROM(CAST(PD.start_date AS datetime)))
	= EXTRACT(YEAR FROM(CAST(PP.date AS datetime)))
	= EXTRACT(YEAR FROM(CAST(PF.month_timerange.start AS datetime)))
	THEN 1
	ELSE 0
END AS buhbj
*/





FROM profile_55194 AS PF

LEFT JOIN profile_62881 AS PD
ON PF.project_code_new = PD._id

LEFT JOIN profile_55471 AS PP
ON PD.project_code = PP.project_code

LEFT JOIN ds_mysql_prod_tagelement AS t
ON PD.entity = t.id

LEFT JOIN ds_mysql_prod_tagelement AS t2
ON PD.state = t2.id

LEFT JOIN ds_mysql_prod_tagelement AS t3
ON PD.direct_or_partner = t3.id

WHERE PF.project_code_new IS NOT NULL
AND PD.CSR = 1395093
AND PP.completed = 939857