with table1 as 
(
  
select name_factory , pr_13.sourcing_yn from profile_54646 as pr_46
 
left join profile_52713 pr_13
on pr_46.projectId = pr_13.projectid
  
left join profile_54267 pr_67
on pr_46.projectId = pr_67.projectid
    
where pr_13.sourcing_yn == 57472 

)
  
  select * from table1
  

/*
{name_factory} in 54646 when sourcing_yn == 57472 in 52713 and pace_status == 845114   in 54267 (Check latest entry for each Factory)
{name_factory} in 54646 when sourcing_yn == 57473 and  pace_status_2 == 845114 or Blank in 52713
{name_factory} in 54646 when pace_status == 182398 in 4948

  The table only shows those Factories/Location which has a ongoing batch or no batch. The ongoing Batch is one in which "Batch Start" OR "Batch end" OR "Business outcome Tracking" section has not been submitted. Hence, it would also show factories where no batches are running.

Rearrange the columns as given here

Show this when a batch is ongoing (end_date_2 == null in Batch (4227) Profile) or there is no batch currently when pace_status = 845114 in Factory- Sustainability Rating (Monthly) (54267). Both profiles are in same project. 

*/