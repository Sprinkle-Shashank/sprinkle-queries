with sub1 as (select a.*, unwind_product_category,unwind_cycle from profile_64362 as a, a.product_category as unwind_product_category,a.cycle as unwind_cycle)
,
t1 as 
(
  select tag3.name as projectId , timerange_timerange,  tag1.name as training_type, num_female, num_male, tag2.name as  year , tag4.name as country, p3.factory, p2.vendor, p2.cycle, p2.product_category,tag6.name as consultant , tag7.name as unwind_product_category , tag8.name as unwind_cycle
from profile_61528 as p1
left join sub1 as p2
on p1.projectId = p2.projectId
left join ds_mysql_prod_tagelement tag1
on p1.training_type = tag1.id
left join ds_mysql_prod_tagelement tag2
on p1.year = tag2.id
left join ds_mysql_prod_project tag3
on p1.projectId= tag3.id
left join ds_mysql_prod_tagelement tag4
on p2.country = tag4.id
--left join ds_mysql_prod_tagelement tag5
--on p2.factory = tag5.id
left join profile_64170 as p3
on p2.factory = p3._id
left join ds_mysql_prod_tagelement tag6
on p2.consultant_tag = tag6.id
  left join ds_mysql_prod_tagelement tag7
on p2.unwind_product_category = tag7.id 
  left join ds_mysql_prod_tagelement tag8
on unwind_cycle = tag8.id 
--order by timerange_timerange DESC
 ),
 
item as
(
select 'num_female' as c
union all
select 'num_male' as c
),

t2 as
(select  projectId , timerange_timerange,  training_type,  year , factory, vendor, consultant, unwind_cycle,country ,  unwind_product_category , 
case c
when 'num_female' then t1.num_female
when 'num_male' then t1.num_male
else null
end as workforce,item.c as gender
from t1 cross join item
)
 

select projectId, timerange_timerange,traning_type,year,factory,vendor,consultant,unwind_cycle,country,product_category,gender , gender, sum(t2.workforce) as workforce
from t2 
group by projectId , timerange_timerange,  training_type,  year , factory, vendor, consultant, unwind_cycle,country ,  unwind_product_category ,gender
