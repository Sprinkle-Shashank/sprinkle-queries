with s1 as(
  select p._id, school as school_name, LEFT(p.session_date,10) start_date, LEFT(p.end_date,10) end_date, t.name session_type , p.duration, p.brief, p.teacher, p.photo, p.session_date fy_timerange,p.projectid
  from profile_77006 p  
left join profile_77382 p2
on p.school = p2._id
left join ds_mysql_prod_project q
ON q.id=p.projectid
left join ds_mysql_prod_tagelement t
on p.session_type = t.id
group by 1,2,3,4,5,6,7,8,p.photo,p.session_date,p.projectid
),

s3 as (
select CAST(school1 as varchar) as school1, s2.*
FROM s1 as s2,s2.school_name school1)

Select  _id, listagg(distinct school1  ,',') as school_name, start_date, end_date, session_type , duration, brief, teacher, photo,fy_timerange, projectid 
from s3
GROUP BY start_date, end_date, session_type , duration, brief, teacher, photo,fy_timerange, _id, projectid