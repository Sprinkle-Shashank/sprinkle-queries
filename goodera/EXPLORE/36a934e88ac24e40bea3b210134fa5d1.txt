 select p.projectid , fac.name as factory ,
  
case when nvl2(SUBSTRING(substring(ven.name,9,len(ven.name)), 1, POSITION(' (' in substring(ven.name,9,len(ven.name)))), SUBSTRING(substring(ven.name,9,len(ven.name)), 1, POSITION(' (' in substring(ven.name,9,len(ven.name)))), substring(ven.name,9,len(ven.name)))='' then substring(ven.name,9,len(ven.name)) else nvl2(SUBSTRING(substring(ven.name,9,len(ven.name)), 1, POSITION(' (' in substring(ven.name,9,len(ven.name)))), SUBSTRING(substring(ven.name,9,len(ven.name)), 1, POSITION(' (' in substring(ven.name,9,len(ven.name)))), substring(ven.name,9,len(ven.name))) end as vendor , 
  
  

  
  
  
  
  
  
  cou.name as country  from profile_61572 as p
  
left join project_1137 fac 
on p.projectId = fac.id

 left join project_1137 ven 
on fac.parent = ven.id

 left join project_1137 cou 
on ven.parent = cou.id
  

  
 where p.projectid like '%%' and country <> 'Test Country'


