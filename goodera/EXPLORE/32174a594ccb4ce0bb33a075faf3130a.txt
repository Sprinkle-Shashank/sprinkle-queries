

with table1 as (select distinct taskuserid,projectid from ds_mongo_profileinstance
where profileid = 4227),

table2 as (select distinct p.taskuserid,t1.projectid/*,pu.programid,u.email,pp.name*/ from profile_4227 p

left join  table1 t1 on
p.taskuserid = t1.taskuserid
 
where p.taskuserid is not null )
 --select * from table1

select distinct p.taskuserid,t1.projectid,pro.name as factory,tu.taskid,pu.programid,u.email,pp.name from profile_4227 p
left join ds_mysql_prod_taskuser tu on
p.taskuserid = tu.id
left join table1 t1 on
p.taskuserid = t1.taskuserid
left join ds_mysql_prod_programuser pu on
tu.programuserid = pu.id 
left join ds_mysql_prod_project as pro
on t1.projectid = pro.id
left join ds_mysql_prod_user u on
pu.userid = u.id
left join ds_mysql_prod_personprofile pp on
u.id = pp.userid

--select taskuserid from profile_4227
