with table1 as
(
  select p.projectid,fac.name as van, p2.name as partner,                  --van
  cast(substring(d1.req_date,1,10) as date) as date_update_1 , cast(substring(d1.date_n,1,10) as date) as date_update_2 , case when d1.date_yn = 28005 then date_update_2 else date_update_1 end as date1,    --date
  nvl2(SUBSTRING(diagnosis.name, 1, POSITION(' -' in diagnosis.name)), SUBSTRING(diagnosis.name, 1, POSITION(' -' in diagnosis.name)),diagnosis.name) as disease , referred_yn1.name as referred_yn ,
p1.age,gender1.name as gender,cast(DATEPART(YEAR,p1.createddate) as varchar) as created_year , cast(DATEPART(YEAR,current_date) as varchar) as current_year ,
(current_year - created_year)+ age as current_age, 1 as count ,
case when current_age>= 0 and current_age<=5 then '0-5y'    
	 when current_age>= 6 and current_age<=18 then '6-18y'
     when current_age>=19 and current_age<=40 then '19-40y'
     when current_age>=41 and current_age<=60 then '41-60y'
     when current_age > 60  then '60+y' else null end as category	   
from profile_58474 p
  
left join profile_58473 p1
on p.patient = p1._id
left join profile_58511 d1
on p.sel_camp = d1._id
left join profile_51990 d2
on d1.imple_partner = d2._id
  
left join ds_mysql_prod_tagelement diagnosis
on p.diagnosis1 = diagnosis.id
left join ds_mysql_prod_tagelement gender1
on p1.gender = gender1.id 
left join ds_mysql_prod_tagelement referred_yn1
on p.referred_yn = referred_yn1.id
left join ds_mysql_prod_project fac
on p.projectid = fac.id
 ),
 
 
 table2 as
(
select p.projectid,fac.name as van,p2.name as partner,
cast(substring(d1.req_date,1,10) as date) as date_update_1 , cast(substring(d1.date_n,1,10) as date) as date_update_2 , 
case when d1.date_yn = 28005 then date_update_2 else date_update_1 end as date1,    --date
nvl2(SUBSTRING(diagnosis.name, 1, POSITION(' -' in diagnosis.name)), SUBSTRING(diagnosis.name, 1, POSITION(' -' in diagnosis.name)),diagnosis.name) as disease ,referred_yn1.name as referred_yn ,
p1.age,gender1.name as gender,cast(DATEPART(YEAR,p1.createddate) as varchar) as created_year , cast(DATEPART(YEAR,current_date) as varchar) as current_year ,
(current_year - created_year)+ age as current_age, 1 as count ,
case when current_age>= 0 and current_age<=5 then '0-5y'    
	 when current_age>= 6 and current_age<=18 then '6-18y'
     when current_age>=19 and current_age<=40 then '19-40y'
     when current_age>=41 and current_age<=60 then '41-60y'
     when current_age > 60  then '60+y' else null end as category	   
from profile_58474 p
left join profile_58473 p1
on p.patient = p1._id
left join profile_58511 d1
on p.sel_camp = d1._id
left join profile_51990 d2
on d1.imple_partner = d2._id
  
 left join ds_mysql_prod_tagelement diagnosis
  on p.diagnosis2 = diagnosis.id
 left join ds_mysql_prod_tagelement gender1
  on p1.gender = gender1.id 
 left join ds_mysql_prod_tagelement referred_yn1
  on p.referred_yn = referred_yn1.id
left join ds_mysql_prod_project fac
on p.projectid = fac.id
 )
 select * from table1
 union
 select * from table2