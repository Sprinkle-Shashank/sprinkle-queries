with table1 as 
(
   select p1.*,cast(survey as varchar), trainer_organization as trainer_org from profile_63438 as p1, p1.survey_arr survey
 )
 
select p.projectId, worker_leave, timeline_miss, supervisor_loud, worker_late, supervisor_overall, conflict, wages, discussion, total_score,  cou.name as country, ven.name as vendor,
SUBSTRING(to_char(table1.date, 'DD/MM-YYYY'), POSITION('-' in to_char(table1.date, 'DD/MM-YYYY'))+1,4 ) as year, table1.trainer_org as trainer_organization,
count(p.projectId) as post_worker_respondents_total
from profile_65221 p

left join table1 on 
p._id = table1.survey


left join ds_mysql_prod_project fac
on p.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id

group by p.projectId, worker_leave, timeline_miss, supervisor_loud, worker_late, supervisor_overall, conflict, wages, discussion, table1.trainer_org, total_score,  cou.name, ven.name, year