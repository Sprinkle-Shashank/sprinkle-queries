with s as 
(Select 
data.name as Project_Code,
case
	when data.end_date is not null then 'NA'
    else '-'
	end as renewed,
 submissionlog,approvallog,
data.project_manager as project_manager,
data.ngo_partner as ngo_partner,ss.monitoring_live
from ds_mongo_taskresponse 
left join profile_27396 ss
on ss.name=data.name
where profileid=27396 
),
s1 as(
Select Project_Code,renewed,submissionlog,approvallog,project_manager, ngo_partner, monitoring_live,sl."timestamp" as Latest_Date_of_Submission_by_Project_Manager,al."approvalStatus" as Status_at_Goodera,
case 
  when al."approverEmail" ="hdfcbank@goodera.com" then al."timestamp"
  as Date_of_Action_by_Goodera
from s as h1,h1.submissionlog as sl, h1.approvallog as al,
  al."approvalStatus" as Status_at_csr_head

),


s2 as (
Select
'' as Project_Code,
case
	when data.end_date is not null and data.end_date > CURRENT_DATE||'T00:00:00.000Z' then 'Yes'
    when data.end_date is not null and data.end_date < CURRENT_DATE||'T00:00:00.000Z' then 'No'
    else '-'
  end as renewed,
   submissionlog,approvallog,
data.project_manager as project_manager,
'' as ngo_partner,sss.monitoring_live
from ds_mongo_taskresponse 
left join profile_27420 sss
on sss.name=data.name
where profileid=27420
),
s3 as (
Select Project_Code,renewed,submissionlog,approvallog,project_manager, ngo_partner, monitoring_live,sl."timestamp" as Latest_Date_of_Submission_by_Project_Manager, al."approvalStatus" as Status_at_Goodera,
case 
  when al."approverEmail" ="hdfcbank@goodera.com" then al."timestamp"
  as Date_of_Action_by_Goodera
from s as h2,h2.submissionlog as sl, h2.approvallog as al,
  al."approvalStatus" as Status_at_csr_head
  
)

Select * from s1
union all
Select * from s3