with t1 as 
(select p1._id, p1.fy_timerange, p1.line_item, p1.category, p1.budgeted_amount :: varchar, p1.projectId, p2.date :: varchar, p2.amount_utilized :: varchar
from profile_74913 p1
left join profile_74914 p2
on p1._id = p2.line_item
order by p2.date)

select _id, fy_timerange, line_item, category, budgeted_amount, projectId, amount_utilized,
first_value(t1.date) over (partition by amount_utilized order by date rows between unbounded preceding and unbounded following) as date,
rank() over(partition by t1.budgeted_amount order by amount_utilized asc) as d_rank

from t1
where budgeted_amount = 70000




--t3 as 
--(select  _id, projectId, fy_timerange, line_item, category, budgeted_amount, date, amount_utilized,
--dense_rank() over(partition by t1.budgeted_amount order by amount_utilized asc) as d_rank
--from t1)

--select  _id, projectId, fy_timerange, line_item, category, budgeted_amount, date, amount_utilized
--from t3
--where d_rank = 1


















