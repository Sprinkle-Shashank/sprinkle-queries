with table1 as(Select /*profile_54646.name_country as country,profile_54646.name_vendor as partner,f_y.name as fy,,mth.name as month,*/p._id,p.pace_status_1,pro.name as factory,p.sourcing_yn,profile_54267.facility_rating,profile_54267.fac_vpid,profile_54646.name_vendor_filter as partner_consolidated,row_number() over 
(partition by factory
 order by p._id desc) as row

from profile_52713 p 

left join profile_54267 on
p.projectId = profile_54267.projectId
left join ds_mysql_prod_project pro
on p.projectId = pro.id

left join profile_54646 on
p.projectId = profile_54646.projectId

where p.pace_status_1= 'Currently implementing P.A.C.E.' and p.sourcing_yn = 57472
and profile_54267.facility_rating = 845095 and profile_54267.facility_rating is not null )
,table2 as( select _id,pro.name as projectid,f_y.name as fy,mth.name as month, facility_rating,fac_vpid,row_number() over 
(partition by projectid
 order by p._id desc) as row from profile_54267 p
		  
		  left join ds_mysql_prod_project pro
on p.projectId = pro.id 
left join ds_mysql_prod_tagelement f_y
on p.fy = f_y.id
left join ds_mysql_prod_tagelement mth
on p.month = mth.id		  )
		
select projectid,fy,month, facility_rating,fac_vpid, row from table2	
where row = 1 or projectid= 'Factory: EAM MALIBAN TEXTILES JORDAN PVT LTD'
		
/*select Distinct factory,row,facility_rating,sourcing_yn,pace_status_1 from table1
where row = 1*/