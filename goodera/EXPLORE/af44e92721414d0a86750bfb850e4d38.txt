with table1 as
( select p.projectid , p._id , fy_timerange, school_name, cast(percent_baseline_score as float) as percent_baseline_score , cast(percent_endline_score as float) as percent_endline_score, pro.name as student_class from profile_77881 as p 
 
 left join ds_mysql_prod_tagelement pro
 on p.student_class = pro.id
 ),
 
 table2 as
 ( select * from 
   ( select p.projectid , p._id, fy_timerange, school_name, student_class , percent_baseline_score, percent_endline_score from table1 as p)
  
  unpivot 
  ( val for dim in (percent_baseline_score, percent_endline_score))
   )
 
 select p.projectid , p._id, fy_timerange, school_name, student_class , dim , avg(val) as val_update from table2 as p
 
 group by p.projectid , p._id, fy_timerange, school_name, student_class , dim 