with t1 as
(select 
p1.fy_timerange, tag2.name as plac_status, p2.batch_id, tag1.name as gender, 	batch_end,GETDATE() as today
from profile_76123 p1
left join profile_76122 p2 on
p1.batchid = p2._id
left join ds_mysql_prod_tagelement as tag1 on
p1.gender = tag1.id
left join ds_mysql_prod_tagelement as tag2 on
p1.plac_status = tag2.id)
,
t2 as 
(select fy_timerange,plac_status as placed,batch_end as end,gender, today, t1.batch_id
,
case 
when t1.plac_status is null then 'Empty'
else t1.plac_status
end as placed
from t1
)

--select t1.fy_timerange ,t1.batch_id,t2.end, t1.today,t1.gender 
--,t2.placed
select t2.* ,
case
when today <= end then  Undergoing training
when placed = empty  and today > end then Trained 
else placed
end as  trainee_status
from t2 

/*New Field: trainee_statusExpression: if(lte($today,$end),Undergoing training,if(and(eq($placed,Empty),gt($today,$end)),Trained,$placed))
(8) Group By
Fields: fy_timerange, gender, trainee_status
arrow_right_alt
New Field: countAggregate Function: count-of-rows