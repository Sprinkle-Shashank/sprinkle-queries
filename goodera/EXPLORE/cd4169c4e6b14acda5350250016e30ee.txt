with sub1 as(
  select p1.*, cast(docs as VARCHAR) from profile_41431 p1, p1.doc docs),
  
sub2 as(
  select p2.name as projectid, s1.fy_timerange, t1.name as type, p3.project_name, listagg(distinct s1.docs, ', ') as docs, 'Click Here' as doc_download,
(extract(year from cast(s1.fy_timerange.start as date)) || '-'  extract(year from cast(s1.fy_timerange.end as date)) as year,
split_part(p2.name, ' - ', 1) as project
  
from sub1 s1

left join ds_mysql_prod_project p2 on p2.id = s1.projectid
left join ds_mysql_prod_tagelement t1 on t1.id = s1.document_type
left join profile_41363 p3 on p3._id = s1.project_name

group by p2.name, s1.fy_timerange, t1.name, s1.file_name, p3.project_name)

select projectid, fy_timerange, cast('MOU' as varchar) as type, project_name, signed_mou as docs
from profile_41363