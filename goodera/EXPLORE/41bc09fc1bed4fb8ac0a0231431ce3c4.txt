with lookup as (select
				JSON_SERIALIZE(table_52810.pace_brands) as pace_brand,
				case when pace_brand like '%1151834%' then 1 else 0 end  as brand,
				max(distinct taskResponse_4227.modified) as last_modified,
				listagg(distinct taskResponse_4227.status) as status10,
				listagg(distinct taskResponse_4227.sectionId) as sectionId1,
				taskResponse_4227.submissionLog as submissionLog,
				case when status10 like 'SUBMITTED' then 1 else 0 end as status1,
				case when sectionId1 <> 9292 then null else taskResponse_4227.submissionLog[0].email end as data_user,
				
				listagg(distinct p._id) as _4227_id,
				listagg(distinct cast(p.end_date_2 as varchar(256))) as enddate2,
				case when taskResponse_4227.modified is null or sectionId1 <> 9296 then enddate2 else last_modified end as business_date,
				listagg(distinct table_4228._id) as id4228,
				case when id4228 is null then p._id else id4228 end as _4228id,
				listagg(distinct taskResponse_4228.status) as status11,
				(max(distinct taskResponse_4228.modified)) as modified11,
				
				case when status11 like 'SUBMITTED'then (modified11) else null end as date_modified,
				case when date_modified > last_modified then date_modified else last_modified end as last_entry_date
				
			
				from profile_4227 p
				   
inner join profile_52810 table_52810 on
table_52810.projectid=p.projectid	
				
inner join ds_mongo_taskresponse taskResponse_4227 on
taskResponse_4227.profileinstanceid=p._id
				
left join profile_4228 table_4228 on
table_4228.class = p._id
				
left join ds_mongo_taskresponse taskResponse_4228 on
taskResponse_4228.profileinstanceid=table_4228._id
				--_4228id
		
group by table_52810.pace_brands,p._id,taskResponse_4227.submissionLog[0].email,taskResponse_4227.modified,taskresponse_4227.submissionlog
			   )
select * from lookup p where brand = 1 and status1 = 1