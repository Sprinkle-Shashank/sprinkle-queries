with Base1 as(select m._id, o, cast(o."approvalStatus" as varchar) as status from test_hdfc_sample m, m.approvallog o ),Base2 as(select distinct(p._id),p.status,case when p._id is not null then 'Approved by first Manager' end as type from Base1 p where p.status='APPROVED')
,Base3 as(select p._id,count(p.status),case when p._id is not null then 'Approved by 2nd manager' end as type from Base1 p where p.status='APPROVED' group by p._id having count(p.status)>1)
--,Base4 as(
select m._id,o,k from test_hdfc_sample m, m.approvallog o,m.submissionlog k