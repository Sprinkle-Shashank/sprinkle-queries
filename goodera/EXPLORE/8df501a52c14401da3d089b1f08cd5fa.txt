with Base1 as(select m.profileinstanceid, o, cast(o."approvalStatus" as varchar) as status from test_hdfc_sample m, m.approvallog o ),Base2 as(select distinct(p.profileinstanceid),p.status,case when p.profileinstanceid is not null then 'Approved by first Manager' end as type from Base1 p where p.status='APPROVED')
,Base3 as(select p.profileinstanceid,count(p.status),case when p.profileinstanceid is not null then 'Approved by 2nd manager' end as type from Base1 p where p.status='APPROVED' group by p.profileinstanceid having count(p.status)>1)
select * from Base3