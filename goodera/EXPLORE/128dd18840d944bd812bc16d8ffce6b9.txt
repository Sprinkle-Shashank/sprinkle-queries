with table1 as ( select _id , projectid,pace_status as facility_status,row_number() over 
(partition by projectid
 order by _id desc) as row from profile_54267 p
		/*left join ds_mysql_prod_project as pro
on p.projectid = pro.id*/	   ),

table2 as ( select * from table1 
		  where row = 1),

table3 as (
  select p.projectid,name_factory,add_factory.sourcing_yn,add_factory.pace_status_2,add_community.pace_status as status_community,t2.facility_status from          profile_54646 p

left join profile_52713 add_factory on
p.projectid = add_factory.projectid 

left join profile_4948 add_community on
p.projectid = add_community.projectid

left join table2 t2 on 
p.projectid= t2.projectid  
)

select case when sourcing_yn =57472 and facility_status = 845114 then name_factory
            when sourcing_yn = 57473 and (pace_status_2 in (845114 ,898423,898425,898426))or pace_status_2 is null then   name_factory 
			when status_community = 182398 then name_factory end as factory
			
			from table3
--where factory is not null