with table1 as (select projectid,stat.name as status,train.name as training_type,yr.name as year,name_rep from profile_64806 p

left join ds_mysql_prod_tagelement stat
on p.status = stat.id

left join ds_mysql_prod_tagelement train
on p.training_type = train.id

left join ds_mysql_prod_tagelement yr
on p.year = yr.id

where status in (1247617, 1247616) ),


table2 as (select _id,country, factory, unwind_cycle, product_category, consultant, vendor from profile_64362 p, p.cycle unwind_cycle),

table3 as (select _id,country, factory, cycle as unwind_cycle, product_category, consultant, vendor from profile_64362

where _id not in (select _id from table2)
),

table4 as (select * from table2 
		   union all 
		   select * from table3),

table5 as (select _id,country, factory, unwind_cycle, prod_cat, consultant, vendor from table4 t4, t4.product_category prod_cat 		   
),

table6 as (
select * from (select * from table5 
Union all
select  _id,country, factory, unwind_cycle, product_category as prod_cat, consultant, vendor from table4 

where _id not in (select _id from table5)
) )

select cou.name as country,fac_part.factory,cyc.name as cycle,prod.name as prod_cat,consultant,vendor from table6 t6

left join ds_mysql_prod_tagelement cyc
on t6.unwind_cycle = cyc.id

left join ds_mysql_prod_tagelement prod
on t6.prod_cat = prod.id

left join ds_mysql_prod_tagelement cou
on t6.country = cou.id

left join profile_64170 fac_part
on t6.factory = fac_part._id

