with table1 as (select pro.name as projectId, p.notes_2, p.end_date_2, p.start_date_2, skill.name as training, train.name as training_type, p.supervisors, p.employed, p.saturation, p.master_trainers, yr.name as year from profile_64817 p

left join ds_mysql_prod_project pro
on p.projectid = pro.id

left join ds_mysql_prod_tagelement train
on p.training_type = train.id

left join ds_mysql_prod_tagelement yr
on p.year = yr.id
left join profile_61602 skill
on p.training = skill._id		
				

--where status in (1247617, 1247616) and gender = 1140674
			   ),


table2 as (select _id,projectid,country, factory, unwind_cycle, product_category, consultant, vendor from profile_64362 p, p.cycle unwind_cycle),

table3 as (select _id,projectid,country, factory, cycle as unwind_cycle, product_category, consultant, vendor from profile_64362

where _id not in (select _id from table2)
),

table4 as (select * from table2 
		   union all 
		   select * from table3),

table5 as (select _id,projectid,country, factory, unwind_cycle, prod_cat, consultant, vendor from table4 t4, t4.product_category prod_cat 		   
),

table6 as (
select * from (select * from table5 
Union all
select  _id,projectid,country, factory, unwind_cycle, product_category as prod_cat, consultant, vendor from table4 

where _id not in (select _id from table5)
) ),

table7 as (
select cou.name as country,t6.projectid,fac_part.factory,cyc.name as cycle,prod.name as prod_cat,per.name as consultant,vendor from table6 t6

left join ds_mysql_prod_tagelement cyc
on t6.unwind_cycle = cyc.id

left join ds_mysql_prod_tagelement prod
on t6.prod_cat = prod.id

left join ds_mysql_prod_tagelement cou
on t6.country = cou.id

left join profile_64170 fac_part
on t6.factory = fac_part._id

left join profile_61583 per
on t6.consultant = per._id)/*,
table8 as (
select t1.projectid,t1.name,training_type,year,num_female,t7.country,t7.factory,t7.cycle,t7.prod_cat,t7.consultant,t7.vendor from table1 t1 

left join table7 t7 
on t1.projectid = t7.projectid

where training_type = 'Target Led' and  (cycle not ilike '%vendor%' or cycle is null)
),
table9 as (
select t1.projectid,t1.name,training_type,year,num_female,t7.country,t7.factory,t7.cycle,t7.prod_cat,t7.consultant,t7.vendor from table1 t1 

left join table7 t7 
on t1.projectid = t7.projectid

where training_type not ilike '%Target Led%' and ( cycle ilike '%vendor%' or cycle is null))*/

,
table10 as ( select name,start_date,end_date,supervisors_2,employed,training_type,year from profile_61602 p)

select * from table10
