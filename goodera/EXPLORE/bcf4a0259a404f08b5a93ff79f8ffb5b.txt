with table1 as (/*select country,name,finperiod,fy_timerange,tot_consumption,tot_cons_plastic from (*/select xprojectid,cou.name as country,p.name,finperiod,fy_timerange,keyword, datanumbase
--tot_cons_plastic/tot_consumption as tot_plastic_share
				



from sus_82955 p
left join ds_mysql_prod_project pro on 
p.xprojectid = pro.id

left join ds_mysql_prod_project cou on 
pro.parent= cou.id
where keyword in('tot_consumption','tot_cons_plastic') /*)
PIVOT (
   sum(datanumbase) FOR keyword IN ('tot_consumption','tot_cons_plastic')
)*/ 
),

table2 as (
select xprojectid,cou.name as country,p.name,finperiod,fy_timerange,keyword, datanumbase from sus_80478 p
  
left join ds_mysql_prod_project pro on 
p.xprojectid = pro.id

left join ds_mysql_prod_project cou on 
pro.parent= cou.id
where keyword in('turnover') 
  
)

select country,name,finperiod,fy_timerange,keyword,
case when keyword = 'tot_consumption' then (select datanumbase from table1 where keyword = 'tot_consumption' and  finperiod = 'FY 2022-23')/(select datanumbase from table2 where finperiod = 'FY 2012-13' ) 
else (select datanumbase from table1 where keyword = 'tot_cons_plastic' and finperiod = 'FY 2022-23')/(select datanumbase from table2 where finperiod = 'FY 2012-13' ) end as base_intensity

from table1
--where finperiod = 'FY 2012-13' 
/*select * from table1 
unpivot (datanumbase for keyword in (tot_consumption,tot_cons_plastic))*/