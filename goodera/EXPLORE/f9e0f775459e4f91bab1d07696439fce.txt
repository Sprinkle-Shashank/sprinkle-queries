with sub1 as(
  select r1.*,
  case
  		when extract(year from cast(r1.end_date as date)) > extract(year from cast(r1.start_date as date))
		then r1.participation_date
		else r1.start_date
  end as start_date_new
  from rb_volhours r1)
  
select s1.event_id as id, t1.name as focus_area, p3.name as country, p3.map_code, s1.participation_date,
(cast(s1.start_date_new as date)||'|'||cast(s1.start_date_new as date)) as fy_timerange,
s1.vol_hours, s1.vol_hours*p4.vol_conversion_factor as volunteering_cost,
extract(year from cast(s1.start_date_new as date)) as year_check,
('FY'||' '||extract(year from cast(s1.start_date_new as date))) as x_axis2, 
cast('Volunteering' as varchar) as x_axis,
cast('Reckitt Global' as varchar) as prod_brand,
	case
  		when(year_check = extract(year from current_date)) then 'Current year'
  		when(year_check = extract(year from current_date)-1) then 'Previous year'
  	else 'Not Applicable'
  	end as year_status
from sub1 s1
left join profile_78929 p2 on p2.vol_focus_area_full = s1.focus_area
left join ds_mysql_prod_tagelement t1 on t1.id = p2.focus_area
left join profile_78788 p3 on p3.vol_country = s1.country
left join profile_78933 p4 on p4.name = extract(year from cast(s1.start_date as date))