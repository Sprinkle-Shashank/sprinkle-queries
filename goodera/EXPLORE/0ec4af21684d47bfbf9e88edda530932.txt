
with t1 as 
(select p1._id, p1.planned_completion_date, p1.fy_timerange, p1.planned_start_date :: varchar, p1.milestone_name, p1.projectId, p2.actual_start_date :: varchar, p2.comments, p2.actual_completion_date :: varchar as milestone_date, p2.comments_2, cast('2022-09-06T17:42:13.256Z' as VARCHAR) as today_date,
case 
when actual_start_date is null then milestone_date
else today_date
end as today
from profile_76057 p1
left join profile_76058 p2
on p1._id = p2.milestone)

select projectId, planned_completion_date, fy_timerange, planned_start_date, milestone_name, actual_start_date, milestone_date,
case 
when milestone_date is null then today
end as actual_completion_date,
case 
when milestone_date is null then comments
else comments_2
end as comments_final
from t1












/*with t1 as
(
  select p1._id, p1.planned_completion_date, p1.fy_timerange, p1.planned_start_date, p1.milestone_name, p1.projectId,p2.actual_start_date as actual_start_date, p2.comments, p2.actual_completion_date
 as milestone_date,
 p2.comments_2,
case 
when p2.actual_start_date is not null  then GETDATE()
else null
--when p2.actual_start_date is null then null
--else getdate()
end as today,
case
when milestone_date is null then GETDATE()
else null
end as actual_completion_date

from profile_76057 p1
left join profile_76058 p2
on p1._id= p2.milestone
)


select t1._id, t1.planned_completion_date, t1.fy_timerange, t1.planned_start_date, t1.milestone_name, t1.projectId,t1.actual_start_date as actual_start_date, t1.comments, t1.actual_completion_date as milestone_date, t1.comments_2,actual_completion_date,
case 
when milestone_date is not null  then t1.comments_2
else null
end as comments_final
from t1




--New Field: comments_finalExpression: if(eq(ifNull($milestone_date,NA),NA),$comments,$comments_2)







--New Field: todayExpression: if(eq(ifNull($actual_start_date,NA),NA),$milestone_date,$today)

/*select p1._id, p1.planned_completion_date, p1.fy_timerange, p1.planned_start_date, p1.milestone_name, p1.projectId ,p2.actual_start_date, p2.comments, p2.actual_completion_date as milestone_date, p2.comments_2,
--current_date as today
--,sysdate as today

GETDATE() as today,
case 
when p2.actual_start_date ='NA' then p2.actual_start_date IS NULL 
when p2.milestone then today
else 'NA'
end as today
from profile_76057 as p1
left join  profile_76058 p2
on p1._id= p2.milestone*/