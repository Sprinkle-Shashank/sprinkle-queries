With tab1 as (Select p1.month_timerange, p1.project_code_new, sum(p1.amount) as amt,
p2.project_name, p2.focus, t1.name as entity,
case
  when is_array(p2.vertical) = false or get_array_length(p2.vertical) = 0 then 
  	   array(p2.vertical)
  else p2.vertical
end as vertical
From profile_55194 p1
left join profile_62881 p2
on p1.project_code_new=p2._id
left join tagElement_6575 as t1
on p2.entity = t1.id 
group by 1,2,4,5,6,7),

tab2 as (
Select t.*,vt
  From tab1 as t,t.vertical as vt
)

Select month_timerange,project_code_new,amt,project_name,focus,entity,t1.name as verticaltag
From tab2
left join tagElement_6575 as t1
on tab2.vt = t1.id 
