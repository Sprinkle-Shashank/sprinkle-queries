
with table1 as
( select p.projectid , p1.rating , rate.name as rating_average , count(rating_average) as rating_record_count
 from profile_16619 as p

left join profile_16864 p1
on p.projectid = p1.projectid

left join ds_mysql_prod_tagelement rate 
on p1.rating = rate.id

group by  p.projectid , p1.rating , rate.name ),

table2 as
(
  select p.projectid , p1.rating , rate.name as rating_average  , count(p.projectid) as record_count
 from profile_16619 as p

left join profile_16864 p1
on p.projectid = p1.projectid

left join ds_mysql_prod_tagelement rate 
on p1.rating = rate.id

group by  p.projectid, p1.rating , rate.name 
  )

select * from table2 