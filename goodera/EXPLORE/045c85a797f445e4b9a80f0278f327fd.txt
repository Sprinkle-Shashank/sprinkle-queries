with table1 as 
(
select p.projectid , substring(createddate,1,10) as createddate_update_1 , cast(createddate_update_1 as date) as create_1 from profile_18299 as p ),

table2 as 
(
select p.projectid , substring(createddate,1,10) as createddate_update_2 ,  t1.create_1 , cast(createddate_update_2 as date) as create_2 , datediff(day,create_1, current_date) as f1 ,  datediff(day, create_2 , current_date) as f2 , case when f1>f2 then create_1 else create_2 end as oldest_submission_date , row_number() over (partition by p.projectid order by p._id) as row from profile_18224 as p

left join table1 t1 on 
p.projectid = t1.projectid 
),

table3 as
(select p.projectid , oldest_submission_date from table2 as p where row=1),

table4 as
( select p.projectid , name_subunit  from profile_18224 as p )


select * from table4

 
  /*
  , datediff(day, CURRENT_DATE , createddate_update_1) as num 
  --sub_unit
  
  */