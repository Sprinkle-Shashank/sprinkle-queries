with x as (select xprojectid, financialperiod,datatablebase from sus_9539 where keyword in ('refrigerant_type_amount')
		   and datatablebase is not null),
		   
temp2 as (select * ,temp1.co2_refilled, temp1.dry_powder_refilled from x as temp,
		  unpivot temp.datatablebase as temp1 at row) ,/*extract table*/
		  
t as (select 'Emissions' as col
	   union all
	   select 'Consumptions' as col),
	   
 z as (select t2.name as projectid, timerange.name as time_timerange,coalesce(co2_refilled,0)+coalesce(dry_powder_refilled,0) as TotalCo2quantity,
	   TotalCo2quantity*0.001 as multiplicationfactor
	   'Scope 1' as scope ,
	   'Refrigerants' as type
	   
from temp2
	   
left join ds_mysql_prod_project t1
on t1.id=temp2.xprojectid
left join ds_mysql_prod_project t2
on t2.id=t1.parent/*projectid*/
	   
left join ds_mysql_prod_tagelement quarter
on quarter.id=temp2.financialPeriod
left join ds_mysql_prod_tagelement half
on half.id=quarter.parent
left join ds_mysql_prod_tagelement fy
on fy.id=half.parent
left join ds_mysql_prod_tagelement timerange
on timerange.id=fy.parent/*time_timerange*/
	  )
/*select * from z*/
select z.projectid,z.time_timerange,z.scope,z.type,
sum(case col
	when 'Emissions' then z.multiplicationfactor
	when 'Consumptions' then z.TotalCo2quantity
														
	end ) as Total,
 t.col as Dim
from z cross join t
group by z.projectid,z.time_timerange,z.scope,z.type,t.col