with temp as 
(
  select 'material_type'  as col
  union all
  select 'cotton_type' as col
)
,
table1 as 
(
select fy_timerange, brand, business, division, material,sum(weight) as weight, fkey
from profile_63455 
			
group by fy_timerange,brand, business, division,material, fkey),

table2 as (
select t1.fy_timerange, t1.brand, t1.business, t1.material, t2.cotton_type,sum((t2.volume/1000)) as bciweight,first_value(t1.weight) over(partition by t1.fy_timerange, t1.brand, t1.business, t1.material, t2.cotton_type,bciweight order by t1.weight rows between unbounded preceding and unbounded following)
from table1 t1

left join profile_62947 t2 on 
t1.fkey = t2.name

group by t1.fy_timerange, t1.brand, t1.business, t1.material, t2.cotton_type,t1.weight
)

select * from table2

  
