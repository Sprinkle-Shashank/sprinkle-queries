with lookup as (select 
				task.approvallog,
				task.data.subcat_output as suboutput,
				JSON_SERIALIZE(task.approvallog) as applog,
				p.subcat_output, 
				task.status, 
				split_part(split_part(prod.name,'|',1),'.',1) as ProjectCode,
				f.name as fy_timerange,
				m.name as Month,
				concat(ProjectCode,fy_timerange) as CODE, 
				split_part(prod.name,'|',3) as census, 
				p._id, 
				concat(concat(substring(cast(timestamp 'epoch' + CAST(task.modified AS BIGINT)/1000 * interval '1 second' as varchar), 1, 10),'T'), concat(split_part(cast(timestamp 'epoch' + CAST(task.modified AS BIGINT)/1000 * interval '1 second' as varchar), ' ',2),'.000Z')) as startdate,
				--cast(task.modified as timestamp),
				p.flag_deviation_delay,
				case when p.subcat_output is not NULL and p.flag_deviation_delay='1' then 1 else null end  as devreported, 
				case when (task.status like '%SUB%' and task.approvallog is null) or task.status='PENDING_APPROVAL' then null else 1 end as datacheck, 
				case when p.subcat_output is NULL or p.subcat_output = 0 or datacheck is null or datacheck = 0 then null else 1 end  as manager1, 
			case when dataCheck=1 and p.subcat_output = 0 then 1 else manager1 end  as manager2, 
				case when (task.status = 'SUBMITTED' or task.status = 'PENDING_APPROVAL' ) and suboutput is not NULL then 1 else null end as tasksReported,  
				case when ( task.status='PENDING_APPROVAL') and applog like '%APPROVED%' then 1 else null end  as firstLevelApproval,
				cast(task.approvallog as super) as status1 
				
				from profile_54963 p
left join ds_mongo_taskresponse task on
task.profileinstanceid=p._id
left join ds_mysql_prod_project prod on
prod.id=p.projectid
left join ds_mysql_prod_tagelement f on
p.fy=f.id
left join ds_mysql_prod_tagelement m on
p.month=m.id
			   order by startdate)






--select  count(distinct _id1) as total_no_of_activities,count(tasksReported) as no_of_activities_reported, (count(firstLevelApproval)) as approved_1st_manager, count(manager2) as approved_2nd_manager,count(devreported) as no_of_deviations from lookup4 p where ((fy_timerange1='2020-2021')) --AND ((projectcode1='CM001'))
 

select * from lookup p where  _id = '5fa4ce05bc9a8e7505b8956b'


--select * from lookup p where (fy_timerange='2022-2023') AND ((projectcode='CM001'))