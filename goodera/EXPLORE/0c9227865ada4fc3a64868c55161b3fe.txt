with lookup as (select 
				task.approvallog,
				JSON_SERIALIZE(task.approvallog) as applog,
				p.subcat_output, 
				task.status, 
				split_part(split_part(prod.name,'|',1),'.',1) as ProjectCode,
				f.name as fy_timerange,
				m.name as Month,
				concat(ProjectCode,fy_timerange) as CODE, 
				split_part(prod.name,'|',3) as census, 
				p._id, 
				p.flag_deviation_delay,
				case when p.subcat_output is not NULL and p.flag_deviation_delay='1' then 1 else null end  as devreported, 
				case when task.status like '%SUB%' and task.approvallog is null or task.status='PENDING_APPROVAL' then null else 1 end as datacheck,
				--case when task.status='PENDING_APPROVAL' then null else 1 end as datacheck, 
				
				case when p.subcat_output is NULL or p.subcat_output = 0 or dataCheck=0 then null else 1 end  as manager1, 
				case when dataCheck=1 and p.subcat_output = 0 then 1 else manager1 end  as manager2, 
				case when task.status='PENDING_APPROVAL' and applog like '%APPROVED%' then 1 else 0 end as st1,
				
				
				case when  task.status like '%SUB%' OR datacheck is null  and applog like '%APPROVED%' then 1 else null end as tasksReported,   
				
				
				
				--case when task.status like '%SUB%' and applog like '%APPROVED%' or task.status like '%PENDING%' and applog like '%APPROVED%'  then 1 else null end  as tasksReported, 
				
				case when p.subcat_output is not NULL or task.status='PENDING_APPROVAL' and applog like '%APPROVED%' then 1 else null end  as firstLevelApproval,
				
				
				cast(task.approvallog as super) as status1 from profile_54963 p
left join ds_mongo_prod_taskresponse task on
task.profileinstanceid=p._id
left join ds_mysql_prod_project prod on
prod.id=p.projectid
left join ds_mysql_prod_tagelement f on
p.fy=f.id
left join ds_mysql_prod_tagelement m on
p.month=m.id)


select  * from lookup p where ((fy_timerange='2021-2022')) and (projectcode1='CM001')
 

--select distinct(_id1) as _id, fy_timerange1 as fy, Month, devreported, datacheck, manager2,  tasksReported, firstLevelApproval, status, subcat_output, approvallog, ProjectCode1,flag_deviation_delay,( projectManager1) as project_Manager from lookup4 p where 
--((projectcode1='CM001')) and 
--((fy_timerange1='2022-2023')) --and (_id1 = '61d74b2676add8cd020c1040')


--select * from lookup p where (fy_timerange='2022-2023') AND ((projectcode='CM001'))