with s1 as(
Select t2.name as projectId,t.name as proj_location,t1.name as partner, nbd.timerange_timerange as fy_timerange, nbd.student_name, nbd.email, nbd.category, nbd.gender, nbd.college, nbd.state, nbd.city, nbd.city_tier, t11.name as course,tt1.name as discipline, nbd.semesetr, nbd.placed, nbd.contact, nbd.exam_fee, nbd.hard_copy, nbd.fee_waiver, nbd.total_fee, nbd.final_marks,po.impl_agency as imp_partner
from profile_63517 nbd
left join ds_mysql_prod_project t
on nbd.projectid=t.id
left join ds_mysql_prod_project t1
on t.parent=t1.id
left join ds_mysql_prod_project t2
on t1.parent=t2.id
left join profile_65552 po
on po.projectid=t.parent
left join ds_mysql_prod_tagelement t11
on nbd.discipline=t11.id
left join ds_mysql_prod_tagelement tt1
on t1.parent=tt1.id
),
s2 as (
Select s1.proj_location, s1.fy_timerange, s1.category, s1.gender, s1.college, s1.state, s1.city, s1.city_tier, s1.course, s1.semesetr, s1.placed, s1.partner, s1.projectId, s1.imp_partner, s1.discipline,count(*) no_benef,listagg(distinct s1.college,','),listagg(distinct s1.course,','),listagg(distinct s1.state,','),listagg(distinct s1.discipline,',')
  from s1
  group by s1.proj_location, s1.fy_timerange, s1.category, s1.gender, s1.college, s1.state, s1.city, s1.city_tier, s1.course, s1.semesetr, s1.placed, s1.partner, s1.projectId, s1.imp_partner, s1.discipline
)
Select * from s2