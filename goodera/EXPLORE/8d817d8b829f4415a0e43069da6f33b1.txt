
select  p.projectId as project ,fac.name as factory,cou.name as country,ven.name as vendor1,nvl2(SUBSTRING(vendor1, 1, POSITION(' (' in vendor1)), SUBSTRING(vendor1, 1, POSITION(' (' in vendor1)), vendor1) as vendor_name, case when vendor_name='' then vendor1 else vendor_name end as vendor, case when p.name_subunit is null or p.name_subunit=' ' then 'N/A' else p.name_subunit end  as unit , DATEPART(YEAR,date_enrollment) as year_new  , date as  "Communication in the Workplace" , date_2 as "Roles and Responsibilities of BC" , date_3 as "Risk Assessment" , date_4 as "Problem-Solving" , date_5 as "Managing Health and Safety", date_6 as "Grievance Mechanisms" , date_7 as "Negotiation Skills'", date_8 as "Strengthening Industrial Relations" , concat(fac.name ,-, unit) as Factory_unit


from profile_16619 p

left join ds_mysql_prod_project fac
on p.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id
  
where (p.status = 1400365 or p.status is null) and (cou.name <> 'Test Country' and cou.name <> 'GAP Inc.') and project ilike '%%'
group by  year_new , ven.name , fac.name , cou.name , vendor, unit,project, p.date, p.date_2 , p.date_3 , p.date_4 , p.date_5 , p.date_6 , p.date_7 , p.date_8
 