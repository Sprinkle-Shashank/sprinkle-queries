with sub1 as (
select p1.date_disbursal as fy_timerange,extract(year from cast (p1.date_disbursal as date)) as year, sum(p1.disbursed) as disbursed, p.name as projectid, 

case when p.name in ('Prasanna Trust', 'Kashtakari Panchayat', 'Shishu Mandir', 'SOUL', 'Narayanaamruta Medicare Foundation', 'SGBS Unnati Foundation','Makkala Jagariti', 'Reefwatch Marine Conservation', 'Nirvanavan Foundation', 'Win over cancer', 'Vipasana', 'Selco Foundation', 'CII Foundation', 'Disha') then 'Short-Term Projects' when p.name in ('Omashram Trust', 'One Billion Literates', 'Cuddles Foundation', 'Rainbow Homes (ANC Rainbow Homes)', 'Rainbow Homes (Bosco Rainbow Homes)', 'Rainbow Homes (Sanrakshan Rainbow Homes)','CUPA', 'Parikrma Foundation','Other Projects') then 'Long-Term Projects' else 'Other Projects' end as choose from profile_79979 p1
left join ds_mysql_prod_project p
on p.id=projectid
where disbursed is not NULL
group by p1.date_disbursal,p.name)

select fy_timerange,projectid,choose,disbursed,('FY('||p1.year||'-'||p1.year+1||')') as fy from sub1



/*with sub1 as (
select date_disbursal as fy_timerange,extract(year from cast(fy_timerange.start as date)) as start_year, extract(year from cast(fy_timerange.end as date)) as end_year, extract(month from cast(fy_timerange.start as date)) as start_month, extract(month from cast(fy_timerange.end as date)) as end_month, sum(disbursed) as disbursed, p.name as projectid, case when p.name in ('Prasanna Trust', 'Kashtakari Panchayat', 'Shishu Mandir', 'SOUL', 'Narayanaamruta Medicare Foundation', 'SGBS Unnati Foundation','Makkala Jagariti', 'Reefwatch Marine Conservation', 'Nirvanavan Foundation', 'Win over cancer', 'Vipasana', 'Selco Foundation', 'CII Foundation', 'Disha') then 'Short-Term Projects' when p.name in ('Omashram Trust', 'One Billion Literates', 'Cuddles Foundation', 'Rainbow Homes (ANC Rainbow Homes)', 'Rainbow Homes (Bosco Rainbow Homes)', 'Rainbow Homes (Sanrakshan Rainbow Homes)','CUPA', 'Parikrma Foundation','Other Projects') then 'Long-Term Projects' else 'Other Projects' end as choose from profile_79979
left join ds_mysql_prod_project p
on p.id=projectid
where disbursed is not NULL
group by date_disbursal,fy_timerange,p.name, start_year, end_year, start_month, end_month)
select fy_timerange, projectid, choose, disbursed, case when end_month<=4 then concat(concat(concat(concat('FY(',end_year-1),'-'),end_year),')') when start_month>3 then concat(concat(concat(concat('FY(',start_year),'-'),start_year+1),')') end as fy from sub1*/







