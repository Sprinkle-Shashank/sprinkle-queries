
 

with table_z0 as
( select p.projectid , p._id , quarter , fy , qua.name as quarter_update , f.name as fy_update , concat( quarter_update, ' , ') as quarter_update_new from profile_16862 as p
 
left join ds_mysql_prod_tagelement qua 
on p.quarter = qua.id
 
left join ds_mysql_prod_tagelement f 
on p.fy = f.id
 ),


table_z1 as 
( select p.projectid , concat(z0.quarter_update_new,z0.fy_update) as Latest_Impact_Data , name_subunit ,  row_number() over 
(partition by p.projectid
 order by p._id desc) as row from profile_16619 as p
 
left join ds_mysql_prod_project fac 
on p.projectId = fac.id

left join ds_mysql_prod_project ven 
on fac.parent = ven.id

left join ds_mysql_prod_project cou 
on ven.parent = cou.id
 
left join table_z0 z0 on 
p.projectid = z0.projectid 
 
 where cou.name != 'Test Country' and cou.name !='GAP Inc'
 
 )
 
 select * from table_z1 where row=1