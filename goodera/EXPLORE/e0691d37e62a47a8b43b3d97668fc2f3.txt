
with t1 as
(SELECT * 
FROM
(Select  projectId,  school,  attendance, date from profile_76590 p 

)
UNPIVOT (
    val FOR dim IN (attendance, session))

)

select  projectId, date,  reg.name as school,sum(val) as val,dim from t1 as p

left join ds_mysql_prod_tagelement reg
on P.school= reg.id



  Group By projectId, date, reg.name, reg2.name, Dim
  
  