with table1 as(
select yr.name as year , sum(total_participants) as s1, datepart(month,p1.date_of_formation) as month , case when month in ('2', '3', '4')
then '1st(Feb-Apr)'
when month in ('5','6','7')
then '2nd(May-Jul)'
when month in ('8', '9', '10')
then '3rd(Aug-Oct)'
when month in ('11', '12',  '1')
then '4th(Nov-Jan)'
end as quarter  , p1.projectid as project1
 
from profile_29179 p1
left join ds_mysql_prod_tagelement yr
on p1.year = yr.id  

group by yr.name , p1.date_of_formation , quarter , p1.projectid
  ),
table2 as (select  sum(pace_completion) as s2 , p2.projectid as project2
 
from profile_29179 p2
left join ds_mysql_prod_tagelement yr
on p2.year = yr.id

where lg_status = 847850 or lg_status is null
group by p2.projectid
		   ),
table3 as ( select  sum(enrollment) as s3 , p3.projectid as project3
 
from profile_29179 p3
left join ds_mysql_prod_tagelement yr
on p3.year = yr.id

where lg_status = 847850 or lg_status is null 

group by p3.projectid
		   ),
table4 as ( select t1.year as year , t1.quarter as quarter , t1.s1 as summ1 , t2.s2 as summ2, t3.s3 as summ3
					  from table1 t1
left join table2 t2
on t1.project1 = t2.project2
left join table3 t3
on t1.project1 = t3.project3
),

temp as(
select 'Total Participants' as dim
union all
select 'Total Graduated' as dim
union all
select 'Total Enrollment' as dim
)
select t4.year,t4.quarter,temp.dim ,case dim 
when 'Total Participants' then t4.summ1
when 'Total Graduated' then t4.summ2
when 'Total Enrollment' then t4.summ3

else null
end as value1
from table4 t4
cross join temp

group by t4.year , t4.quarter , temp.dim , t4.summ1, t4.summ2 , t4.summ3


