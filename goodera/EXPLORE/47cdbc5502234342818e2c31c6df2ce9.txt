 Select sum(p1.disbursed) as DisbursedAmount,f.name  as financial_year from profile_36762 p1
left join ds_mysql_prod_tagelement f on
p1.fy=f.id
group by f.name

 /*with x as (select p8.name as intervention_type,p1.name as projectcode from profile_27396 p1
 left join profile_28235 p8
on p8._id=p1.intervention_type),
y as (select case x.intervention_type when 'Indirect' then sum(p2.hdfc_cost_monthly+p6.monthly_cost)
                                      else sum(p2.hdfc_cost_monthly+p6.monthly_cost+p4.curr_yr_budget)
	                                  end as AllocatedAmount ,f.name as financial_year from profile_29974 p2 
	  left join x on x.projectcode=p2.prj_code
left join profile_27420 p4 on
p2.prj_code=p4.project_code 
left join profile_30171 p6 on
p2.prj_code=p6.prj_code

left join ds_mysql_prod_tagelement f on
p2.fy=f.id group by f.name,x.intervention_type) 
select * from y*/

/*join profile_29974 p2 on
p1._id=p2.prj_code


left join profile_27420 p4 on
p1._id=p4.project_code 
left join profile_30171 p6 on
p1._id=p6.prj_code

left join ds_mysql_prod_tagelement f on
p2.fy=f.id 
group by f.name,p8.name)
select sum(x.AllocatedAmount) as AllocatedAmount, x.financial_year from x group by x.financial_year*/

/*with x as (select sum(p2.payment_amount) as DisbursedAmount, f.name  as financial_year from profile_27398 p2
left join ds_mysql_prod_tagelement f on
p2.fy=f.id
group by f.name), 

y as  (Select sum(p1.two_percent) as TwoPercentAmount,f.name  as financial_year from profile_36762 p1
left join ds_mysql_prod_tagelement f on
p1.fy=f.id
group by f.name), 
z as (select x.financial_year from x
union select y.financial_year from y)


select x.DisbursedAmount, y.TwoPercentAmount, z.financial_year from z
left join x on z.financial_year=x.financial_year
left join y on z.financial_year=y.financial_year*//* year over year summary final two_percent, disbursed*/

/*select  split_part(split_part(prj_code,'|',1),'.',1)  as projectcode , prj_code from  profile_30171 p*/
/*select p1.name as Project_code  ,p7.name as ImplementingAgency,  p9.name as ProjectLive, p8.name as intervention_type, p10.name as CoreArea , concat(concat(split_part(p1.start_date,' ',1),' to '), split_part(p1.end_date,' ',1)) as duration, m.name as project_manager ,f.name as fy_timerange ,sum(p2.hdfc_cost_monthly+p6.monthly_cost+p4.curr_yr_budget) as AmountallocatedforthecurrentFYinINR/*,sum(p2.hdfc_cost_monthly+p6.monthly_cost) as AmountallocatedforQ1inINR, p6.month_number as quarter*/
from profile_27396 p1
left join profile_30171 p6 on
p1._id=p6.prj_code
left join profile_27395 p7 on 
p7._id=p1.ngo_partner
left join profile_28235 p8
on p8._id=p1.intervention_type
left join ds_mysql_prod_tagelement p9
on p9.id=p1.monitoring_live
left join ds_mysql_prod_tagelement p10
on p10.id=p1.focus_area
left join profile_29974 p2 on
p1._id=p2.prj_code
left join profile_27420 p4 on
p1._id=p4.project_code
left join ds_mysql_prod_tagelement f on
p1.fy=f.id
left join ds_mysql_prod_tagelement m on
p1.project_manager=m.id
group by  p1.name,p7.name, p9.name,p8.name ,p10.name,duration,m.name ,f.name


union all
select p1.name as Project_code, '' as ImplementingAgency,  '' as ProjectLive, '' as intervention_type, '' as CoreArea , '' as duration,'' as project_manager , '' as fy_timerange , 0 as AmountallocatedforthecurrentFYinINR
/*, 0 as  AmountallocatedforQ1inINR,0 as quarter*/ from profile_29974 p2 
left join profile_27396  p1 on p1._id=p2.prj_code
union all
select  p1.name as Project_code, '' as ImplementingAgency,  '' as ProjectLive, '' as intervention_type, '' as CoreArea , '' as duration,'' as project_manager , '' as fy_timerange , 0 as AmountallocatedforthecurrentFYinINR
/*,0 as  AmountallocatedforQ1inINR,0 as quarter*/ from profile_27420 p3
left join profile_27396  p1 on p1._id=p3.project_code
union all
select p1.name as Project_code,  '' as ImplementingAgency,  '' as ProjectLive, '' as intervention_type, '' as CoreArea , '' as duration, '' as project_manager , '' as fy_timerange, 0 as AmountallocatedforthecurrentFYinINR
/*, 0 as  AmountallocatedforQ1inINR,0 as quarter*/ from profile_27398 p4
left join profile_27396  p1 on p1._id=p4.project_name 
union all
select p1.name as Project_code, '' as ImplementingAgency,  '' as ProjectLive, '' as intervention_type, '' as CoreArea , '' as duration, '' as project_manager , '' as fy_timerange, 0 as AmountallocatedforthecurrentFYinINR
/*,0 as  AmountallocatedforQ1inINR,0 as quarter*/ from profile_27398 p5
left join profile_27396  p1 on p1._id=split_part(p5.project_renew,'[',1)*/


/*with main as (select r.name as fy_timerange, cast((split_part(split_part(prod.name,'|',1),'.',1)) as varchar) as ProjectCode,CONCAT(ProjectCode,fy_timerange) as code from profile_54963 p
left join ds_mysql_prod_project prod on
prod.id=p.projectid
left join ds_mysql_prod_tagelement r on
r.id=p.fy),

lookup as (select cast(q.name as varchar) as ProjectCode,f.name as fy_timerange,m.name as Project_Manager,CONCAT(ProjectCode,fy_timerange) as code
from profile_27420 d
left join ds_mysql_prod_tagelement f on
d.fy=f.id
left join ds_mysql_prod_tagelement m on
d.project_manager=m.id
left join profile_27396 q on
d.project_code=q._id		   
union all
select cast(c.name as varchar)as ProjectCode,f.name as fy_timerange,m.name as Project_Manager,CONCAT(ProjectCode,fy_timerange) as code 
from profile_27396 c	
left join ds_mysql_prod_tagelement f on
c.fy=f.id
left join ds_mysql_prod_tagelement m on
c.project_manager=m.id),

main2 as (
select b.fy_timerange as fy,q.Project_Manager as level1, b.ProjectCode from main b
left join lookup q on
q.code = b.code
group by b.fy_timerange,q.Project_Manager, b.ProjectCode),

level1tab as (select m.name as level1 ,p.approver as level2,p.name as level1email from profile_27424 p
left join ds_mysql_prod_tagelement m on
m.id = p.pm_name),

level2tab as (select m.name as level1 , z.level1 as level2 from profile_27424 p
left join ds_mysql_prod_tagelement m on
m.id = p.pm_name
left join level1tab z on
z.level1email = p.approver)

select p.*,d.level2 from main2 p
left join level2tab d on
d.level1 = p.level1*/






	




