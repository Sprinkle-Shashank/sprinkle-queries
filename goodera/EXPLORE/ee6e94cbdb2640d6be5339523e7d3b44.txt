with Lookup as (Select b.name as ProjectCode1,d.name as fy_timerange1,d.name as CODE1
from profile_27420 d
left join ds_mysql_prod_tagelement b on
d.fy=b.id
union
Select c.name as ProjectCode,a.name as fy_timerange,CONCAT(c.name,CONCAT(CONCAT('[',a.name),']')) as CODE
from profile_27396 c
left join ds_mysql_prod_tagelement a on
c.fy=a.id),
Asset_details as(
select CODE,Project_Manager,ProjectCode,State,District,Village,focusarea,fy_timerange,Date_of_Creation,Asset_Category,Asset_sub_Category,Beneficiary_Type,No_of_Beneficiaries,Picture1,Picture2 from(select CODE,Project_Manager,ProjectCode,l.state as State,l.district as District,l.village as Village,focusarea,fy_timerange,Date_of_Creation,
Asset_Category,Asset_sub_Category,Beneficiary_Type,No_of_Beneficiaries,Picture1,Picture2 from(select CODE,m.name as Project_Manager,ProjectCode,CensusCode,focusarea,fy_timerange,Date_of_Creation,Asset_Category,Asset_sub_Category,Beneficiary_Type,No_of_Beneficiaries,Picture1,Picture2 from
(select  ProjectCode,CensusCode, focusarea,fy_timerange,CONCAT(ProjectCode,CONCAT(CONCAT('[',fy_timerange),']')) as CODE,Date_of_Creation,Asset_Category,Asset_sub_Category,Beneficiary_Type,No_of_Beneficiaries,Picture1,Picture2  from 
(select  split_part(split_part(prod.name,'|',1),'.',1)as ProjectCode,split_part(prod.name,'|',3) as CensusCode, t.name as fy_timerange,p.date as Date_of_Creation ,p.focus_area as focusarea,p.asset_cat as Asset_Category,s.name as Asset_sub_Category,
 b.name as Beneficiary_Type,p.bennum as No_of_Beneficiaries,p.pic1 as Picture1,p.pic2 as Picture2  from profile_59426 p 
left join ds_mysql_prod_project prod on
prod.id=p.projectid
left join ds_mysql_prod_tagelement t on
p.fy=t.id
left join ds_mysql_prod_tagelement s on
p.cat=s.id
left join ds_mysql_prod_tagelement b on
p.bene=b.id
))
left join profile_27396 n on
ProjectCode=n.name
left join ds_mysql_prod_tagelement m on
n.project_manager=m.id)
left join profile_27489 l on
CensusCode=l.name)),Base as(select l.Project_Manager,l.ProjectCode,l.State,l.District,l.Village,l.focusarea,l.fy_timerange,l.Date_of_Creation,l.Asset_Category,l.Asset_sub_Category,l.Beneficiary_Type,sum(l.No_of_Beneficiaries) as No_of_Beneficiaries,l.Picture1,l.Picture2 from Lookup p 
left join Asset_details l on 
p.CODE1=l.CODE 
						group by
l.Project_Manager,l.ProjectCode,l.State,l.District,l.Village,l.focusarea,l.fy_timerange,l.Date_of_Creation,l.Asset_Category,l.Asset_sub_Category,l.Beneficiary_Type,l.Picture1,l.Picture2 )
select * from Base










