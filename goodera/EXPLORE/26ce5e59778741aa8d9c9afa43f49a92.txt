 with table11 as
( select p.projectid, p._id ,sum(num_females) as num_females, sum(num_females_graduated) as num_females_graduated, type_program from profile_4227 p group by p.projectid , p.name , p._id , type_program  ),

batch_completed as (  select p._id,p.projectid, count(*) as completed from profile_4227 p
					 where end_date is not null
					 group by p.projectid, p._id),
batch_ongoing as ( select p._id,p.projectid, count(*) as ongoing from profile_4227 p
					 where end_date is null
					 group by p.projectid, p._id),
					 
table12 as
( select p.projectid , t11.projectid, p._id, p.name , name_factory , name_vendor , t11.num_females_graduated from profile_54646 p
 
 left join table11 t11 on 
 p.projectid = t11.projectid
 )
 
 select * from table12
 