
with table1 as
(
   select p.projectid , p._id , p.name , name_country , name_vendor , name_vendor_filter , name_rp , name_vendor_filter as Partner_name , substring(Partner_name ,0,2) as First_Value, case when First_Value='V' then 'Vendor Partner' else 'Community Partner' end as Partner_type , p2.sourcing_yn , p2.vpid_1 , p2.vpid_2 , p2.child_vpid_autocal , case when First_Value='V' and p2.sourcing_yn=57472 then cast(p2.vpid_1 as varchar) when First_Value='V' and p2.sourcing_yn=57473 then cast(p2.vpid_2 as varchar) when First_Value='V' then cast(p2.child_vpid_autocal as varchar) end as Vendor_partner_ID, rtrim(name_vendor,':') from profile_54646 p
 
   left join profile_52162 p2 on
   p.name_vendor = p2.vendor
  
  ),
  
  table2 as
  (
	 select p.* , concat(' NG: ',p.name) as new_name from profile_5997 p
	),
	
	table3 as
	(
	   select p2.projectid , p2.name_vendor , t2.new_name from profile_54646 p2
	  
	  left join table2 t2 on
	p2.name_vendor = t2.new_name
	  )
  
  select * from table3
  
  /*
   
   left join profile_52162 p2 on
   p.name_vendor = p2.vendor
   
   case when partner_type='Vendor Partner' and p2.sourcing_yn=57472 then cast(p2.vpid_1 as varchar) when partner_type='Vendor Partner' and p2.sourcing_yn=57473 then cast(p2.vpid_2 as varchar) when partner_type='Vendor Partner' then cast(p2.child_vpid_autocal as varchar) end as Vendor_partner_ID
   */
   