--Budget Summary
--select * from profile_82837
--CSR WEB Links 
--select * from profile_82839
--Capital Assets Creation
--select * from profile_82840
--Unspent Amount
--select * from profile_82841
--Project Alllocation
--select * from profile_82842


select _id, projectId, fy_timerange, COALESCE(netprofit, 0) as netprofit, COALESCE(prescribed_csr, 0) as prescribed_csr, COALESCE(setoff_amount, 0) as setoff_amount, COALESCE(setoff_amount_preceding, 0) as setoff_amount_preceding, COALESCE(surplus_previously, 0) as surplus_previously, COALESCE(actual_csr, 0) as actual_csr, COALESCE(overhead_expenses, 0) as overhead_expenses, COALESCE(impact_assesment, 0) as impact_assesment, COALESCE(unspent_account, 0) as unspent_account, (COALESCE(prescribed_csr, 0) + COALESCE(surplus_previously, 0) + COALESCE( setoff_amount, 0)) as total_csr_obligation, ( COALESCE(actual_csr, 0) + COALESCE(overhead_expenses, 0) + COALESCE(impact_assesment, 0) ) as total_amount_current,

case when 
(COALESCE(actual_csr,0)+COALESCE(overhead_expenses,0)+COALESCE(impact_assessment,0)-COALESCE(prescribed_csr,0))<=0 then 0 else 
(COALESCE(actual_csr,0)+COALESCE(overhead_expenses,0)+COALESCE(impact_assessment,0)-COALESCE(prescribed_csr,0)) end as excess_current
				  
from profile_82837
group by 
_id, projectId, fy_timerange, netprofit, prescribed_csr, setoff_amount, setoff_amount_preceding, surplus_previously, actual_csr, overhead_expenses, impact_assesment, unspent_account
