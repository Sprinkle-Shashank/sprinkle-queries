with s2 as (Select p.name as projectid,p1.name as pmilestone,t1.name as status, a.comm, t2.name as month, a.date, a.actual_start_date, a.actual_end_date,
p1.milestone as milestone,p1.start, p1.end, p1.name,

case
when t1.name = 'Completed' then 'Completed'
when (t1.name = 'In Progress' and a.date > p1.end) OR (t1.name = 'Yet to Start' and a.date > p1.start) then 'Delayed'
when t1.name = 'Yet to Start' and a.date <= p1.start then 'Yet to Start'
when t1.name = 'In Progress' and a.date <= p1.end then 'In Progress'
else 'N/A'
end as new_status,

case 
when a.actual_end_date IS NOT NULL then 1
else 0 end as num,

case
when num = 1 then (a.actual_start_date || '|' || a.actual_end_date) 
when num = 0 then (p1.start || '|' || p1.end) 
else NULL end as fy_timerange

,row_number() over (partition by a.date,t1.name,a.comm,a.actual_start_date, a.actual_end_date order by a.date desc) as row_number


--, max(date) 
from profile_58278 a

left join ds_mysql_prod_project p on p.id = a.projectid
left join profile_58277 p1 on p1._id= a.milestone
left join ds_mysql_prod_tagelement t1 on t1.id=a.status
left join ds_mysql_prod_tagelement t2 on t2.id=a.month)

Select * from s2 
where row_number = 1


--group by p.name, p1.name,a.fy_timerange,a.milestone