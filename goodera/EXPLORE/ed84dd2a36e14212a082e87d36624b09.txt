with sub1 as(
select projectId as proj_location, t1.name as partner, t2.name as projectId, no_girls, no_boys, school_name, class, fy_timerange
from profile_67673 ss
left join ds_mysql_prod_project t
on ss.projectid=t.id
left join ds_mysql_prod_project t1
on t.parent=t1.id
left join ds_mysql_prod_project t2
on t1.parent=t2.id),
sub2 as
(
select pd.location, s1.proj_location, s1.partner, s1.projectId, mr.impl_agency as imp_partner, sum(no_girls) as Females, sum(no_boys) as Males, school_name, class, fy_timerange
from sub1 s1
left join profile_65603 pd
on s1.proj_location=pd.projectId
left join profile_65552 mr
on mr.projectId=s1.partner
group by proj_location, class, fy_timerange, partner, s1.projectId, location, impl_agency, school_name),
sub3 as(
select s2.*, 
  case when class=836474 then 6
  when class=836475 then 7
  when class=836476 then 8
  when class=836477 then 9
  when class=836478 then 10
  when class=836479 then 11
  when class=836480 then 12
  when class=836481 then 13
  when class=836482 then 14
  when class=836483 then 15
  when class=836484 then 16
  else 17 end as age
  from sub2 s2)
  select * from sub3