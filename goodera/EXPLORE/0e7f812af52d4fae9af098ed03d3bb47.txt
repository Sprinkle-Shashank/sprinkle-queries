
 
with table7 as ( SELECT _id,mon.creatorid, u.email as cemail, mon.modifierid, m.email as memail
from ds_mongo_profileinstance mon
left join ds_mysql_prod_user u on
mon.creatorid = u.id
left join ds_mysql_prod_user m  on
mon.modifierid = m.id
where mon.profileId='4227' and mon.active = 't' and mon.securitycontextid is not null
			 ),		
creationdate_table_for_batch as (	select p._id,p.projectid,p.name,/*substring(createddate,1,10)*/ createddate as batch_date,t7.cemail,p.end_date_2 from profile_4227 p   
 left join table7 t7 on
	p._id = t7._id	
	where end_date_2 is null),
	
table8 as ( SELECT _id,mon.creatorid, u.email as cemail, mon.modifierid, m.email as memail
from ds_mongo_profileinstance mon
left join ds_mysql_prod_user u on
mon.creatorid = u.id
left join ds_mysql_prod_user m  on
mon.modifierid = m.id
where mon.profileId='4228' and mon.active = 't' and mon.securitycontextid is not null
			 ),	
 
 creationdate_table_for_module as (	select p._id,p.class, p.projectid,/*substring(createddate,1,10)as*/createddate as module_date,row_number() over 
(partition by class
 order by createddate desc) as row,t8.cemail from profile_4228 p
			left join table8 t8 on
			p._id = t8._id					  )	,
	
table5 as ( select * from creationdate_table_for_batch 
			--where row = 1 
		   ),
			
 table6 as ( select * from creationdate_table_for_module 
			where row = 1 ),
  
 creation_date as ( select t5._id,t5.projectid,concat(t5._id , t5.projectid) as unique , to_char(batch_date , 'YYYY-MM-DD') as batch_date ,t5.cemail as batch_email,to_char(t6.module_date,'YYYY-MM-DD') as module_date,t6.cemail as module_email from table5 t5
  
  left join table6 t6 on 
  t5._id= t6.class )	

 select * from creation_date
