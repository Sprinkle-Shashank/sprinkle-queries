with test as(
select p.p_id,p.patient_name,tb,p.s_clinic_type,p.oral,p.hiv,p.general from profile_59462 p cross join p.tb tb where p.p_id=5380
  	),
  test2 as(
  select p.p_id,p.patient_name,p.tb,t.name as tb_name,p.s_clinic_type,p.oral,p.hiv,p.general from test p left join ds_mysql_prod_tagelement t on p.tb=t.id
	),
	test3 as (
	  select p.p_id,p.patient_name,p.tb,p.tb_name,p.s_clinic_type,t.name as clinic_name,p.oral,p.hiv,p.general from test2 p left join ds_mysql_prod_tagelement t on p.s_clinic_type=t.id
	),
	test4 as (
	select p.p_id,p.patient_name,p.tb,p.tb_name,p.s_clinic_type,p.clinic_name,p.oral,t.name as oral_name,p.hiv,p.general from test3 p left join ds_mysql_prod_tagelement t on p.oral=t.id
		),
		pivot as (
		select  'tb_name' as c from test4
		union all
		select  'clinic_name' as c from test4
		union all
		select  'oral_name' as c from test4
		  )
		  select p.p_id,p.patient_name,t.c as category,
		  case c
		  	when 'tb_name' then p.tb_name
			when 'clinic_name' then p.clinic_name
			when 'oral_name' then p.oral_name
			else null
			end as value
			from test4 p cross join pivot t