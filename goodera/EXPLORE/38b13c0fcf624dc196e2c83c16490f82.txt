
			
with			
test2a as(
select concat(p.f_reg_date,concat('|',p.f_reg_date)) as fy_timerange, p.projectid, p.p_id, p.f_category, p.oral, p.diabetes, p.sti, p.hiv, p.vision, p.hypertension from profile_59462 p
  ),

test2 as(
select p.fy_timerange, p.projectid, p.p_id, p.f_category, decode(p.oral,1012465,0,null,0,1) as oral_hygiene, decode(p.diabetes,1012463,0,null,0,1) as diabetes, decode(p.sti,1012470,0,null,0,1) as sexually_transmitted_diseases, decode(p.hiv,1012483,1,1012478,1,0) as hiv, decode(p.vision,1012444,0,null,0,1) as vision_screening, decode(p.hypertension,1012468,0,null,0,1) as hypertension from test2a p
),

pivot2 as(
select 'oral_hygiene' as disease from test2 
	  union all
select 'diabetes' as disease from test2 
	  union all
select 'sexually_transmitted_diseases' as Disease from test2 
	  union all
select 'hiv' as disease from test2 
	  union all
select 'vision_screening' as disease from test2 
	  union all
select 'hypertension' as disease from test2 
)

select * from pivot2
/*
final2a as(
select p.projectid, p.fy_timerange, p.p_id, p.f_category, t.disease,
  case disease
  	when 'oral_hygiene' then p.oral_hygiene
	when 'diabetes' then p.diabetes
	when 'sexually_transmitted_diseases' then p.sexually_transmitted_diseases
	when 'hiv' then p.hiv
	when 'vision_screening' then p.vision_screening
	when 'hypertension' then p.hypertension
	else null
	end as final_sum
from test2 p cross join pivot2 t
),

final2 as(
select p.projectid, p.fy_timerange, p.p_id, p.f_category, p.disease, sum(final_sum) as final_sum from final2a p where final_sum is not null group by 1,2,3,4,5
)
select p.fy_timerange, t.name as projectid, p.f_category, p.disease, sum(final_sum) as final_sum
from final2 p
left join ds_mysql_prod_project as t
on t.id = p.projectid
group by 1,2,3,4 
*/
	