with sub1 as(
SELECT sq.module_name, sq.fy_timerange, sq.score, sq.score2, pd.pvh_id, mr.timeperiod_timerange, mr.region, extract(year from cast(fy_timerange.start as date)) as year
FROM profile_62486 sq
LEFT JOIN profile_62948 pd
ON sq.project_id=pd.project_id
LEFT JOIN profile_60928 mr
ON pd.pvh_id=mr.factory_id
left join ds_mysql_prod_tagelement t 
on mr.region=t.id
WHERE year>=2020 AND pd.pvh_id IS NOT NULL AND sq.pre_post_yn=1105732),

sub2 as(
SELECT module_name, fy_timerange, score, score2, pvh_id, region, timeperiod_timerange
FROM sub1
GROUP BY module_name, fy_timerange, score, score2, pvh_id, region, timeperiod_timerange
ORDER BY timeperiod_timerange DESC),

sub3 as(
  Select s2.*, country from sub2 s2, s2.region country)
														

Select fy_timerange, score, pvh_id, region, t1.name as Region2, substring(t2.name,3, LEN(t2.name)-2) as module_name
FROM sub3 s3
LEFT JOIN ds_mysql_prod_tagelement t1 on t1.id = s3.country
LEFT JOIN ds_mysql_prod_tagelement t2 on t2.parent =s3.module_name
