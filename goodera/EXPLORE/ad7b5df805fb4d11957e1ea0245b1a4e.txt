with sub1 as(
SELECT sq.module_name, sq.name, sq.fy_timerange, sq.score, sq.score2, pd.pvh_id, mr.region, extract(year from cast(fy_timerange.start as date)) as year
FROM profile_62486 sq
LEFT JOIN profile_62948 pd
ON sq.project_id=pd.project_id
LEFT JOIN profile_60928 mr
ON pd.pvh_id=mr.factory_id
left join ds_mysql_prod_tagelement t 
on mr.region=t.id
WHERE year>=2020 AND pd.pvh_id IS NOT NULL AND sq.start_date>=pd.offset_date),

sub2 as(
SELECT module_name as program_type, name, fy_timerange, score, score2, pvh_id, region
FROM sub1
GROUP BY module_name, fy_timerange, score, name, score2, pvh_id, region
),

sub3 as(
  Select s2.*, country from sub2 s2, s2.region country
)
														

Select fy_timerange, score, pvh_id, t1.name as Region, substring(t2.name,3, LEN(t2.name)-2) as module_name, t3.name as program_type
FROM sub3 s3
LEFT JOIN ds_mysql_prod_tagelement t1 on t1.id = s3.country
LEFT JOIN ds_mysql_prod_tagelement t2 on t2.id =s3.program_type
left join ds_mysql_prod_tagelement t3 on t3.id=t2.parent
GROUP BY s3.fy_timerange, s3.score, s3.pvh_id, t1.name, t2.name,t3.name, s3.score2, s3.name