
with
t3 as
(SELECT * 
FROM
(Select   projectId, select_name, teacher_name, class, exam_type, eh_beginner, engsmall_letter, eng_cap_letter, eh_word, eh_sentence, eh_story, eng_grammar, eng_story_comp, eng_vocab, eng_conversat, mat_3_beginner, mat_3_recognition, mat_3_addition, mat_3_subtraction, mat_3_multiplication, mat_3_division, mat_3_odd_even, mat_4_5_fraction, mat_4_unitary_method, mat_4_profit_loss, 5_hcf, 5_lcm, 5_dec, 5_percentage, fy_timerange from profile_65267 p
)
UNPIVOT (
    val FOR dim IN (eh_beginner, engsmall_letter, eng_cap_letter, eh_word, eh_sentence, eh_story, eng_grammar, eng_story_comp, eng_vocab, eng_conversat, mat_3_beginner, mat_3_recognition, mat_3_addition, mat_3_subtraction, mat_3_multiplication, mat_3_division, mat_3_odd_even, mat_4_5_fraction, mat_4_unitary_method, mat_4_profit_loss))

)
,
t4 as (
select projectId, class,sum(val) as val,dim,select_name, teacher_name,  exam_type,fy_timerange from t3 as p


where val is not null

Group By projectId,  dim,class,select_name, teacher_name,  exam_type,fy_timerange
  ),
  t5 as (select t1.*,clas from t4 t1 , t1.class as clas)
  
  select projectId,  clas   , val,dim,select_name, teacher_name,  exam_type,fy_timerange from t5 as p

