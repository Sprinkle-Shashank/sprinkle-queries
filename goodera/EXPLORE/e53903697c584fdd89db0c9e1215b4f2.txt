WITH SUB1 AS (
  SELECT PD.description,
  SUBSTRING(PD.project_start_date,1,10) AS project_start_date,
  SUBSTRING(PD.project_end_date,1,10) AS project_end_date,
  SUBSTRING(PD.mou_start_date,1,10) AS mou_start_date,
  SUBSTRING(PD.mou_end_date,1,10) AS mou_end_date,
  P1.name AS projectname,
  P2.name AS partner,
  PD.state
  project_start_date|| '-' ||project_end_date AS project_duration
  
  FROM profile_81995 AS PD

  LEFT JOIN ds_mysql_prod_project AS P1
  ON PD.projectid = P1.id

  LEFT JOIN ds_mysql_prod_project AS P2
  ON P1.parent = P2.id
  ),
  
  SUB2 AS (
	SELECT description, project_start_date, project_end_date, mou_start_date, mou_end_date, projectname, partner, ST
	
	FROM SUB1 AS S1,
	
	S1.state AS ST
  )

	SELECT description, project_start_date, project_end_date, mou_start_date, mou_end_date, projectname, partner,
	LISTAGG(STATE.name,', ') AS state
	
	FROM SUB2
	
	LEFT JOIN ds_mysql_prod_tagelement AS STATE
	ON SUB2.ST = STATE.id
	
	GROUP BY description, project_start_date, project_end_date, mou_start_date, mou_end_date, projectname, partner
/*case 
	when profileid=27395 then data.donor_details_2
	when profileid=27405 then data.donor_reference2
    when profileid=80183 then data.reference_details
  end as Donor_Reference_2,
case 
	when profileid=27395 then data.comment
	when profileid=27405 then data.comment
    when profileid=80183 then data.comments_registration
    when profileid=80188 then data.comments_registration
  end as Comments_Remarks,
case 
	when profileid=27395 then data.external_party
    when profileid=80183 then data.third_party
    when profileid=80188 then data.third_party
  end as Any_external_third_party_evaluations_conducted,
case 
	when profileid=27395 then data.impact_indicators
  end as Does_the_organization_have_quantitatiive_qualitative_impact_indicators,
case 
	when profileid=27395 then data.strategy
    when profileid=80183 then data.details_sustainability
  end as Please_explain_the_strategy_for_Sustainability_of_the_Projects_Undertaken,
case 
	when profileid=27395 then data.strategy_2
    when profileid=80183 then data.sustainability_projects
    when profileid=80188 then data.sustainability_projects
  end as Is_there_a_well_defined_strategy_for_sustainability_of_the_projects_undertaken'
case 
	when profileid=27395 then data.env_consideration
    when profileid=80183 then data.activities_consideration
    when profileid=80188 then data.activities_consideration
  end as Are_the_programmes_activities_planned_with_environment_consideration,
case 
	when profileid=27395 then data.progress_indicators
  end as Is_there_a_corresponding_method_available_to_gauge_the_progress_of_the_impact_indicators_identified,
case 
	when profileid=27395 then data.any_ngoscbos
    when profileid=80183 then data.network_ngo
  end as Does_the_organization_network_with_any_other_NGOs_CBOs_and_Government_bodies_etc_in_its_operational_area'
case 
	when profileid=27395 then data.articul_indicators
  end as How_are_the_impact_indicators_articulated_for_each_activity_project,
case 
	when profileid=27395 then data.articul_indicators_2
    when profileid=80183 then data.impact_indicator
    when profileid=80188 then data.impact_indicator
  end as Are_there_clearly_articulated_impact_indicators_for_each_of_the_activity_project,
case 
	when profileid=27395 then data.monitor_progress
	when profileid=27405 then data.monitor_progress
  end as Please_explain_the_monitoring_methods_of_the_organization_to_track_the_progress_of_projects,
case 
	when profileid=27395 then data.monitor_progress_2
	when profileid=27405 then data.monitor_progress_2
    when profileid=80183 then data.participate_board
  end as Does_the_organization_have_well_defined_monitoring_methods_to_track_the_progress_of_its_projects,
case 
	when profileid=27395 then data.local_network
    when profileid=80183 then data.local_professional
    when profileid=80188 then data.local_professional
  end as Is_the_organization_part_of_any_local_professional_network_forum_in_its_area_field,
case 
	when profileid=27395 then data.accreditation
    when profileid=80183 then data.organization
    when profileid=80188 then data.organization
  end as Please_select_the_accreditation_organization,
case 
    when profileid=80183 then data.national_international
    when profileid=80188 then data.national_international
  end as Is_the_organization_empanelled_enlisted_with_any_National_International_body_of_Accrediation_Credibility_assurance,
case 
	when profileid=27395 then data.org_accrediation
  end as What_is_the_average_years_of_experience_of_the_staff,
case 
	when profileid=27395 then data.years_experience
	when profileid=27405 then data.years_experience
  end as Please_describe_the_structured_opportunities_the_organization_may_have_to_engage_volunteers,
case 
	when profileid=27395 then data.structur_opportunity_2
  end as Does_the_orgnanization_have_structured_opportunities_to_engage_volunteers,
case 
	when profileid=27395 then data.provide_training
  end as Does_the_organization_provide_training_to_its_staff,
case 
	when profileid=27395 then data.respons_correction_2
  end as Is_there_any_individual_responsiblity_for_the_Monitoring_and_mid_term_correction,
case 
	when profileid=27395 then data.respons_correction
  end as What_are_the_individual_responsibilities_for_monitoring_and_mid_term_correction,
case 
	when profileid=27395 then data.roles_responsibility
    when profileid=80188 then data.roles_responsibilities
  end as Please_provide_a_brief_on_the_roles_and_responsibilities_of_personnel_in_the_organization_including_the_volunteers,
case 
	when profileid=27395 then data.roles_responsibility_2
  end as Does_the_organization_have_clearly_defined_roles_and_responsibilities_of_each_person_inlcuding_volunteers,
case 
	when profileid=27395 then data.trained_personnel
  end as Does_the_organization_have_trained_and_experienced_personnel_to_report_on_the_progress_financial_and_project_related_and_impact_of_the_programme
case 
	when profileid=27395 then data.staff_number
	when profileid=27405 then data.staff_number
  end as How_many_staff_does_the_organization_have_for_day_to_day_operations
case 
	when profileid=27395 then data.staff_number_2
	when profileid=27405 then data.staff_number_2
  end as How_many_staff_does_the_organization_have_for_day_to_day_operation
case 
	when profileid=27395 then data.part_time
	when profileid=27405 then data.part_time
  end as Number_of_part_time_employees
case 
	when profileid=27395 then data.full_term
	when profileid=27405 then data.full_term
    when profileid=80183 then data.on_role_employees
    when profileid=80188 then data.on_role_employees
  end as Number_of_full_time_employees
case 
	when profileid=27395 then data.cost_beneficiary
	when profileid=27405 then data.cost_beneficiary
    when profileid=80183 then data.cost_per_beneficiary
    when profileid=80188 then data.cost_per_beneficiary
  end as Cost_per_beneficiary
case 
	when profileid=27395 then data.outreach_lastfy
	when profileid=27405 then data.outreach_lastfy
    when profileid=80183 then data.direct_beneficiaries
    when profileid=80188 then data.direct_beneficiaries
  end as Total_outreach_in_last_FY
case 
	when profileid=27395 then data.org_objective
    when profileid=80183 then data.objective
    when profileid=80188 then data.objective
  end as Main_objective_of_the_organisation
case 
	when profileid=27395 then data.socioeconomic
    when profileid=80183 then data.percentage_socio_economic_auto
    when profileid=80188 then data.percentage_socio_economic_auto
  end as Percentage_of_beneficiaries_belong_to_low_socioeconomic_background
case 
	when profileid=27395 then data.socioeconomic_2
    when profileid=80183 then data.percentage_socio_economic
    when profileid=80188 then data.percentage_socio_economic
  end as What_percentage_of_beneficiaries_belong_to_low_socioeconomic_background
case 
	when profileid=27395 then data.target_beneficiary
    when profileid=80183 then data.target_beneficiary
    when profileid=80188 then data.target_beneficiary
  end as Target_beneficiary
case 
	when profileid=27395 then data.donor_details
	when profileid=27405 then data.donor_details_2
  end as Donor_Reference_1
case 
	when profileid=27395 then data.amount_donated
  end as Please_enter_the_amount_donated
case 
	when profileid=27395 then data.funding_sources
	when profileid=27405 then data.other_funding_2
    when profileid=80183 then data.funding_other_sources
    when profileid=80188 then data.funding_sources
  end as Are_there_any_other_sources_of_funding
case 
	when profileid=27395 then data.other_funding
	when profileid=27405 then data.other_funding
    when profileid=80183 then data.percentage_agencies
  end as Please_give_the_Percentage_of_funding_received_from_Other_Agencies
case 
	when profileid=27395 then data.other_funding_2
    when profileid=80183 then data.fund_agencies
    when profileid=80188 then data.fund_agencies
  end as Did_the_organization_receive_fund_from_other_agencies
case 
	when profileid=27395 then data.government_funding
	when profileid=27405 then data.government_funding
    when profileid=80183 then data.percentage_funding
  end as Percentage_of_funding_received_from_Government
case 
	when profileid=27395 then data.government_fund
	when profileid=27405 then data.government_fund
    when profileid=80183 then data.government_funding
    when profileid=80188 then data.government_funding
  end as Does_the_organization_have_Government_funding
case 
	when profileid=27395 then data.corporate_funders
	when profileid=27405 then data.corporate_funders
    when profileid=80183 then data.total_donations
  end as Percentage_of_funding_received_from_Corporate_Funders
case 
	when profileid=27395 then data.corporate_funders_2
	when profileid=27405 then data.corporate_funders_2
    when profileid=80183 then data.corporate_funders
    when profileid=80188 then data.corporate_funders
  end as Does_the_organization_have_Corporate_funders
case 
	when profileid=27395 then data.individual_donors
	when profileid=27405 then data.individual_donors
    when profileid=80183 then data.percentage_donors
  end as Percentage_of_donations_received_from_Individual_Donors
case 
	when profileid=27395 then data.individual_donors_2
	when profileid=27405 then data.individual_donors_2
    when profileid=80183 then data.individual_donors
    when profileid=80188 then data.individual_donors
  end as Does_the_organization_have_Individual_donors
case 
	when profileid=27395 then data.major_funding
	when profileid=27405 then data.major_funding
    when profileid=80183 then data.funding_sources
    when profileid=80188 then data.funding_sources
  end as What_are_the_major_sources_of_funding
case 
	when profileid=27395 then data.fixed_asset
  end as Mention_the_type_of_fixed_assets-Land_Office_building_Training_Centre
case 
	when profileid=27395 then data.income_exp
  end as What_was_the_total_Income_vs_Expenditure_in_last_three_years
case 
	when profileid=27395 then data.income_exp_ratio
  end as What_was_the_Income_vs_Expenditure_ratio_in_the_last_three_years
case 
	when profileid=27395 then data.total_expenditure
	when profileid=27405 then data.total_expenditure
  end as Total_Expenditure_in_last_three_years
case 
	when profileid=27395 then data.direct_prog_cost
	when profileid=27405 then data.direct_prog_cost
  end as Total_spend_on_direct_programme_costs_in_the_last_FY
case
	when profileid=27395 then data.direct_prog_cost_2
	when profileid=27405 then data.direct_prog_cost_2
  end as What_was_the_total_spend_on_direct_programme_costs_in_the_last_FY
case 
	when profileid=27395 then data.total_expenses
	when profileid=27405 then data.total_expenses
  end as Total_expenses_in_the_last_FY*/

/*With temp1 as (
 Select 'fy_00_timerange' as col
  union all
 Select 'fy_07_timerange' as col
  union all
 Select 'fy_11_timerange' as col
  union all
 Select 'fy_01_timerange' as col
  union all
 Select 'fy_05_timerange' as col
  union all
  Select 'fy_13_timerange' as col
  union all
  Select 'fy_06_timerange' as col
  union all
  Select 'fy_10_timerange' as col
  union all
  Select 'fy_19_timerange' as col
  union all
  Select 'fy_04_timerange' as col
  union all
  Select 'fy_18_timerange' as col
  union all
  Select 'fy_09_timerange' as col
  union all
  Select 'fy_24_timerange' as col 
  union all
  Select 'fy_14_timerange' as col 
  union all
  Select 'fy_16_timerange' as col
  union all
  Select 'fy_31_timerange' as col 
  union all
  Select 'fy_28_timerange' as col 
  union all
  Select 'fy_03_timerange' as col 
  union all
  Select 'fy_21_timerange' as col 
  union all
  Select 'fy_30_timerange' as col
  union all
  Select 'fy_25_timerange' as col
  union all
  Select 'fy_02_timerange' as col
  union all
  Select 'fy_08_timerange' as col
  union all
  Select 'fy_12_timerange' as col
  union all
  Select 'fy_35_timerange' as col
  union all
  Select 'fy_17_timerange' as col 
  union all
  Select 'fy_20_timerange' as col
  union all
  Select 'fy_26_timerange' as col
  union all
  Select 'fy_23_timerange' as col 
  union all
  Select 'fy_33_timerange' as col 
  union all
  Select 'fy_27_timerange' as col 
  union all
  Select 'fy_32_timerange' as col 
  union all
  Select 'fy_22_timerange' as col 
  union all
  Select 'fy_15_timerange' as col
  union all
  Select 'fy_29_timerange' as col 
  union all
  Select 'fy_34_timerange' as col
  ),
  
 temp2 as (
	Select 'd0_00' as col
	Select 'c0_00' as col
	Select 'b0_00' as col
	Select 'a0_00' as col
	Select 'd0_07' as col
	Select 'j0_07' as co
	Select 'i0_07' as col
	Select 'g0_07' as col
	Select 'b0_07' as col
	Select 'h0_07' as col
	Select 'f0_07' as col
	Select 'a0_07' as col 
	Select 'c0_07' as col
	Select 'e0_07' as col
	Select 'a0_11' as col
	Select 'b0_11' as col
	Select 'c0_01' as col
	Select 'e0_01' as col
	Select 'g0_01' as col
	Select 'f0_01' as col
	Select 'a0_01' as col
	Select 'h0_01' as col
	Select 'd0_01' as col
	Select 'b0_01' as col
	Select 'c0_05' as col
	Select 'b0_05' as col
	Select 'a0_05' as col
	Select 'd0_13' as col
	Select 'h0_13' as col
	Select 'c0_13' as col
	Select 'e0_13' as col
	Select 'b0_13' as col
	Select 'a0_13' as col
	Select 'f0_13' as col
	Select 'g0_13' as col
	Select 'e0_06' as col
	Select 'd0_06' as col
	Select 'c0_06' as col
	Select 'i0_06' as col
	Select 'f0_06' as col
	Select 'b0_06' as col
	Select 'g0_06' as col
	Select 'a0_06' as col
	Select 'h0_06' as col
	Select 'c0_10' as col
	Select 'b0_10' as col
	Select 'a0_10' as col
	Select 'c0_19' as col
	Select 'b0_19' as col
	Select 'a0_19' as col
	Select 'e0_19' as col
	Select 'd0_19' as col
	Select 'h0_04' as col
	Select 'a0_04' as col
	Select 'j0_04' as col
	Select 'b0_04' as col
	Select 'i0_04' as col
	Select 'c0_04' as col
	Select 'f0_04' as col
	Select 'e0_04' as col
	Select 'd0_04' as col
	Select 'g0_04' as col
	Select 'f0_18' as col
	Select 'a0_18' as col
	Select 'j0_18' as col
	Select 'g0_18' as col
	Select 'c0_18' as col
	Select 'k0_18' as col
	Select 'd0_18' as col
	Select 'i0_18' as col
	Select 'h0_18' as col
	Select 'e0_18' as col
	Select 'b0_18' as col
	Select 'c0_09' as col
	Select 'b0_09' as col
	Select 'd0_09' as col
	Select 'h0_09' as col
	Select 'i0_09' as col
	Select 'e0_09' as col
	Select 'f0_09' as col
	Select 'a0_09' as col
	Select 'g0_09' as col
	Select 'c0_24' as col
	Select 'b0_24' as col
	Select 'e0_24' as col
	Select 'h0_24' as col
	Select 'd0_24' as col
	Select 'g0_24' as col
	Select 'f0_24' as col
	Select 'a0_24' as col
	Select 'f0_14' as col
	Select 'c0_14' as col
	Select 'b0_14' as col
	Select 'a0_14' as col
	Select 'd0_14' as col
	Select 'e0_14' as col
	Select 'h0_14' as col
	Select 'i0_14' as col
	Select 'g0_14' as col
	Select 'j0_14' as col
	Select 'd0_16' as col
	Select 'a0_16' as col
	Select 'c0_16' as col
	Select 'f0_16' as col
	Select 'b0_16' as col
	Select 'e0_16' as col
	Select 'c0_31' as col
	Select 'b0_31' as col
	Select 'a0_31' as col
	Select 'e0_31' as col
	Select 'd0_31' as col
	Select 'd0_28' as col
	Select 'a0_28' as col
	Select 'h0_28' as col
	Select 'c0_28' as col
	Select 'g0_28' as col
	Select 'f0_28' as col
	Select 'e0_28' as col
	Select 'c0_03' as col
	Select 'a0_03' as col
	Select 'b0_03' as col
	Select 'a0_21' as col
	Select 'e0_21' as col
	Select 'd0_21' as col
	Select 'b0_21' as col
	Select 'f0_21' as col
	Select 'c0_21' as col
	Select 'e0_30' as col
	Select 'f0_30' as col
	Select 'c0_30' as col
	Select 'a0_30' as col
	Select 'd0_30' as col
	Select 'b0_30' as col
	Select 'f0_25' as col
	Select 'b0_25' as col
	Select 'e0_25' as col
	Select 'c0_25' as col
	Select 'd0_25' as col
	Select 'a0_25' as col
	Select 'g0_25' as col
	Select 'i0_02' as col
	Select 'k0_02' as col
	Select 'e0_02' as col
	Select 'b0_02' as col
	Select 'f0_02' as col
	Select 'a0_02' as col
	Select 'c0_02' as col
	Select 'g0_02' as col
	Select 'h0_02' as col
	Select 'j0_02' as col
	Select 'd0_02' as col
	Select 'd0_08' as col
	Select 'n0_08' as col
	Select 'j0_08' as col
	Select 'a0_08' as col
	Select 'k0_08' as col
	Select 'c0_08' as col
	Select 'e0_08' as col
	Select 'g0_08' as col
	Select 'h0_08' as col
	Select 'i0_08' as col
	Select 'm0_08' as col
	Select 'f0_08' as col
	Select 'l0_08' as col
	Select 'b0_08' as col
	Select 'b0_12' as col
	Select 'f0_12' as col
	Select 'g0_12' as col
	Select 'e0_12' as col
	Select 'c0_12' as col
	Select 'a0_12' as col
	Select 'd0_12' as col
	Select 'b0_35' as col
	Select 'd0_35' as col
	Select 'c0_35' as col
	Select 'e0_35' as col
	Select 'f0_35' as col
	Select 'a0_35' as col
	Select 'a0_17' as col
	Select 'c0_17' as col
	Select 'i0_17' as col
	Select 'h0_17' as col
	Select 'f0_17' as col
	Select 'd0_17' as col
	Select 'b0_17' as col
	Select 'e0_17' as col
	Select 'g0_17' as col
	Select 'd0_20' as col
	Select 'a0_20' as col
	Select 'c0_20' as col
	Select 'e0_20' as col
	Select 'b0_20' as col
	Select 'h0_26' as col
	Select 'e0_26' as col
	Select 'g0_26' as col
	Select 'i0_26' as col
	Select 'c0_26' as col
    Select 'd0_26' as col
    Select 'f0_26' as col
    Select 'b0_26' as col
    Select 'b0_23' as col
    Select 'a0_23' as col
    Select 'e0_23' as col
    Select 'd0_23' as col
    Select 'f0_23' as col
    Select 'c0_23' as col
    Select 'b0_33' as col
    Select 'k0_33' as col
    Select 'h0_33' as col
    Select 'e0_33' as col
    Select 'c0_33' as col
    Select 'g0_33' as col
    Select 'i0_33' as col
    Select 'd0_33' as col
    Select 'j0_33' as col
    Select 'f0_33' as col
    Select 'a0_33' as col
    Select 'a0_27' as col
    Select 'c0_27' as col
    Select 'f0_27' as col
    Select 'e0_27' as col
    Select 'b0_27' as col
    Select 'd0_27' as col
    Select 'g0_27' as col
    Select 'e0_32' as col
    Select 'a0_32' as col
    Select 'i0_32' as col
    Select 'd0_32' as col
    Select 'f0_32' as col
    Select 'c0_32' as col
    Select 'b0_32' as col
    Select 'g0_32' as col
    Select 'h0_32' as col
    Select 'a0_22' as col
    Select 'o0_22' as col
    Select 'l0_22' as col
    Select 'c0_22' as col
    Select 'i0_22' as col
    Select 'f0_22' as col
    Select 'b0_22' as col
    Select 'g0_22' as col
    Select 'm0_22' as col
    Select 'e0_22' as col
    Select 'k0_22' as col /*d0_22, j0_22, n0_22, h0_22, b0_15, d0_15, g0_15, c0_15, e0_15, a0_15, f0_15, i0_15, h0_15, a0_29, e0_29, f0_29, b0_29, d0_29, c0_29, f0_34, e0_34, c0_34, d0_34, b0_34, a0_34*/
	),
	
s as ( Select p.fy_00_timerange,p.fy_07_timerange,p.fy_11_timerange, p.fy_01_timerange, p.fy_05_timerange, p.fy_13_timerange, p.fy_06_timerange, p.fy_10_timerange, p.fy_19_timerange, p.fy_04_timerange, p.fy_18_timerange, p.fy_09_timerange, p.fy_24_timerange, p.fy_14_timerange, p.fy_16_timerange, p.fy_31_timerange, p.fy_28_timerange, p.fy_03_timerange, p.fy_21_timerange, p.fy_30_timerange, p.fy_25_timerange, p.fy_02_timerange, p.fy_08_timerange, p.fy_12_timerange, p.fy_35_timerange, p.fy_17_timerange, p.fy_20_timerange, p.fy_26_timerange, p.fy_23_timerange, p.fy_33_timerange, p.fy_27_timerange, p.fy_32_timerange, p.fy_22_timerange, p.fy_15_timerange, p.fy_29_timerange, p.fy_34_timerange
	  from profile_74275 p)	  
Select
case col
 when 'fy_00_timerange' then s.fy_00_timerange
 when 'fy_07_timerange' then s.fy_07_timerange
 when 'fy_11_timerange' then s.fy_11_timerange
 when 'fy_01_timerange' then s.fy_01_timerange
 when 'fy_05_timerange' then s.fy_05_timerange  
 when 'fy_13_timerange' then s.fy_13_timerange
 when 'fy_06_timerange' then s.fy_06_timerange
 when 'fy_10_timerange' then s.fy_10_timerange
 when 'fy_19_timerange' then s.fy_19_timerange
 when 'fy_04_timerange' then s.fy_04_timerange
 when 'fy_18_timerange' then s.fy_18_timerange
 when 'fy_09_timerange' then s.fy_09_timerange
 when 'fy_24_timerange' then s.fy_24_timerange
 when 'fy_14_timerange' then s.fy_14_timerange
 when 'fy_16_timerange' then s.fy_16_timerange
 when 'fy_31_timerange' then s.fy_31_timerange
 when 'fy_28_timerange' then s.fy_28_timerange
 when 'fy_03_timerange' then s.fy_03_timerange
 when 'fy_21_timerange' then s.fy_21_timerange
 when 'fy_30_timerange' then s.fy_30_timerange
 when 'fy_25_timerange' then s.fy_25_timerange
 when 'fy_02_timerange' then s.fy_02_timerange
 when 'fy_08_timerange' then s.fy_08_timerange
 when 'fy_12_timerange' then s.fy_12_timerange
 when 'fy_35_timerange' then s.fy_35_timerange
 when 'fy_17_timerange' then s.fy_17_timerange
 when 'fy_20_timerange' then s.fy_20_timerange
 when 'fy_26_timerange' then s.fy_26_timerange
 when 'fy_23_timerange' then s.fy_23_timerange
 when 'fy_33_timerange' then s.fy_33_timerange 
 when 'fy_27_timerange' then s.fy_27_timerange
 when 'fy_32_timerange' then s.fy_32_timerange
 when 'fy_22_timerange' then s.fy_22_timerange
 when 'fy_15_timerange' then s.fy_15_timerange
 when 'fy_29_timerange' then s.fy_29_timerange
 when 'fy_34_timerange' then s.fy_34_timerange
 else null
 end as timeperiods, temp1.col as "time_data"
 from s
 cross join temp1*/


