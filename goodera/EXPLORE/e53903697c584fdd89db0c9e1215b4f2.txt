with tab1 as(select split_part(split_part(prod.name,'|',1),'.',1) as projectcode,f.name as fy_timerange,concat(projectcode,fy_timerange) as CODE,split_part(prod.name,'|',3) as census, sum(hdfc_cost_yearly) hdfc_cost_yearly,sum(gov_cost_yearly) as gov_cost_yearly,sum(comm_cost_yearly) comm_cost_yearly
from profile_29973 p
left join ds_mysql_prod_project prod on
prod.id=p.projectid
left join ds_mysql_prod_tagelement f on
p.fy=f.id
group by  split_part(split_part(prod.name,'|',1),'.',1),f.name,split_part(prod.name,'|',3)),

Base1 as
(select p.name as projectcode,f.name as fy_timerange,concat(projectcode,fy_timerange) as CODE,m.name  as project_manager from profile_27396 p
left join ds_mysql_prod_tagelement m on
p.project_manager=m.id
left join ds_mysql_prod_tagelement f on
p.fy=f.id
union
select split_part(l.name,'[',1) as projectcode,f.name as fy_timerange,concat(projectcode,fy_timerange) as CODE,m.name as project_manager
from profile_27420 p
left join profile_27396 l on
p.project_code=l._id
left join ds_mysql_prod_tagelement m on
p.project_manager=m.id
left join ds_mysql_prod_tagelement f on
p.fy=f.id
),
Base2 as(select p.projectcode,p.fy_timerange,p.CODE,l.village as village,p.hdfc_cost_yearly,p.gov_cost_yearly,p.comm_cost_yearly from tab1 p left join profile_27489 l on p.census=l.name),

Base3 as(select distinct(p.village) as village,p.projectcode,p.fy_timerange,l.project_manager
from Base2 p left join Base1 l on p.CODE=l.CODE)
select * from Base3

order by fy_timerange,projectcode


/*Select t1.name as FY, p2.name as ProjectCode, p1.village_name as Village,t2.name as Output_Statement, t3.name Output_Indicator, p1.planned_q1, p1.planned_q2, p1.planned_q3, p1.planned_q4, p1.progress_q2, p1.progress_q4, p1.baseline,p1.progress_q3
from profile_27417 p1
left join profile_27396 p2
on p1.prj_code=p2._id
left join ds_mysql_prod_tagelement t1
on p1.fy=t1.id
left join ds_mysql_prod_tagelement t2
on p1.op_statement_new=t2.id
left join ds_mysql_prod_tagelement t3
on p1.op_indic_new=t3.id
group  by t2.name,t1.name,p2.name, p1.village_name, t3.name, p1.planned_q1, p1.planned_q2, p1.planned_q3, p1.planned_q4, p1.progress_q2, p1.progress_q4, p1.baseline,p1.progress_q3*/