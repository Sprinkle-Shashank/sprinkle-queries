with table1 as (Select p.subcat_output, p._id, p.focus_area, p.fy, p.projectId, p.flag_deviation_delay,
				reverse(reverse(SPLIT_PART((data.name), '|',3))) as censusCode1,
				case when data.parent = 18943 then data.id else data.parent end as parent,
				case when data.parent = 18943 then 'Cluster' else censusCode1 end as censusCode


		from profile_54963 p
left join ds_mysql_prod_project data on
data.id = p.projectId
			
),


table2 as (select p.parent as parent,
		   p.censusCode as censusCode,
		   p.subcat_output as subcat_output,
		   p.focus_area as focus_area1,
		   p.projectId as projectId1 ,
		   p.flag_deviation_delay as flag_deviation_delay,
		   p._id as _id1,
		   reverse(reverse(SPLIT_PART((data1.name), '|',1))) as projectCode,
		   case when responseData.status like 'PENDING_APPROVAL' or (responseData.status like 'SUBMITTED' AND responseData.approvalLog IS NULL) THEN 0 ELSE 1 END AS  dataCheck,
		   data27489.village as villageName
		   
		   from table1 p

left join ds_mysql_prod_project data1 on
data1.id = p.parent
		   
left join ds_mongo_taskresponse responseData on
responseData.profileinstanceid = p._id

left join profile_27489 data27489 on 
data27489.name = p.censusCode
	
order by dataCheck desc
),

table3 as ( select parent, censusCode, subcat_output,focus_area1, projectId1, flag_deviation_delay, _id1, projectCode,dataCheck,villageName,
		   data27396.project_manager as project_manager27396,
		   data27396._id as recordId,
		   data27396.fy as fy27396
		   
		   from table2 p

left join profile_27396 data27396 on
data27396.name = projectCode
		   
left join profile_27420 data27420 on
data27420.project_code = data27396._id

)





Select * from table3 p