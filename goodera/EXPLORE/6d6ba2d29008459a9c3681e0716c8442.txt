with s as 
(Select name as site,('FY'||substring(EXTRACT(YEAR FROM(CAST(startdate AS datetime))),3,2)||'-'||substring(EXTRACT(YEAR FROM(CAST(startdate AS datetime)))+1,3,2) )as year,fy_timerange,datatablebase,tablesettings,questiontext
from sus_64073
where keyword='gen_rensources_consumedbyorg'
)
,
s2 as(
Select site,year,fy_timerange,questiontext,tablesettings."0"."elec_ren_org"."measureUnitBase" as Elec_ren_unit,tablesettings."0"."heat_ren_org"."measureUnitBase" as Heat_ren_unit,tablesettings."0"."steam_ren_org"."measureUnitBase" as steam_ren_unit,tablesettings."0"."cool_ren_org"."measureUnitBase" as Cool_ren_unit,coun.elec_ren_org,coun.heat_ren_org,coun.cool_ren_org,coun.steam_ren_org from s as p, unpivot p.datatablebase as coun at xyz
),
s3 as (
Select 'Electricity' as col
 union all
Select 'Heat' as col
  union all
Select 'Steam' as col
  union all
Select 'Cool' as col
  
)

Select site,year,fy_timerange,questiontext,s3.col as source,
sum(case col
		when 'Electricity' then s2.elec_ren_org
	    when 'Heat' then s2.heat_ren_org
	    when 'Steam' then s2.steam_ren_org
	   when 'Cool' then s2.cool_ren_org
	else null
	end) as Values,
	case col
	  when 'Electricity' then s2.Elec_ren_unit
	    when 'Heat' then s2.Heat_ren_unit
	    when 'Steam' then s2.steam_ren_unit
	   when 'Cool' then s2.Cool_ren_unit
	   else null
	   end as Unit

	from s2
	cross join s3
