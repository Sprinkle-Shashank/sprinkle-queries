SELECT
I.name AS institutions, 
COUNT (B.name),
CONCAT(CONCAT(CONCAT(SPLIT_PART(B.start_date, ' ', 1),'T'),SPLIT_PART(B.start_date, ' ', 2)),'.000Z') AS fy_timerange,

CASE
	WHEN B.projectId IS NOT NULL
	THEN 100
	
	ELSE NULL
END AS targets,

CASE 
	WHEN t4.name IS NOT NULL
	THEN t3.name
	
	WHEN t4.name IS NULL AND t3.name IS NOT NULL
	THEN t2.name
	
	WHEN t3.name IS NULL AND t2.name IS NOT NULL
	THEN t1.name
	
	ELSE NULL
END AS state,

CASE 
	WHEN t4.name IS NOT NULL
	THEN t2.name
	
	WHEN t4.name IS NULL AND t3.name IS NOT NULL
	THEN t1.name 
	
	ELSE NULL
END AS district

FROM profile_77914 AS B

LEFT JOIN profile_77911 AS I
ON B.institution = I._id

GROUP BY institutions, B.name, start_date, targets, state, district