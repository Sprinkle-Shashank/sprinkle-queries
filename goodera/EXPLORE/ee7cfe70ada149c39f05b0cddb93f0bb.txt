with table1 as (
select ta.name, reftag.code from ds_mysql_prod_tagelement ta
left join ds_mongo_reftagelementmetadata reftag
on ta.reftagelementmetadataid = reftag._id
where ta.tagid = 4738)


SELECT distinct profile_54646.name_vendor, profile_54646.name_vendor_filter as VENDOR, vpid_1 as VPID, LISTAGG(DISTINCT cou.name, ',') 
within group (order by profile_54646.name_vendor_filter) as COUNTRY , profile_54646.name_country, profile_54646.name_vendor_filter,table1.code
FROM profile_52162

LEFT JOIN profile_54646 ON
profile_52162.projectId = profile_54646.projid_vendor

LEFT JOIN table1 ON 
profile_54646.name_country = table1.name

left join ds_mysql_prod_tagelement cou on country_2 = cou.id

WHERE pace_status = 845114 and name_vendor_fil is not null

group by profile_54646.name_vendor_filter, vpid_1, start_quarter,profile_54646.name_vendor,profile_54646.name_country , start_year,table1.code




/*

SELECT COUNT(UNIQUE(54646.name_vendor_filter)) 
FROM
(SELECT * FROM 52162
WHERE pace_status(1st level) == 845114 
LEFT JOIN 54646 ON 52162.$projectId = 54646.$projid_vendor)

*/