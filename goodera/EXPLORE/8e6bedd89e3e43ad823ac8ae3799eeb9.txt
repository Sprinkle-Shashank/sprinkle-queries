With tab1 as(Select split_part(split_part(prod.name,'|',1),'.',1) as projectcode,
t.name as fy_timerange,
concat(projectcode,fy_timerange) as CODE,sum(p.hdfc_cost_monthly) as hdfc_cost,t2.name as Quarter,p1.village,p1.state
from profile_29974 p
left join ds_mysql_prod_project prod on
prod.id=p.projectid
left join ds_mysql_prod_tagelement t
on p.fy=t.id
left join ds_mysql_prod_tagelement t1
on p.month_number=t1.id
left join ds_mysql_prod_tagelement t2
on t1.parent=t2.id
left join profile_27489 p1 on
split_part(prod.name,'|',3)=p1.name
group by 1,2,3,5,6,7),

tab2 as (Select split_part(split_part(prod.name,'|',1),'.',1) as projectcode,
t.name as fy_timerange,
concat(projectcode,fy_timerange) as CODE,sum(p.monthly_cost) as monthlycost ,t2.name as Quarter
from profile_30171 p
left join ds_mysql_prod_project prod on
prod.id=p.projectid
left join ds_mysql_prod_tagelement t
on p.fy=t.id
left join ds_mysql_prod_tagelement t1
on p.month_number=t1.id
left join ds_mysql_prod_tagelement t2
on t1.parent=t2.id
group by 1,2,3,5)

Select t.projectcode as projectcode,t.fy_timerange fy,t.quarter Quarter,t.code as Code,(t.hdfc_cost+t1.monthlycost) as Allocated,t.village,t.state
from tab1 t
left join tab2 t1 on
t.CODE=t1.CODE and t.Quarter=t1.Quarter
