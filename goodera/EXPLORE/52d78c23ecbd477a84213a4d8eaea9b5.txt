SELECT sq.metric, sq.region, sq.tier, sq.source_div, sq.energy_type, p.name as type, SUM(attainment) as attainment, case when sq.flag=1 then mr.year_num+1 else mr.year_num end as fy
FROM profile_62632 sq
left join ds_mysql_prod_tagelement t
on sq.fy = t.id
left join ds_mysql_prod_tagelement p
on sq.type = p.id
left join profile_64189 mr
ON t.name=mr.year_text
GROUP BY sq.metric, sq.fy, sq.region, sq.tier, sq.source_div, sq.energy_type, sq.type, sq.flag, mr.year_num