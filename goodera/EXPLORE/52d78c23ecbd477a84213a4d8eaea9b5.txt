SELECT sq.metric, m.name as region, p.name as tier, o.name as source_div, sq.energy_type, sq.type, SUM(attainment) as attainment, case when sq.flag=1 then mr.year_num+1 else mr.year_num end as fy
FROM profile_62632 sq
left join ds_mysql_prod_tagelement t
on sq.fy = t.id
left join ds_mysql_prod_tagelement p
on sq.tier = p.id
left join ds_mysql_prod_tagelement m
on sq.region = m.id
left join ds_mysql_prod_tagelement o
on sq.source_div = o.id
left join profile_64189 mr
ON t.name=mr.year_text
GROUP BY sq.metric, sq.fy, m.name, p.name, o.name, sq.energy_type, sq.type, sq.flag, mr.year_num