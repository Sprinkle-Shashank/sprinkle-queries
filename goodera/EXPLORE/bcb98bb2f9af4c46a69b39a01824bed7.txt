with --main as (select completedon,grantflowtaskid,grantproposalid,action from gfgpr_499),
base1 as(
select gpr.completedon as fy,g1.code,p1.name as project_name,p2.name as ngo_name
from gfgpr_499 gpr
left join ds_mysql_prod_grantproposal g1
on g1.id = gpr.grantproposalid
left join profile_12743 p1
on p1.grantproposalid = gpr.grantproposalid
left join profile_12117 p2
on p2.grantproposalid = gpr.grantproposalid
where gpr.action != 'PENDING'
group by 1,2,3,4)

select * from base1