with sub1 as (
Select x1._id as id, x1.profileinstanceid, x1.status, x1.active, x1.data, x1.taskuserid, x2.taskid, x5.projectid, x6.profileid, x4.sectionid, x6.name as section, x7.name as profile, x8.name as project, x1.created, x1.modified,
  
case
  when is_array(x1.submissionlog) = false or get_array_length(x1.submissionlog) = 0 then 
  	   array(x1.submissionlog)
  else x1.submissionlog
end as submissionlog_new,
case
  when is_array(x1.approvallog) = false or get_array_length(x1.approvallog) = 0 then 
  	   array(x1.approvallog)
  else x1.approvallog
end as approvallog_new,x9.questiontext
  
from ds_mongo_taskresponse x1 

left join ds_mysql_prod_taskuser x2 on x2.id = x1.taskuserid
left join ds_mysql_prod_task x3 on x3.id = x2.taskid
left join ds_mysql_prod_flowtask x4 on x4.id = x3.flowtaskid
left join ds_mysql_prod_projectflow x5 on x5.id = x3.projectflowid
left join ds_mysql_prod_section x6 on x6.id = x4.sectionid
left join ds_mysql_prod_profile x7 on x7.id = x6.profileid
left join ds_mysql_prod_project x8 on x8.id = x5.projectid
left join ds_mysql_prod_question x9 on x9.id=x4.sectionid

where x6.profileid in (27395,27405,80183,80188) and x1.active = 't'
and x1.status in ('APPROVED', 'PENDING_APPROVAL', 'SUBMITTED')

group by x1._id, x1.profileinstanceid, x1.status, x1.active, x1.data, x1.taskuserid, x2.taskid, x5.projectid, x6.profileid, x4.sectionid, x6.name, x7.name, x8.name, x1.submissionlog, x1.approvallog, x1.created, x1.modified,x9.questiontext
),
sub2 as (
Select 
case 
	when profileid=27395 then data.name
	when profileid=27405 then data.name
    when profileid=80183 then data.name
    when profileid=80188 then data.name
  end as Name_of_the_Implementation_Agency,
case 
	when profileid=27395 then data.fy
	when profileid=27405 then data.fy
    when profileid=80183 then data.fy
    when profileid=80188 then data.fy
  end as Select_the_financial_year_when_this_data_is_being_entered,
case 
	when profileid=27395 then data.office_address
    when profileid=80183 then data.address_office
    when profileid=80188 then data.address_office
  end as Registered_Office_Address,
case 
	when profileid=27395 then data.founder_name
    when profileid=80183 then data.founder_name
    when profileid=80188 then data.founder_name
  end as Name_of_the_founder,
case 
	when profileid=27395 then data.contact_person
	when profileid=27405 then data.contact_person
    when profileid=80183 then data.contact_org
    when profileid=80188 then data.contact_org
  end as Name_of_the_contact_person,
case 
	when profileid=27395 then data.email
	when profileid=27405 then data.email
    when profileid=80183 then data.email_org
    when profileid=80188 then data.email_org
  end as Email_ID_of_contact_person,
case 
	when profileid=27395 then data.mobile_number
	when profileid=27405 then data.mobile_number
  end as Mobile_number_of_contact_person,
case 
	when profileid=27395 then data.brief
    when profileid=80183 then data.description
    when profileid=80188 then data.description
  end as Brief_description_of_the_Programs_of_the_Organisation,
case 
	when profileid=27395 then data.vision_and_mission
    when profileid=80183 then data.mission
    when profileid=80188 then data.mission
  end as Vision_and_Mission_of_the_Organisation,
case 
	when profileid=27395 then data.core_area
    when profileid=80183 then data.area_intervention
    when profileid=80188 then data.area_intervention
  end as Please_select_the_Area_of_Intervention_in_which_your_Organisation_works,
case 
	when profileid=27395 then data.org_type
    when profileid=80183 then data.org_type
    when profileid=80188 then data.org_type
  end as Please_select_the_Organization_Type,
case 
	when profileid=27395 then data.schedule7
    when profileid=80183 then data.activities_schedule
    when profileid=80188 then data.activities_schedule
  end as schedule7,
case 
	when profileid=27395 then data.reg_number
	when profileid=27405 then data.reg_number
    when profileid=80183 then data.registration_number
    when profileid=80188 then data.registration_number
  end as Organisation_Registration_Number,
case 
	when profileid=27395 then data.registration_date
	when profileid=27405 then data.email
    when profileid=80183 then data.registration_date
    when profileid=80188 then data.registration_date
  end as Organization_registration_date,
case 
	when profileid=27395 then data.fcra
	when profileid=27405 then data.fcra
  end as fcra,
case 
	when profileid=27395 then data.fcra_validity
	when profileid=27405 then data.fcra_validity
  end as What_is_the_validity_of_the_FCRA,
case 
	when profileid=27395 then data.pan
	when profileid=27405 then data.pan
    when profileid=80183 then data.pan_card
    when profileid=80188 then data.pan_card
  end as pan,
case 
	when profileid=27395 then data.tax_exemption_2
	when profileid=27405 then data.tax_exemption_2
  end as Does_your_organisation_have_tax_exemption,
case 
	when profileid=27395 then data.validity_exemption
  end as What_is_the_validity_of_the_certificate_of_exemption?,
case 
	when profileid=27395 then data.validity_exemption_2
  end as Is_there_lifetime_validity_on_certificate_of_exemption?,
case 
	when profileid=27395 then data.exemption_details
  end as Please_mention_details_of_the_exemption_certificate,
case 
	when profileid=27395 then data.exemption_details_2
  end as Please_select_the_type_of_exemption_granted,
case 
	when profileid=27395 then data.mou_available
  end as Do_you_have_MOATrust_Deed,
case 
	when profileid=27395 then data.audit_statment
  end as Do_you_have_previous_3_years_audited_statements,
case 
	when profileid=27395 then data.social_advocacy_2
    when profileid=80183 then data.social_activities
    when profileid=80188 then data.social_activities
  end as Does_the_organisation_address_issues_of_social_advocacy,
 case 
	when profileid=27395 then data.email
	when profileid=27405 then data.email
    when profileid=80183 then data.email_org
    when profileid=80188 then data.email_org
  end as Email_ID_of_contact_person,

 case 
	when profileid=27395 then data.email
	when profileid=27405 then data.email
    when profileid=80183 then data.email_org
    when profileid=80188 then data.email_org
  end as Email_ID_of_contact_person,
 case 
	when profileid=27395 then data.email
	when profileid=27405 then data.email
    when profileid=80183 then data.email_org
    when profileid=80188 then data.email_org
  end as Email_ID_of_contact_person, 
  case 
	when profileid=27395 then data.email
	when profileid=27405 then data.email
    when profileid=80183 then data.email_org
    when profileid=80188 then data.email_org
  end as Email_ID_of_contact_person, 
  case 
	when profileid=27395 then data.email
	when profileid=27405 then data.email
    when profileid=80183 then data.email_org
    when profileid=80188 then data.email_org
  end as Email_ID_of_contact_person,

  


















)