with t1 as
(select * from
  (select projectid, fy_timerange, bd_1, bd_2, bd_3, bd_4,
  
  case when allocated=bd_1 then "Tool Development and Completion"
  when allocated=bd_2 then "Sign-Off"
  when allocated=bd_3 then "Live"
  when allocated=bd_4 then "AMC"
  else '-'
  end as status
  
  from profile_55424 as p
  )
  UNPIVOT (
  disbursed_amount for allocated IN (bd_1, bd_2, bd_3, bd_4))),
  t2 as
  (
	select projectid, fy_timerange, status, sum(disbursed_amount) as disbursed_amount_sum from t1,
	
  case when status='Tool Development and Completion' then 1
  when status='Sign-Off' then 2
  when status='Live' then 3
  when status='AMC' then 4
  else '-'
  end as sort_up
	
	group by projectId, fy_timerange, status
	order by sort_up ASC
	)
	select * from t2
   
 

/*with t1 as
(
  select projectId, fy_timerange, bd_1, bd_2, bd_3, bd_4,
  
  case when allocated=bd_1 then "Tool Development and Completion"
  when allocated=bd_2 then "Sign-Off"
  when allocated=bd_3 then "Live"
  when allocated=bd_4 then "AMC"
  else '-'
  end as status,
  
  case when status='Tool Development and Completion' then 1
  when status='Sign-Off' then 2
  when status='Live' then 3
  when status='AMC' then 4
  else '-'
  end as sort_up
  
  from profile_55424 as p
  ),
  
  t2 as
  (
	select projectId, fy_timerange, status, sum(disbursed_amount) as disbursed_amount_sum, sort_up
	from t1
	
	group by projectId, fy_timerange, status, sort_up
	)
	
	select * from t2*/