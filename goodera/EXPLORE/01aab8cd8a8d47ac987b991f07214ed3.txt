with table1 as
( select batch, avg_working_days, daily_wage, p.state , p1.fy as name_update , sta.name as state_update, (daily_wage*avg_working_days*12) as salary , 'Endline' as assessment, 'Average Annual Income' as indicator from profile_30527 as p
 
 left join profile_30532 p1 on
 p.batch = p1._id
 
 left join ds_mysql_prod_tagelement sta 
 on p.state = sta.id 
 ),
 
 table2 as
 (
    select state_update , name_update , assessment ,indicator , avg(salary) as income from table1 as p
   
    group by state_update , name_update , assessment ,indicator  
  )
 
 
 select * from table2
 
 
/*

with table1 as 
(
select P.batch, sta.name as state_update, profile_30532.fy as name, 
avg(P.ind_income_post_tr*12) as income,
'Endline' as assessment, 'Average Annual Income' as indicator

FROM Profile_30527 as P

LEFT JOIN profile_30532
ON P.batch = profile_30532._id

LEFT JOIN ds_mysql_prod_tagelement AS sta
ON P.state = sta.id

GROUP BY profile_30532.fy, assessment, indicator, sta.name, batch

ORDER BY profile_30532.fy ASC
)
select state_update, name, income, assessment, indicator
from table1


*/
