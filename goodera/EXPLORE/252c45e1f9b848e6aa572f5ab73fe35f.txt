with sub1 as(
  select p1._id as id, p.name as projectId, p2.vendor as vendor, t1.name as country, p2.cycle, t2.name as consultant, t3.name as select,
d1.name as overall_engagement, d2.name as overall_engagement_1, d3.name as overall_engagement_2, d4.name as working_conditions_1, d5.name as working_conditions_2, d6.name as working_conditions_3, d7.name as working_conditions_4, d8.name as working_conditions_5, d9.name as working_conditions_6, d10.name as working_conditions_7, d11.name as working_conditions_8, d12.name as relationship_1, d13.name as relationship_2, d14.name as relationship_3, d15.name as relationship_4, d16.name as relationship_5, d17.name as learning_1, d18.name as learning_2, d19.name as learning_3, d20.name as value

from profile_62700 p1

left join ds_mysql_prod_tagelement d1 on d1.id = p1.overall_engagement
left join ds_mysql_prod_tagelement d2 on d2.id = p1.overall_engagement_1
left join ds_mysql_prod_tagelement d3 on d3.id = p1.overall_engagement_2
left join ds_mysql_prod_tagelement d4 on d4.id = p1.working_conditions_1
left join ds_mysql_prod_tagelement d5 on d5.id = p1.working_conditions_2
left join ds_mysql_prod_tagelement d6 on d6.id = p1.working_conditions_3
left join ds_mysql_prod_tagelement d7 on d7.id = p1.working_conditions_4
left join ds_mysql_prod_tagelement d8 on d8.id = p1.working_conditions_5
left join ds_mysql_prod_tagelement d9 on d9.id = p1.working_conditions_6
left join ds_mysql_prod_tagelement d10 on d10.id = p1.working_conditions_7
left join ds_mysql_prod_tagelement d11 on d11.id = p1.working_conditions_8
left join ds_mysql_prod_tagelement d12 on d12.id = p1.relationship_1
left join ds_mysql_prod_tagelement d13 on d13.id = p1.relationship_2
left join ds_mysql_prod_tagelement d14 on d14.id = p1.relationship_3
left join ds_mysql_prod_tagelement d15 on d15.id = p1.relationship_4
left join ds_mysql_prod_tagelement d16 on d16.id = p1.relationship_5
left join ds_mysql_prod_tagelement d17 on d17.id = p1.learning_1
left join ds_mysql_prod_tagelement d18 on d18.id = p1.learning_2
left join ds_mysql_prod_tagelement d19 on d19.id = p1.learning_3
left join ds_mysql_prod_tagelement d20 on d20.id = p1.value
left join profile_64362 p2 on p2.factory_id = p1.fac_id
left join ds_mysql_prod_project p on p.id = p2.projectid
left join ds_mysql_prod_tagelement t1 on t1.id = p1.country
left join ds_mysql_prod_tagelement t2 on t2.id = p2.consultant_tag
left join ds_mysql_prod_tagelement t3 on t3.id = p1.select

where p.name is not null),

sub2 as(
  select s1.*, cycle_new from sub1 s1, s1.cycle cycle_new)
  
select  s2.id, s2.projectId, s2.vendor, s2.country, s2.consultant, t4.name as cycle,

sum(case
		when s2.select = 'Baseline' then s2.overall_engagement
		else 0 
	end) as baseline_overall_engagement,
sum(case
		when s2.select = 'Baseline' then s2.overall_engagement_1
		else 0 
	end) as baseline_overall_engagement_1,
sum(case
		when s2.select = 'Baseline' then s2.overall_engagement_2
		else 0 
	end) as baseline_overall_engagement_2,
sum(case
		when s2.select = 'Baseline' then s2.working_conditions_1
		else 0 
	end) as baseline_working_conditions_1,
sum(case
		when s2.select = 'Baseline' then s2.working_conditions_2
		else 0 
	end) as baseline_working_conditions_2,
sum(case
		when s2.select = 'Baseline' then s2.working_conditions_3
		else 0 
	end) as baseline_working_conditions_3,
sum(case
		when s2.select = 'Baseline' then s2.working_conditions_4
		else 0 
	end) as baseline_working_conditions_4,
sum(case
		when s2.select = 'Baseline' then s2.working_conditions_5
		else 0 
	end) as baseline_working_conditions_5,
sum(case
		when s2.select = 'Baseline' then s2.working_conditions_6
		else 0 
	end) as baseline_working_conditions_6,
sum(case
		when s2.select = 'Baseline' then s2.working_conditions_7
		else 0 
	end) as baseline_working_conditions_7,
sum(case
		when s2.select = 'Baseline' then s2.working_conditions_8
		else 0 
	end) as baseline_working_conditions_8,
sum(case
		when s2.select = 'Baseline' then s2.relationship_1
		else 0 
	end) as baseline_relationship_1,
sum(case
		when s2.select = 'Baseline' then s2.relationship_2
		else 0 
	end) as baseline_relationship_2,
sum(case
		when s2.select = 'Baseline' then s2.relationship_3
		else 0 
	end) as baseline_relationship_3,
sum(case
		when s2.select = 'Baseline' then s2.relationship_4
		else 0 
	end) as baseline_relationship_4,
sum(case
		when s2.select = 'Baseline' then s2.relationship_5
		else 0 
	end) as baseline_relationship_5,
sum(case
		when s2.select = 'Baseline' then s2.learning_1
		else 0 
	end) as baseline_learning_1,
sum(case
		when s2.select = 'Baseline' then s2.learning_2
		else 0 
	end) as baseline_learning_2,
sum(case
		when s2.select = 'Baseline' then s2.learning_3
		else 0 
	end) as baseline_learning_3,
sum(case
		when s2.select = 'Baseline' then s2.value
		else 0 
	end) as baseline_value,

sum(case
		when s2.select = 'Endline' then s2.overall_engagement
		else 0 
	end) as Endline_overall_engagement,
sum(case
		when s2.select = 'Endline' then s2.overall_engagement_1
		else 0 
	end) as Endline_overall_engagement_1,
sum(case
		when s2.select = 'Endline' then s2.overall_engagement_2
		else 0 
	end) as Endline_overall_engagement_2,
sum(case
		when s2.select = 'Endline' then s2.working_conditions_1
		else 0 
	end) as Endline_working_conditions_1,
sum(case
		when s2.select = 'Endline' then s2.working_conditions_2
		else 0 
	end) as Endline_working_conditions_2,
sum(case
		when s2.select = 'Endline' then s2.working_conditions_3
		else 0 
	end) as Endline_working_conditions_3,
sum(case
		when s2.select = 'Endline' then s2.working_conditions_4
		else 0 
	end) as Endline_working_conditions_4,
sum(case
		when s2.select = 'Endline' then s2.working_conditions_5
		else 0 
	end) as Endline_working_conditions_5,
sum(case
		when s2.select = 'Endline' then s2.working_conditions_6
		else 0 
	end) as Endline_working_conditions_6,
sum(case
		when s2.select = 'Endline' then s2.working_conditions_7
		else 0 
	end) as Endline_working_conditions_7,
sum(case
		when s2.select = 'Endline' then s2.working_conditions_8
		else 0 
	end) as Endline_working_conditions_8,
sum(case
		when s2.select = 'Endline' then s2.relationship_1
		else 0 
	end) as Endline_relationship_1,
sum(case
		when s2.select = 'Endline' then s2.relationship_2
		else 0 
	end) as Endline_relationship_2,
sum(case
		when s2.select = 'Endline' then s2.relationship_3
		else 0 
	end) as Endline_relationship_3,
sum(case
		when s2.select = 'Endline' then s2.relationship_4
		else 0 
	end) as Endline_relationship_4,
sum(case
		when s2.select = 'Endline' then s2.relationship_5
		else 0 
	end) as Endline_relationship_5,
sum(case
		when s2.select = 'Endline' then s2.learning_1
		else 0 
	end) as Endline_learning_1,
sum(case
		when s2.select = 'Endline' then s2.learning_2
		else 0 
	end) as Endline_learning_2,
sum(case
		when s2.select = 'Endline' then s2.learning_3
		else 0 
	end) as Endline_learning_3,
sum(case
		when s2.select = 'Endline' then s2.value
		else 0 
	end) as Endline_value


from sub2 s2
left join ds_mysql_prod_tagelement t4 on t4.id = s2.cycle_new
group by s2.id, s2.projectId, s2.vendor, s2.country, s2.consultant, t4.name