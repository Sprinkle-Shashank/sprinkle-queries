
with temp as (
select 'solution_app' as col
  union all
  Select 'solution_platform' as col
  union all
  select 'business_unit' as col
  union all
  select 'sector' as col
  union all
  select 'sdg' as col
)
,
q2 as(
Select projectId,members,
 fy_timerange ,
  sector,
  sdg ,
  solution_app ,
  solution_platform ,
 tar_bene ,
 ach_bene ,business_unit,
  max(case col
  when 'solution_app' then t.name
  when 'solution_platform' then t2.name
  when 'business_unit' then t6.name
  when 'sector' then t4.name
 when 'sdg' then t3.name
  else null
  end) as Values,temp.col as dimensions
   from profile_76974 

   cross join temp	
 left join ds_mysql_prod_tagelement t
 on solution_app=t.id
 left join ds_mysql_prod_tagelement t2
 on solution_platform=t2.id
 left join ds_mysql_prod_tagelement t3
 on sdg=t3.id
 left join ds_mysql_prod_tagelement t4
 on sector=t4.id
 left join ds_mysql_prod_tagelement t6
 on business_unit=t6.id 
    GROUP BY _id,temp.col,
  projectId,
  members,
 fy_timerange ,
  sector,
  sdg ,
  solution_app ,
  solution_platform ,
 tar_bene ,
 ach_bene ,business_unit
 
  ),

 q3 as (
	select qq.* ,sectorr from q2 qq,
	qq.sector sectorr

  )	
select  q3.projectId,q3.fy_timerange,q3.tar_bene ,
 q3.ach_bene ,q3.members,q3.dimensions,sum(q3.Values),

 count(*) as Num from q3
 
 group by  q3.projectId,
  q3.fy_timerange,
q3.dimensions,q3.members,q3.tar_bene ,
 q3.ach_bene 


