with sub1 as(
	select p1._id as id, p1.project_id, p1.fy_timerange, p2.pvh_id, p3.region, p3.brands, p3.source_div, p1.end_date_2 as end_date, p1.project_name,
case
  when extract(month from cast(p1.fy_timerange.start as date)) = 1
  		then extract(year from cast(p1.fy_timerange.start as date)) - 1
  else extract(year from cast(p1.fy_timerange.start as date))
end as year
from profile_62491 p1
	left join profile_62948 p2 on p2.project_id = p1.project_id
	left join profile_60928 p3 on p2.pvh_id = p3.factory_id
    where year >= 2020 and p1.end_date_2 is not NULL),
	
sub2 as(
  select id, project_id, project_name, end_date, fy_timerange, pvh_id, region, brands, source_div
  from sub1 
	group by project_id, fy_timerange, project_name, end_date, id, region, pvh_id, brands, source_div),
	
sub3 as(
  select s2.*, country from sub2 s2, s2.region country)
  
select * from sub2