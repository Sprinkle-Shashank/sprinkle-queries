with table1 as
( select p.projectid , p._id , p.fy_timerange , start_date , cast(start_date as date) as start_update,  sta.name as state , cen.name as center , p.name , course.name as course_name_update , bat.name as batch_name , concat(concat(course_name_update, ' '), cast(batch_name as varchar)) as batch_value , target_hours , 1 as acheived_hours , 'OJT' as Status , (target_hours/5) as days_to_add from profile_81438 as p

left join ds_mysql_prod_tagelement cen
on p.center_name = cen.id

left join ds_mysql_prod_tagelement course
on p.course_name = course.id

left join ds_mysql_prod_tagelement bat
on p.batch = bat.id

left join profile_81436 p1 
on p.center = p1._id

left join ds_mysql_prod_tagelement sta
on p1.center_loc = sta.id),

table2 as 
( select p.projectid , p1.name , count(date_holiday) as count_holiday , case when count_holiday is null then 0 else count_holiday end as count_holiday_i   from profile_81611 as p

left join profile_81438 p1 
on p.batch = p1._id

group by p.projectid , p1.name),

table3 as 
(
 
  select p.*, (days_to_add+p1.count_holiday_updated) as holiday_count, dateadd(day,holiday_count,start_update) as day_to_be_added_with_holiday , datediff(week,start_date,day_to_be_added_with_holiday) as week_value , 
  dateadd(day,week_value,day_to_be_added_with_holiday) as final_date_to_be_used , cast(final_date_to_be_used as date) as final_date_to_be_used_update

  from table1 as p
  ---p1.count 
  
  left join table2 p1
  on p.name = p1.name
  )

---  , dateadd(day,days_to_add,start_update) as end_1


--select p.projectid , p._id , center , course_name_update , batch_value , start_update , final_date_to_be_used_update as end_date_update , target_hours , acheived_hours , status from table3 as p

select * from table3 

