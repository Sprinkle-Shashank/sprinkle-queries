select p2.name as projectid, (p1.date_start || '|' || p1.date_end) as fy_timerange, 
t1.name as plant, cast(extract(year from cast(p1.date_start as date)) as varchar) as year,

case
	when p4.name = 'Asian Paints' then p3.name
	when p3.name = 'Asian Paints' then p2.name
	else p4.name
end as theme,
case
	when p4.name = 'Asian Paints' then p2.name
	when p3.name = 'Asian Paints' then p2.name
	else p3.name
end as partner,
case
	when p3.name = 'Helpage' then trim(' ' from split_part(p2.name, '-', 2))
	when p3.name = 'Piramal' then trim(' ' from split_part(p2.name, '-', 1))
	else '-'
end as clinic_type,

sum(p1.allocated) as allocated
from profile_72811 p1 
left join ds_mysql_prod_project p2 on p2.id = p1.projectid
left join ds_mysql_prod_project p3 on p3.id = p2.parent
left join ds_mysql_prod_project p4 on p4.id = p3.parent

left join ds_mysql_prod_tagelement t1 on t1.id = p1.plant

where p1.projectid like '%%'

group by p3.name, p2.name, p1.date_start, p1.date_end, t1.name, p4.name