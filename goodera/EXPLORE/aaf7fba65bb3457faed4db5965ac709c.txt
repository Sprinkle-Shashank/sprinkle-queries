with 
table1 as(select p.projectId as project,decode(p.photo,'',NULL,p.photo) as photo,p.date_enrollment as date_new,'Start Program' as module from profile_16619 p
		  
		  where photo is not NULL
			  group by p.projectId,p.photo,p.date_enrollment,module),
table2 as(select p.projectId as project,decode(p.photo_2,'',NULL,p.photo_2) as photo,p.date_completion as date_new,'End of Program' as module from profile_16619 p
		   where photo is not null
		 group by p.projectId,p.photo_2,p.date_completion,module),
table3 as(select p.projectId as project,decode(p.pic,'',NULL,p.pic) as photo,p.date as date_new,'Communication in the Workplace' as module from profile_16619 p
		   where photo is not null
		 group by p.projectId,p.pic,p.date,module),
table4 as(select p.projectId as project,decode(p.pic_2,'',NULL,p.pic_2) as photo,p.date as date_new,'Communication in the Workplace' as module from profile_16619 p
		   where photo is not null
		 group by p.projectId,p.pic_2,p.date,module),
table5 as(select p.projectId as project,decode(p.pic_3,'',NULL,p.pic_3) as photo,p.date_2 as date_new,'Roles & Responsibilities of BC' as module from profile_16619 p
		   where photo is not null
		 group by p.projectId,p.pic_3,p.date_2,module),
table6 as(select p.projectId as project,decode(p.pic_4,'',NULL,p.pic_4) as photo,p.date_2 as date_new,'Roles & Responsibilities of BC' as module  from profile_16619 p
		   where photo is not null
		 group by p.projectId,p.pic_4,p.date_2,module),
table7 as(select p.projectId as project,decode(p.pic_5,'',NULL,p.pic_5) as photo,p.date_3 as date_new,'Risk Assessment' as module  from profile_16619 p
		   where photo is not null
		 group by p.projectId,p.pic_5,p.date_3,module),
table8 as(select p.projectId as project,decode(p.pic_6,'',NULL,p.pic_6) as photo,p.date_3 as date_new,'Risk Assessment' as module from profile_16619 p
		   where photo is not null
		 group by p.projectId,p.pic_6,p.date_3,module),
table9 as(select p.projectId as project,decode(p.pic_7,'',NULL,p.pic_7) as photo,p.date_4 as date_new,'Problem Solving' as module from profile_16619 p
		   where photo is not null
		 group by p.projectId,p.pic_7,p.date_4,module),

table10 as(select p.projectId as project,decode(p.pic_8,'',NULL,p.pic_8) as photo,p.date_4 as date_new,'Problem Solving' as module from profile_16619 p
		    where photo is not null
		  group by p.projectId,p.pic_8,p.date_4,module),

table11 as(select p.projectId as project,decode(p.pic_9,'',NULL,p.pic_9) as photo,p.date_5 as date_new,'Managing Health & Safety' as module from profile_16619 p
		    where photo is not null
		  group by p.projectId,p.pic_9,p.date_5,module),

table12 as(select p.projectId as project,decode(p.pic_10,'',NULL,p.pic_10) as photo,p.date_5 as date_new,'Managing Health & Safety' as module from profile_16619 p
		    where photo is not null
		  group by p.projectId,p.pic_10,p.date_5,module),

table13 as(select p.projectId as project,decode(p.pic_11,'',NULL,p.pic_11) as photo,p.date_6 as date_new,'Grievance Mechanisms' as module from profile_16619 p
		    where photo is not null
		  group by p.projectId,p.pic_11,p.date_6,module),

table14 as(select p.projectId as project,decode(p.pic_12,'',NULL,p.pic_12) as photo,p.date_6 as date_new,'Grievance Mechanisms' as module from profile_16619 p
		    where photo is not null
		  group by p.projectId,p.pic_12,p.date_6,module),

table15 as(select p.projectId as project,decode(p.pic_13,'',NULL,p.pic_13) as photo,p.date_7 as date_new,'Negotiation' as module from profile_16619 p
		    where photo is not null
		  group by p.projectId,p.pic_13,p.date_7,module),

table16 as(select p.projectId as project,decode(p.pic_14,'',NULL,p.pic_14) as photo,p.date_7 as date_new,'Negotiation' as module from profile_16619 p
		    where photo is not null
		  group by p.projectId,p.pic_14,p.date_7,module),

table17 as(select p.projectId as project,decode(p.pic_15,'',NULL,p.pic_15) as photo,p.date_8 as date_new,' Industrial Relations' as module from profile_16619 p
		    where photo is not null
		  group by p.projectId,p.pic_15,p.date_8,module),

table18 as(select p.projectId as project,decode(p.pic_16,'',NULL,p.pic_16) as photo,p.date_8 as date_new,' Industrial Relations' as module from profile_16619 p
		    where photo is not null
		  group by p.projectId,p.pic_16,p.date_8,module),
table19 as(select * from table1 
		   union 
		   select * from table2
		   union 
		   select * from table3
		   union 
		   select * from table4
		   union
		   select * from table5
		   union 
		   select * from table6
		   union 
		   select * from table7
		   union 
		   select * from table8
		   union
		   select * from table9
		   union 
		   select * from table10
		   union 
		   select * from table11
		   union 
		   select * from table12
		   union 
		   select * from table13
		   union 
		   select * from table14
		   union 
		   select * from table15
		   union 
		   select * from table16
		   union
		   select * from table17
		   union 
		   select * from table18

		   ),table20 as(
select p.projectId as project,fac.name as factory,ven.name as vendor1,nvl2(SUBSTRING(vendor1, 1, POSITION(' (' in vendor1)), SUBSTRING(vendor1, 1, POSITION(' (' in vendor1)), vendor1) as vendor_name, case when vendor_name='' then vendor1 else vendor_name end as vendor,case when vendor_name='' then vendor1 else vendor_name end as vendor,cou.name as country,case when country in ('India', 'Bangladesh', 'Sri Lanka')
then 'South Asia'
when country in ('China')
then 'North Asia'
when country in ('Guatemala', 'El Salvador', 'Dominican Republic')
then 'Americas'
when country in ('Philippines', 'Cambodia',  'Vietnam',  'Indonesia', 'Myanmar')
then 'South East Asia'
end as region,p.name_subunit as unit,t19.module as module,t19.date_new as date_new,DATEPART(YEAR,t19.date_new) as year_new,
			 p.status,t19.photo as photo from profile_16619 p


		  
left join ds_mysql_prod_project fac
on p.projectid = fac.id
left join ds_mysql_prod_project ven
on fac.parent = ven.id
left join ds_mysql_prod_project cou
on ven.parent = cou.id


left join table19 t19 on
p.projectId = t19.project

			
where (cou.name <> 'Test Country' and cou.name <> 'GAP Inc.') and (p.status = 1400365 or p.status is null) and (project ilike '%%') 
			
group by p.projectId,fac.name,cou.name,ven.name,vendor,region,p.name_subunit,p.status,t19.photo,t19.module,t19.date_new,year_new
)
select  * from table1
		
