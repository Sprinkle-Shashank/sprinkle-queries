with sub1 as(
  select xprojectid, fy_timerange, keyword, 'Scope 1' as scope, datanumbase,
  
case
  	when keyword = 'generator_consump' then datanumbase * 0.00259411
	else datanumbase * 0.001
end as col 

from sus_9539

where keyword in ('generator_consump', 'co2_refilled', 'dry_powder_refilled') 
and datanumbase is not null and datanumbase != 0),

------------

sub2 as(
  select s1.xprojectid, s1.fy_timerange, s1.keyword, 'Scope 1' as scope, s1.datatablebase, table1.refrigerant_type, table1.refrigerant_amount

from sus_9539 s1, UNPIVOT s1.datatablebase as table1
where keyword = 'refrigerant_type_amount' and s1.datatablebase is not NULL),

sub3 as(
  select s2.xprojectid, s2.fy_timerange, s2.keyword, s2.scope, refrigerant_type_unwind, s2.refrigerant_amount
  
from sub2 s2, s2.refrigerant_type refrigerant_type_unwind
where s2.refrigerant_amount != 0 and s2.refrigerant_amount is not null),

sub4 as(
  select s3.xprojectid, s3.fy_timerange, s3.keyword, s3.scope, t1.name as refrigerant_type, s3.refrigerant_amount,
 
case
  	when t1.name = 'Air Conditioning Refrigerant - R410' then s3.refrigerant_amount * 2.088
  	when t1.name = 'Air Conditioning Refrigerant - R22/R404' then s3.refrigerant_amount * 3.922
	else 0
end as col

from sub3 s3
left join ds_mysql_prod_tagelement t1 on t1.id = s3.refrigerant_type_unwind),

-------------

sub5 as(
  select s1.xprojectid, s1.fy_timerange, s1.keyword, 'Scope 1' as scope, s1.datatablebase, table2.type_company, table2.fuel_company

from sus_9539 s1, UNPIVOT s1.datatablebase as table2
where keyword = 'company_vehicles' and s1.datatablebase is not NULL)

select s5.xprojectid, s5.fy_timerange, s5.keyword, s5.scope, type_company, s5.fuel_company
  
from sub5 s5, s2.type_company type_company_unwind
where s2.fuel_company != 0 and s2.fuel_company is not null