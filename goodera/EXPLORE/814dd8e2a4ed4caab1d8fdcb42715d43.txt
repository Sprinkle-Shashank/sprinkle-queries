
with t1 as 
(select tag3.name as projectId, p1.notes_2, p1.end_date_2, p1.start_date_2, tag4.name as training, tag6.name as training_type, p1.supervisors, p1.employed, p1.saturation, p1.master_trainers, p1.year, tag7.name as factory, p5.vendor, tag5.name as consultant, p5.product_category,tag1.name as country, tag2.name as product_category2,
cast('Cycle 1' as VARCHAR) as Cycle1,
cast('Cycle 2' as VARCHAR) as Cycle2
from profile_64817 p1
left join ds_mysql_prod_project p2
on p2.id = p1.projectId
left join ds_mysql_prod_project p3
on p3.id = p2.parent
left join ds_mysql_prod_project p4
on p4.id = p3.parent
left join profile_64362 p5 
on p1.projectId = p5.projectId
left join ds_mysql_prod_tagelement tag1
on p5.country = tag1.id
left join ds_mysql_prod_tagelement tag2
on p5.product_category = tag1.id 
left join ds_mysql_prod_tagelement tag3
on p1.projectId = tag3.id
left join ds_mysql_prod_project tag4
on p1.training = tag4.id
left join ds_mysql_prod_tagelement tag5
on p5.consultant = tag5.id
left join ds_mysql_prod_tagelement tag6
on p1.training_type = tag6.id
left join ds_mysql_prod_tagelement tag7
on p5.factory = tag7.id)

select projectId,notes_2,end_date_2,start_date_2,training,training_type, supervisors, employed,saturation,master_trainers, year,country,factory,vendor,consultant, product_category, product_category2,
cast('50' as VARCHAR) as Target,
case 
when year = 1433762 then Cycle1
when year = 1433763 then Cycle1
when year = 1433764 then Cycle1
else Cycle2
end as cycle
from t1
Group by projectId, notes_2, end_date_2, start_date_2, training, training_type, year, supervisors, employed, saturation, master_trainers, factory, vendor, consultant, country, product_category, Target, cycle,t1.product_category2
