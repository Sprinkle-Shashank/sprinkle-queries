with sub1 as(
  select x1._id as id, x1.profileinstanceid, x1.status, x1.active, x1.data, x1.taskuserid, x2.taskid, x5.projectid, x6.profileid, x4.sectionid, x6.name as section, x7.name as profile, x8.name as project, x1.created, x1.modified,
  
case
  when is_array(x1.submissionlog) = false or get_array_length(x1.submissionlog) = 0 then 
  	   array(x1.submissionlog)
  else x1.submissionlog
end as submissionlog_new,
case
  when is_array(x1.approvallog) = false or get_array_length(x1.approvallog) = 0 then 
  	   array(x1.approvallog)
  else x1.approvallog
end as approvallog_new
  
from ds_mongo_taskresponse x1 

left join ds_mysql_prod_taskuser x2 on x2.id = x1.taskuserid
left join ds_mysql_prod_task x3 on x3.id = x2.taskid
left join ds_mysql_prod_flowtask x4 on x4.id = x3.flowtaskid
left join ds_mysql_prod_projectflow x5 on x5.id = x3.projectflowid
left join ds_mysql_prod_section x6 on x6.id = x4.sectionid
left join ds_mysql_prod_profile x7 on x7.id = x6.profileid
left join ds_mysql_prod_project x8 on x8.id = x5.projectid

where x6.profileid in (27395, 27405, 80188, 80183) and x1.active = 't'
and x1.status in ('REJECTED', 'PENDING_APPROVAL', 'SUBMITTED')

group by x1._id, x1.profileinstanceid, x1.status, x1.active, x1.data, x1.taskuserid, x2.taskid, x5.projectid, x6.profileid, x4.sectionid, x6.name, x7.name, x8.name, x1.submissionlog, x1.approvallog, x1.created, x1.modified),

sub2 as (Select
  case 
    when profileid = 80183 then data."description"
    when profileid = 27395 then data."brief"
  	when profileid = 80188 then data."description" 
  		end as brief_des,
  case	
    when profileid = 80183 then data."mission"
    when profileid = 27395 then data."vision_and_mission"
  	when profileid = 80188 then data."mission" 
  		end as mission,
  case	
    when profileid = 80183 then data."registration_number"
    when profileid = 27395 then data."reg_number"
  	when profileid = 80188 then data."registration_number" 
	when profileid = 27405 then data."reg_number"
  		end as reg_number,
  case	
    when profileid = 80183 then data."registration_date"
    when profileid = 27395 then data."registration_date"
  	when profileid = 80188 then data."registration_date" 
  		end as registration_date,
  case	
    when profileid = 80183 then data."pan_card"
    when profileid = 27395 then data."pan"
  	when profileid = 80188 then data."pan_card" 
  		end as pan,
		 case	
    when profileid = 80183 then data."participate_board"
    when profileid = 80188 then data."participate_board"
  		end as participate_board,
		 case	
    when profileid = 80183 then data."percentage_donors"
    when profileid = 27395 then data."individual_donors"
  	when profileid = 80188 then data."percentage_donors" 
	when profileid = 27405 then data."individual_donors"
  		end as individual_donors,
		  case	
    when profileid = 80183 then data."total_donations"
    when profileid = 27395 then data."corporate_funders"
  	when profileid = 80188 then data."total_donations" 
	when profileid = 27405 then data."corporate_funders"
  		end as corporate_funders,
		  case	
    when profileid = 80183 then data."percentage_funding"
    when profileid = 27395 then data."government_funding"
  	when profileid = 80188 then data."percentage_funding" 
	when profileid = 27405 then data."government_funding"
  		end as government_funding,
		  case	
    when profileid = 80183 then data."percentage_agencies"
    when profileid = 27395 then data."other_funding"
  	when profileid = 80188 then data."percentage_agencies" 
	when profileid = 27405 then data."other_funding"
  		end as other_funding,
		  case	
    when profileid = 80183 then data."organization_budget"
    when profileid = 27395 then data."budget"
  	when profileid = 80188 then data."organization_budget" 
	when profileid = 27405 then data."budget"
  		end as budget,
		   case	
    when profileid = 80183 then data."objective"
    when profileid = 27395 then data."org_objective"
  	when profileid = 80188 then data."objective" 
	when profileid = 27405 then data."org_objective"
  		end as org_objective,
	  case	
    when profileid IN (27395,27405,80183,80188) then t1.name
  		end as target_beneficiary,


  case	
    when profileid IN (27395,80183,80188) then t.name
  		end as org_type 
		 
		 from sub1
		 left join ds_mysql_prod_tagelement t
          ON t.id=sub1.data.org_type
		 		 left join ds_mysql_prod_tagelement t1
          ON t.id=sub1.data.target_beneficiary
	 
)

Select * from sub2












/*27395----ia----prof ref-----80183

from profile_27395 p
left join profile_80183 a
on p.ia=a._id*/