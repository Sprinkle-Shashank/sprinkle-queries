with t1 as
(select * from
 (
select projectid.name as projectid, fy_timerange, sum(num_students_pre_primary) as num_students_pre_primary, sum(num_students_primary) as num_students_primary, sum(num_students_secondary) as num_students_secondary, sum(num_students_senior_secondary) as num_students_senior_secondary
from profile_83513 as p

left join ds_mysql_prod_project projectid
on p.projectid = projectid.id
  group by projectid.name, fy_timerange
)
UNPIVOT
 (Value FOR Dimension IN (num_students_pre_primary,num_students_primary,num_students_secondary,num_students_senior_secondary))
   ),
t2 as
(
  select projectid, fy_timerange, value, num_students_pre_primary+num_students_primary+num_students_secondary+num_students_senior_secondary as total_students_classwise from t1

  )
  select projectid, fy_timerange, total_students_classwise, value from t2