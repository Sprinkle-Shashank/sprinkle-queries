drop table if exists train_rejected_entries_flow;
create table train_rejected_entries_flow as

with lookup as (select 
				CAST(p.taskuserid as INT8) as taskuserid1, p._id, p.status, p.active, p.organizationid, p.data, p.projectid, p.profileid, p.profileinstanceid,approval."approverEmail" as email,approval,p.profileinstanceid
				from ds_mongo_taskresponse p, p.approvallog approval
								


),

lookup1 as (select 
				p._id, p.status, p.active, p.organizationid, p.data, task.projectflowid, p.taskuserid1,taskuser.programuserid, taskuser.taskid,p.email,
				task.flowtaskid,p.profileinstanceid
				from lookup p
left join ds_mysql_prod_taskuser taskuser on
taskuser.id = p.taskuserid1					
				
						
left join ds_mysql_prod_task task on
task.id = taskuser.taskid
			

),

lookup2 as (select 
			p._id, p.status, p.active, p.organizationid, p.data, p.flowtaskid,p.projectflowid,
			flowtask.sectionid,
			projectflow.projectid,p.profileinstanceid,
			programuser.programid ,p.email
			from lookup1 p
 			
left join ds_mysql_prod_flowtask flowtask on 
flowtask.id = p.flowtaskid		
			
left join ds_mysql_prod_projectflow projectflow on 
projectflow.id = p.projectflowid
			
left join ds_mysql_prod_programuser programuser on
programuser.id = p.programuserid
),

lookup3 as (select 
			p._id, p.status, p.active, p.organizationid, p.data, flowtaskid, sectionid, 
			section.profileid, section.name,p.projectid,p.programid,p.email,p.profileinstanceid
			from lookup2 p
  
left join ds_mysql_prod_section section on
section.id = p.sectionid		
)

Select * from lookup3
